<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>On Giving libRebol JS more powers than JavaScript - Language Bridging - AltRebol</title>
    <meta name="description" content="It seems modest to imagine adding a function to a browser&amp;#39;s JavaScript, which looped through two strings, printed both, and gave you back the second to display in a browser &amp;lt;div&amp;gt;: 
var second = rebSpell(
    &amp;quot;repeat 2 [d&amp;hellip;">
    <meta name="generator" content="Discourse 3.1.0.beta4 - https://github.com/discourse/discourse version 25276f62f959eab4557049a655300a70835c5769">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="849.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_caa66e77e807fc270e5b21d201643962219b6a9a.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/poll_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_5e18a6fac02b6ab11e33445179f4a2961aadbfd8.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;On Giving libRebol JS more powers than JavaScript&#39;" href="849.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/on-giving-librebol-js-more-powers-than-javascript/849" />
<meta name="twitter:url" content="https://forum.rebol.info/t/on-giving-librebol-js-more-powers-than-javascript/849" />
<meta property="og:title" content="On Giving libRebol JS more powers than JavaScript" />
<meta name="twitter:title" content="On Giving libRebol JS more powers than JavaScript" />
<meta property="og:description" content="It seems modest to imagine adding a function to a browser&#39;s JavaScript, which looped through two strings, printed both, and gave you back the second to display in a browser &lt;div&gt;:  var second = rebSpell(     &quot;repeat 2 [data: ask text!, echo [You typed: @data]] data&quot; ) console.log(&quot;Second string entered was&quot; + second)  (Let&#39;s say the place it&#39;s carrying out the input and printing communication is in some kind of textedit-like control, and that is implicit.)  What could be simpler than that?!  Web..." />
<meta name="twitter:description" content="It seems modest to imagine adding a function to a browser&#39;s JavaScript, which looped through two strings, printed both, and gave you back the second to display in a browser &lt;div&gt;:  var second = rebSpell(     &quot;repeat 2 [data: ask text!, echo [You typed: @data]] data&quot; ) console.log(&quot;Second string entered was&quot; + second)  (Let&#39;s say the place it&#39;s carrying out the input and printing communication is in some kind of textedit-like control, and that is implicit.)  What could be simpler than that?!  Web..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Language Bridging" />
<meta property="og:article:section:color" content="25AAE2" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 ❤" />
<meta property="article:published_time" content="2018-10-10T01:04:32+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="849.html">On Giving libRebol JS more powers than JavaScript</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/language-bridging.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Language Bridging</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='On Giving libRebol JS more powers than JavaScript'>
        <meta itemprop='articleSection' content='Language Bridging'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="849.html">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-10-10T01:04:32Z' class='post-time'>
                    October 10, 2018,  1:04am
                  </time>
                  <meta itemprop='dateModified' content='2022-06-16T23:15:00Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p>It seems modest to imagine adding a function to a browser's JavaScript, which looped through two strings, printed both, and gave you back the second to display in a browser <code>&lt;div&gt;</code>:</p>
<pre><code>var second = rebSpell(
    "repeat 2 [data: ask text!, echo [You typed: @data]] data"
)
console.log("Second string entered was" + second)
</code></pre>
<p><em>(Let's say the place it's carrying out the input and printing communication is in some kind of textedit-like control, and that is implicit.)</em></p>
<p>What could be simpler than that?!</p>
<h2>Web browsers aren't designed to work this way <img src="../../images/emoji/twitter/frowning.png%3Fv=9" title=":frowning:" class="emoji" alt=":frowning:">
</h2>
<p>Nothing about <em>"JavaScript-the-language"</em> particularly prohibits it from doing things synchronously.  You find various synchronous APIs here and there... <code>console.log()</code> will write synchronously to the console, and <code>alert()</code> famously (and irritatingly) gives you a modal popup that will freeze everything until it's dismissed.  Historically, you could even ask that an <code>XMLHttpRequest</code> be synchronous (a feature <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Synchronous_and_Asynchronous_Requests#Synchronous_request">now disabled on the main thread</a> and thus restricted to web workers).</p>
<p>So it isn't JavaScript with the limit--any more than C or anything else.  It's the browser.  While a JavaScript function is running on the main thread, the painting and mouse events and who-knows-what-else won't happen.</p>
<p>This isn't particularly new in the GUI app world...but it is particularly strict.  Even Windows offered things like <a href="https://msdn.microsoft.com/en-us/library/ms910649.aspx">PeekMessage()</a> to let you sneakily look through and process mouse messages without giving up control.</p>
<p>The tightening grip of the browser makers is speaking loud and clear:</p>
<ul>
<li><strong>there are some things only the GUI thread will ever be able to do</strong></li>
<li><strong>none of those things will be synchronous on the GUI thread--you can ask for work to be done, but will always be called back later with any result</strong></li>
</ul>
<h2>So the code above is actually impossible?</h2>
<p>Well, it's <em>almost</em> impossible.  If you use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt">Window.prompt()</a> you can get input in an alert-box style modal dialog.  And if you use <code>console.log</code> or <code>Window.alert()</code> for PRINT, it could "work"...but no one wants that.</p>
<p>Note what the "impossible" part of it is--the expectation that it runs and can output the result synchronously.  If you were willing to instead write something like:</p>
<pre><code>rebSpellCallback(
    "repeat 2 [data: ask text!, echo [You typed: @data]] data",
    function (second) {
        console.log("Second string entered was" + second)
    }
)
// any residual code here happens *before* the console.log output
</code></pre>
<p>Then that could be made to work.  And since JavaScript programmers noticed over time that their language was a callback-reductio-ad-absurdum, they tried to address it with something called ASYNC/AWAIT:</p>
<pre><code>async function whatever() {
   var second = await rebSpellPromise(
        "repeat 2 [data: ask text!, echo [You typed: @data]] data"
   )
   console.log("Second string entered was" + second)
   // any residual code here happens *after* the console.log output
}
</code></pre>
<p>In most ways this is just a syntax trick for the previous code pattern, so you don't have to write a cascading line of callbacks for every step in a sequence.</p>
<p>It looks good.  <em>BUT</em> since it has to do some amount of "unwinding" to achieve its illusion, it has the unappealing property that if you ever call an async function from one that is <em>not</em> marked async (or if you leave off the AWAIT), the illusion is broken.  You will just get a return object that's a "promise"...and the code after the promise will run before the consequences you were "awaiting" happen...just as if you'd had it trailing outside the place where you passed a callback function.</p>
<h2>Wouldn't JS programmers just <em>accept</em> rebPromise()?</h2>
<p>For larger operations, they probably wouldn't blink.  They'd presumably be upset if JavaScript's addition required a callback to get the sum.  But I can't honestly I say I know where their line is...and wouldn't be shocked if there was a BigNum library where they said the reason you had to wait for a callback for the sum was that it could be a potentially long operation and they didn't want to block the GUI, so it was dispatching it to a worker and would call you back when done.  (?)</p>
<p>As an integral part of its variadic design, libRebol doesn't actually have any dedicated "small" operations.  There's no separate atomic "give me the spelling of this REBVAL that is known to be an ANY-STRING!, and do only that", you can always throw in extra code.  Even just asking to PROBE a string before returning its spelling would count, so long as its based on a DOM-manipulating PRINT:</p>
<pre><code> var sync_possible = rebSpell(some_str)
 console.log("spelling is: " + sync_possible);

 var sync_impossible = rebSpell("probe", some_str)
 // wouldn't be guaranteed that print was done by this line
 // if probe is based on synchronous-seeming print, sequencing lost
</code></pre>
<p>What I've thought of as a compromise would be to add rebPromise(), but still offer all the other APIs.  Then have the other APIs trigger a failure if at runtime they discover they require synchronous operations...and point you to use rebPromise.  If you're using async functions you'd say:</p>
<pre><code>var value = await rebPromise("probe", str);
var sync_illusion = rebSpell(value);
rebRelease(value);
</code></pre>
<p>Simplifyable to:</p>
<pre><code>var sync_illusion = rebSpell(rebR(await rebPromise("probe", str)));
</code></pre>
<p>While you can't abstract away the AWAIT (it's part of the language) I think we could probably get a pre-released promise result with a new API "instruction":</p>
<pre><code>var sync_illusion = rebSpell(await rebP("probe", str));
</code></pre>
<p>So if you're using modern JavaScript and async functions, you could probably just inject <code>await rebP( )</code> into the existing API set of operations, if it turned out what you were doing required it.</p>
<blockquote>
<p>I'll quickly point out that if it seems having to do results with callbacks seems onerous, that the more modern an API in JavaScript is, the more of them they have.  If you look at something like the fetch() API, not only do they have to "wait on" the server to return a response, the response itself then breaks down into more pieces you have to wait on!  From <a href="https://mdn.github.io/fetch-examples/fetch-array-buffer/">a fetch example</a></p>
<pre><code>fetch('viper.ogg')
  .then(function(response) { return response.arrayBuffer(); })
  .then(function(buffer) {
    audioCtx.decodeAudioData(buffer, function(decodedData) {
      source.buffer = decodedData;
      source.connect(audioCtx.destination);
    });
  });
};
</code></pre>
</blockquote>
<h2>But not all cases are pathological</h2>
<p>Another angle to look at this is that trying to write an interactive REPL for a language running a synchronous script is actually a really hard example, and may make me worry more than I should.</p>
<p>A lot of projects would probably be fine having their PROBE and DUMP operations output to <code>console.log</code>, and not need synchronous interaction with some control that's part of the DOM.  Many interactions with the DOM are fire-and-forget...expected to just update when they update...a small snippet of code runs, and there's no requirement that the updates be completed before anything else happens.</p>
<p>There may be a number of cases where someone might want to use Rebol as part of their web app and never expect it to do any I/O at all.  I don't really know.  It's all very speculative at the moment!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../r3-gui-in-web-browser/860/12.html">R3 GUI in web browser</a>
                        <meta itemprop='position' content='5'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../what-will-rebol-on-the-web-look-like/850/4.html">What will Rebol on the Web Look Like?</a>
                        <meta itemprop='position' content='6'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../lkppo-building-on-openbsd-forum-thread/984/13.html">LkpPo Building on OpenBSD Forum Thread</a>
                        <meta itemprop='position' content='7'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../website-for-launch/1098/2.html">Website for Launch</a>
                        <meta itemprop='position' content='8'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../2018-retrospective-elevating-the-art/992.html">2018 Retrospective: Elevating the Art</a>
                        <meta itemprop='position' content='9'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../what-will-rebol-on-the-web-look-like/850.html">What will Rebol on the Web Look Like?</a>
                        <meta itemprop='position' content='10'>
                      </div>
                </div>
          </div>
    </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
