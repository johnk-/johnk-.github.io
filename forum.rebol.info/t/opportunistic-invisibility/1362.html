<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Opportunistic Invisibility - Functions - AltRebol</title>
    <meta name="description" content="When &amp;quot;Invisibles&amp;quot; were introduced, a function was either always-invisible or always-not-invisible.  You couldn&amp;#39;t make a function that &amp;quot;sometimes returned an INTEGER!, and sometimes was invisible.&amp;quot; 
Due to changes in the &amp;hellip;">
    <meta name="generator" content="Discourse 3.1.0.beta4 - https://github.com/discourse/discourse version 25276f62f959eab4557049a655300a70835c5769">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://forum.rebol.info/t/opportunistic-invisibility/1362" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_caa66e77e807fc270e5b21d201643962219b6a9a.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/poll_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_5e18a6fac02b6ab11e33445179f4a2961aadbfd8.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Opportunistic Invisibility&#39;" href="1362.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/opportunistic-invisibility/1362" />
<meta name="twitter:url" content="https://forum.rebol.info/t/opportunistic-invisibility/1362" />
<meta property="og:title" content="Opportunistic Invisibility" />
<meta name="twitter:title" content="Opportunistic Invisibility" />
<meta property="og:description" content="When &quot;Invisibles&quot; were introduced, a function was either always-invisible or always-not-invisible.  You couldn&#39;t make a function that &quot;sometimes returned an INTEGER!, and sometimes was invisible.&quot;  Due to changes in the way the evaluator interacts with invisibles, this doesn&#39;t need to be a rule anymore.  There could be functions which decide--perhaps based on their arguments--whether to act invisibly or not.  This has actually been requested.  Imagine you are dealing with something like DUMP, an..." />
<meta name="twitter:description" content="When &quot;Invisibles&quot; were introduced, a function was either always-invisible or always-not-invisible.  You couldn&#39;t make a function that &quot;sometimes returned an INTEGER!, and sometimes was invisible.&quot;  Due to changes in the way the evaluator interacts with invisibles, this doesn&#39;t need to be a rule anymore.  There could be functions which decide--perhaps based on their arguments--whether to act invisibly or not.  This has actually been requested.  Imagine you are dealing with something like DUMP, an..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Functions" />
<meta property="og:article:section:color" content="25AAE2" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="5 â¤" />
<meta property="article:published_time" content="2020-10-09T15:57:45+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="https://forum.rebol.info/t/opportunistic-invisibility/1362">Opportunistic Invisibility</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Functions</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Opportunistic Invisibility'>
        <meta itemprop='articleSection' content='Functions'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/opportunistic-invisibility/1362">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-10-09T15:57:45Z' class='post-time'>
                    October 9, 2020,  3:57pm
                  </time>
                  <meta itemprop='dateModified' content='2022-08-20T08:39:46Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p><a href="../issues-with-invisibles-a-truly-disappearing-comment/405/index.html">When "Invisibles" were introduced</a>, a function was either always-invisible or always-not-invisible.  You couldn't make a function that <em>"sometimes returned an INTEGER!, and sometimes was invisible."</em></p>
<p>Due to changes in the way the evaluator interacts with invisibles, this doesn't need to be a rule anymore.  There could be functions which decide--perhaps based on their arguments--whether to act invisibly or not.</p>
<p>This has actually been requested.  Imagine you are dealing with something like DUMP, and you want to call out that you'd like to actually return one of the things you are dumping:</p>
<pre><code>all [
    ...
    x * 10 + 20  ; want to print this expression and see its evaluated result
    ...
]

=&gt;

all [
    ...
    -- (x * 10 + 20)  ; now it's not participating in the ALL anymore
    ...
 ]
</code></pre>
<p><a class="mention" href="https://forum.rebol.info/u/gchiu">@gchiu</a> wanted some way of getting a printout like <code>-- (x * 10 + 20): 40</code> but also having the value still returned, without needing to name another operator.  So maybe you could mark this, e.g. with a GET-GROUP! or GET-WORD! in the DUMP dialect.</p>
<p><em>Having this particular debug construct behave in that way may not be the best idea in the world.</em><br>
But we don't need to technically prohibit it.</p>
<p>This could give an interesting nuance to the difference between <strong>return</strong> and <strong>return void</strong>.  RETURN used alone could just mean literally "return and don't have any value, not even void".  It's certainly a weird idea, but it's consistent...and we could make sure you knew what you were doing by requiring some kind of invisibility in the type signature of a function before allowing a 0-arg RETURN.  Of course there could be other syntaxes, like <strong>return/invisible</strong>...which would probably fit practice better by leaving plain RETURN as returning void.</p>
<p>There'd need to be a new syntax for saying you could return invisibles, because <code>return: []</code> as the indicator wouldn't allow you to specify it along with other types.</p>
<h2>Worth Doing?</h2>
<p>The main argument for opportunistic invisibles is to keep you from having to create different names for the invisible and visible forms of a function, when there could be a learnable convention for knowing which it is from the arguments alone.</p>
<p>The more fanciful argument is creating strange execution patterns in code golf, where you have some kind of "voting" mechanism e.g. inside an ALL and program behavior emerges from things opting out.  This harkens back some to the "null opts out of logical operations" ideas from the early days of null behavior.</p>
<p>Normalizing invisibles to the point of saying that they're what you get when you just do a plain RETURN is a fairly weird idea, but they're a pretty powerful feature that might have even more applications than yet thought of.  <strong>most free-form programming language ever created</strong> is still the goal, so... I think this deserves some consideration.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="https://forum.rebol.info/t/a-brighter-2021-with-virtual-binding-good-riddance-2020/1451">A Brighter 2021 With Virtual Binding (+ Good Riddance 2020)</a>
                        <meta itemprop='position' content='2'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../permissive-group-invisibility/1153/5.html">Permissive Group Invisibility</a>
                        <meta itemprop='position' content='3'>
                      </div>
                </div>
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/opportunistic-invisibility/1362">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-10-26T05:02:53Z' class='post-time'>
                    October 26, 2020,  5:02am
                  </time>
                  <meta itemprop='dateModified' content='2022-08-20T08:45:06Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="1362">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="https://forum.rebol.info/user_avatar/forum.rebol.info/hostilefork/40/26_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>Normalizing invisibles to the point of saying that they're what you get when you just do a plain RETURN is a fairly weird idea, but they're a pretty powerful feature that might have even more applications than yet thought of.</p>
</blockquote>
</aside>
<p><strong>On the plus side</strong> of saying that RETURN with no arguments means "invisible" is that it facilitates wrapping.</p>
<p>Imagine if MAYBE-INVISIBLE is a function that might return a value, or might be invisible.  Then you want to write a wrapper for it:</p>
<pre><code>wrapper: func [x] [
    if x = 10 [return 20]
    return maybe-invisible x
]
</code></pre>
<p>In the event that MAYBE-INVISIBLE vaporizes, this will act like you had written just a plain <code>return</code>.  So if plain RETURN means invisible, then you get an effective pass-through of the invisibility.</p>
<p><strong>...BUT...On the minus side</strong> is that it doesn't play very well with the idea that a variadic RETURN could be used with multiple return values somehow.  Imagine if <strong>return ret1 ret2</strong> could line up with a callsite that said <strong>[x y]: ...</strong> where x would get ret1, and y would get ret2.</p>
<h2>That Aside, Opportunistic Invisibility is Almost Implemented</h2>
<p>It's tricky to write.  But I think of it ultimately as a "simplifying" aspect on the evaluator...as it removes the separate concept of an "invisible function".</p>
<p>There are some things that can't be done if you don't know a-priori that a function is invisible...and have to wait to find out until after it has run that it is.  But I think few people would notice the subtlety of what that implies.</p>
<p>This puts some pressure on type specs, because now we have another return state that isn't an ANY-VALUE! besides null.  The <strong><code>return: []</code></strong> is no longer going to work.</p>
<p>What I have right now is that if you want to say that a function is invisible even if it just drops out of the bottom with no RETURN statement, then you say <strong><code>return: &lt;void&gt;</code></strong>  This is like the <strong><code>return: &lt;none&gt;</code></strong> instruction in that it overrides whatever else would fall out.</p>
<p>Then there's the question of how to put a non-datatype in the spec list for the return.  This is something that can only apply to RETURN...which makes it a whole-function property more than a</p>
<p>I've been wondering if ISSUE! is better for these states (<strong><span class="hashtag">#null</span></strong>, <strong><span class="hashtag">#vanish</span></strong>) and using 7 characters or less on 32-bit platforms has a nice savings over <code>&lt;opt&gt;</code> and <code>&lt;invisible&gt;</code>.</p>
<p>As usual, no shortage of things to think about.  But invisibility has become a core differentiating feature...it's novel and it's powerful.  Embracing it systemically is a good thing.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/opportunistic-invisibility/1362">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-10-28T10:31:57Z' class='post-time'>
                    October 28, 2020, 10:31am
                  </time>
                  <meta itemprop='dateModified' content='2022-12-01T11:06:56Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Behold, the first opportunistic invisible:</p>
<pre><code>&gt;&gt; vanish-if-odd: func [return: [&lt;void&gt; integer!] x] [
       if even? x [return x]
       return void
   ]

&gt;&gt; &lt;test&gt; vanish-if-odd 2
== 2

&gt;&gt; &lt;test&gt; vanish-if-odd 1
== &lt;test&gt;
</code></pre>
<p>Which was followed immediately by the first chaining opportunistic invisible:</p>
<pre><code>&gt;&gt; vanish-if-even: func [return: [&lt;void&gt; integer!] y] [
       return vanish-if-odd y + 1
   ]

&gt;&gt; &lt;test&gt; vanish-if-even 2
== &lt;test&gt;

&gt;&gt; &lt;test&gt; vanish-if-even 1
== 2
</code></pre>
<p>Like I say...implementation-wise, it's a bit of a mixed bag in terms of making some things simpler and some things more complex.  But as a feature, I think it's something that will open up space for exploration...especially in debug constructs.  Should be very fun for code golf.  <img src="../../images/emoji/twitter/golf.png%3Fv=9" title=":golf:" class="emoji" alt=":golf:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../lingering-idea-labeled-ornery-word-s-bad-word/1383/6.html">Lingering Idea: Labeled &quot;Ornery&quot; WORD!s</a>
                        <meta itemprop='position' content='1'>
                      </div>
                </div>
          </div>
    </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
