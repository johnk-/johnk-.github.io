<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>The Cool New Repurposing of ANY In PARSE - Parsing - AltRebol</title>
    <meta name="description" content="It&amp;#39;s a bit of a pain to collect alternate rules.  For instance: 
alternates: copy []

rules: [[some integer!] [3 text!]]

for-each rule rules [
    append alternates compose [(rule) |]
]

parse data [alternates]

That wi&amp;hellip;">
    <meta name="generator" content="Discourse 3.1.0.beta4 - https://github.com/discourse/discourse version 25276f62f959eab4557049a655300a70835c5769">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1662.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_caa66e77e807fc270e5b21d201643962219b6a9a.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/poll_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_5e18a6fac02b6ab11e33445179f4a2961aadbfd8.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;The Cool New Repurposing of ANY In PARSE&#39;" href="../the-cool-new-repurposing-of-any-in-parse/1662.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/the-cool-new-repurposing-of-any-in-parse/1662" />
<meta name="twitter:url" content="https://forum.rebol.info/t/the-cool-new-repurposing-of-any-in-parse/1662" />
<meta property="og:title" content="The Cool New Repurposing of ANY In PARSE" />
<meta name="twitter:title" content="The Cool New Repurposing of ANY In PARSE" />
<meta property="og:description" content="It&#39;s a bit of a pain to collect alternate rules.  For instance:  alternates: copy []  rules: [[some integer!] [3 text!]]  for-each rule rules [     append alternates compose [(rule) |] ]  parse data [alternates]  That will give you alternates as [[some integer!] | [3 text!] |]  But that rule will always succeed...should both the component rules fail to match, it will act as a no-op.  Because it&#39;s equivalent to [[some integer!] | [3 text!] | []], and [] will always succeed.  You get a similar pro..." />
<meta name="twitter:description" content="It&#39;s a bit of a pain to collect alternate rules.  For instance:  alternates: copy []  rules: [[some integer!] [3 text!]]  for-each rule rules [     append alternates compose [(rule) |] ]  parse data [alternates]  That will give you alternates as [[some integer!] | [3 text!] |]  But that rule will always succeed...should both the component rules fail to match, it will act as a no-op.  Because it&#39;s equivalent to [[some integer!] | [3 text!] | []], and [] will always succeed.  You get a similar pro..." />
<meta property="og:article:section" content="Domains" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:section" content="Parsing" />
<meta property="og:article:section:color" content="F1592A" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="5 ❤" />
<meta property="article:published_time" content="2021-08-14T18:35:45+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="1662.html">The Cool New Repurposing of ANY In PARSE</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/15" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/parsing/16" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Parsing</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='The Cool New Repurposing of ANY In PARSE'>
        <meta itemprop='articleSection' content='Parsing'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="1662.html">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-08-14T18:35:45Z' class='post-time'>
                    August 14, 2021,  6:35pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-12T12:54:57Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p>It's a bit of a pain to collect alternate rules.  For instance:</p>
<pre><code>alternates: copy []

rules: [[some integer!] [3 text!]]

for-each rule rules [
    append alternates compose [(rule) |]
]

parse data [alternates]
</code></pre>
<p>That will give you alternates as <strong>[[some integer!] | [3 text!] |]</strong></p>
<p>But that rule will <em>always succeed</em>...should both the component rules fail to match, it will act as a no-op.  Because it's equivalent to <strong>[[some integer!] | [3 text!] | []]</strong>, and <strong>[]</strong> will always succeed.</p>
<p>You get a similar problem if you go the other way.</p>
<pre><code>for-each rule rules [
    append alternates compose [| (rule)]
]
</code></pre>
<p>Now you've got a rule that is always a no-op: <strong>[| [some integer!] | [3 text!]]</strong>.  Again, this is equivalent to <strong>[[] | [some integer!] | [3 text!]]</strong>, and this time the <strong>[]</strong> succeeds before the other rules get a chance.</p>
<p>You can hack around this by starting out with <strong>alternates: [false]</strong>.  This way, you can add the <strong>[| (rule)]</strong> and it will never run the false.  So it works.</p>
<h2>Wouldn't a New Meaning for the ANY Combinator be Better?</h2>
<p>Having reclaimed ANY it seems it would be perfect for this.  Why not:</p>
<pre><code>rules: [[some integer!] [3 text!]]
parse data [any (rules)]
</code></pre>
<p>You could leave your block in its regular old form, and use it that way.  Dyn-o-mite!</p>
<h1>Subtlety: A Different Meaning For BLOCK!s</h1>
<p>When you use ANY with a literal block, there's something a bit unusual going on:</p>
<pre><code> &gt;&gt; parse [1 "two" &lt;three&gt;] [some any [integer! text! tag!]]
 == &lt;three&gt;
</code></pre>
<p>Ordinarily, a block like <strong><code>[integer! text! tag!]</code></strong> would expect to see three things in sequence.  But under the context of ANY, the rules change... it's taking its parameter not as a <em>combinator</em>, but as a <em>BLOCK! by value</em>.</p>
<p><img src="../../images/emoji/twitter/hushed.png%3Fv=9" title=":hushed:" class="emoji only-emoji" alt=":hushed:"></p>
<p>At first I thought this was bad, and we'd have to enforce taking the blocks by value, e.g. as the product of a GROUP!:</p>
<pre><code> &gt;&gt; parse [1 "two" &lt;three&gt;] [some any ([integer! text! tag!])]
 == &lt;three&gt;
</code></pre>
<p>...or perhaps there'd be some non-pure-BLOCK! way of helping to reassure people that the block wasn't going to be processed by PARSE's default BLOCK! combinator:</p>
<pre><code> &gt;&gt; parse [1 "two" &lt;three&gt;] [some any @[integer! text! tag!]]
 == &lt;three&gt;
</code></pre>
<p>But we're adults, here.  <strong>And we're using a language whose whole concept is context-dependent meaning.</strong>  If you can't cope with the interpretation of blocks changing depending on what you pass the block to, you're in the wrong place.</p>
<p>However, do note that under today's logic, fetching blocks through a WORD! reference will still run them through the BLOCK! combinator.  Hence you can't say:</p>
<pre><code>rules: [[some integer!] [3 text!]]
parse data [any rules]  ; nope, you have to say [any (rules)]
</code></pre>
<p>So you need a group there, for now.  I don't have an offhand proof of why a variable fetch in that context should run the block combinator--maybe it shouldn't?  It's something to think about.</p>
<p>But long story short: Cool Feature, Use It!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../dead-red-redemption-starting-uparse-on-the-right-foot/1649.html">Making Red Tests Useful: Starting UPARSE on the Right Foot</a>
                        <meta itemprop='position' content='1'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../the-cool-new-repurposing-of-while-in-parse/1875.html">The Cool New Repurposing of WHILE in PARSE</a>
                        <meta itemprop='position' content='2'>
                      </div>
                </div>
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/BlackATTR'><span itemprop='name'>BlackATTR</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="1662.html">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-08-14T21:09:03Z' class='post-time'>
                    August 14, 2021,  9:09pm
                  </time>
                  <meta itemprop='dateModified' content='2021-08-14T21:09:03Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This is a good one. <img src="../../images/emoji/twitter/+1.png%3Fv=9" title=":+1:" class="emoji" alt=":+1:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="1662.html">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-08-15T05:55:35Z' class='post-time'>
                    August 15, 2021,  5:55am
                  </time>
                  <meta itemprop='dateModified' content='2022-07-12T12:58:40Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="BlackATTR" data-post="2" data-topic="1662">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="https://forum.rebol.info/user_avatar/forum.rebol.info/blackattr/40/204_2.png" class="avatar"> BlackATTR:</div>
<blockquote>
<p>This is a good one.</p>
</blockquote>
</aside>
<p>...indeed...</p>
<h2>...What a Success Story ANY Turned Out To Be!!  <img src="../../images/emoji/twitter/astonished.png%3Fv=9" title=":astonished:" class="emoji" alt=":astonished:">
</h2>
<p>The first place I thought to try it out was in REWORD, because I remembered it created a list of alternate patterns for what it was going to replace.  So if you say:</p>
<pre><code> reword/escape "a(thing)b(thing2)c" [thing "ALPHA" "thing2" "BETA"] ["(" ")"]
</code></pre>
<p>A simplified concept of the rules it built looked like:</p>
<pre><code>keyword-suffix-rules: [
    false
       |
    "thing" ")" (key: 'thing)
       |
    "thing2" ")" (key: "thing2")
]

match-rule: ["(" keyword-suffix-rules]
</code></pre>
<p><em>(If you're wondering why it's repeating the suffix ")" in each rule: the problem with putting it outside would be that "thing" would match "thing2" and then jump outside the rule block and see ")".  It would then be too late to consider thing2.)</em></p>
<p>So here we see that false match thing.  We can get rid of that, and the |, AND use UPARSE rule synthesis to get the <strong>key:</strong> on the outside!</p>
<pre><code>keyword-suffix-rules: [
    ["thing" ")" ('thing)]
    ["thing2" ")" ("thing2")]
]

match-rule: ["(", key: any (keyword-suffix-rules)]
</code></pre>
<h2>That's Nothing Compared To What It Did To Whitespace!</h2>
<p>Continuing to look at the "generated list of alternates" scenario, it's a HUGE win for whitespace, which generates two levels of selection... one at the category level, and then for the instructions in the category:</p>
<pre><code>any ([[
    [space]
    collect any [
        [keep just push space keep Number]
        [keep just duplicate-top lf space]
        [keep just duplicate-indexed tab space keep Number]
        [keep just swap-top-2 lf tab]
        [keep just discard-top lf lf]
        [keep just slide-n-values tab lf keep Number]
    ]
] [
    [tab space]
    collect any [
        [keep just add space space]
        ...
    ]
    ...
]])
</code></pre>
<p>That's the stuff!  No sign of those pesky | and the weird edge cases they introduce.</p>
<h2>But There Was A Surprise Application For ANY...</h2>
<p>What if you don't feel the | are just wrong for your generated expressions, but not  right for your source expression?</p>
<p>Let's say you're writing something with this kind of pattern:</p>
<pre><code>uparse data [while [not &lt;end&gt;] [
    ;
    ; Here are some comments about what we're doing here
    ; They might be long
    ;
    some "a", between "(" ")", '&lt;whatever&gt;
|
    ; It's not totally clear where to put that |.  Some people would put it
    ; aligned in the same column as the SOME, others would put it at
    ; indent level deeper.  But it's a non-sequitur
    ;
    x: [integer! | text!]
    keep (:[{Writing random code for an example is a pain} x])
|
    ; This could go on for a number of alternates, let's stop here.
    ; By the way, did you know there's a FAIL combinator now?  :-)
    ; It will set the `near` of the error message to the input position.
    ;
    fail "Tired of making things up, want to finish post"
]]
</code></pre>
<p><strong>This can be an application for ANY too!</strong>  Maybe you'd prefer to cluster your code in blocks and leave out the distracting <strong>|</strong>...</p>
<pre><code>uparse data [while [not &lt;end&gt;] [
    ;
    ; Here are some comments about what we're doing here
    ; They might be long
    ;
    [some "a", between "(" ")", '&lt;whatever&gt;]

    ; It's not totally clear where to put that |.  Some people would put it
    ; aligned in the same column as the SOME, others would put it at
    ; indent level deeper.  But it's a non-sequitur
    [
        x: [integer! | text!]
        keep (:[{Writing random code for an example is a pain} x])
    ]

    ; This could go on for a number of alternates, let's stop here.
    ; By the way, did you know there's a FAIL combinator now?  :-)
    ; It will set the `near` of the error message to the input position.
    ;
    fail "Tired of making things up, want to finish post"
]]
</code></pre>
<p><strong>I hadn't thought of that, so it being useful for this was a surprise.</strong></p>
<p>Note that you don't need to put the rules inside an ANY in BLOCK!s if they are single rules.  <strong><code>any [some "a" some "b"]</code></strong> is legal, not just <strong><code>any [[some "a"] [some "b"]]</code></strong>  The FAIL at the end there isn't in a block, for instance.</p>
<p><img src="../../images/emoji/twitter/partying_face.png%3Fv=9" title=":partying_face:" class="emoji only-emoji" alt=":partying_face:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
    </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
