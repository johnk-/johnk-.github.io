<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SET-WORD! To Initialize Locals In Function Specs? - #2 by hostilefork - Functions - AltRebol</title>
    <meta name="description" content="(cc: @IngoHohmann as you have had opinions on these kinds of things.) 
It seems it would be nice if you had the option of setting your locals when you define them. 
foo: func [
    arg1 [integer!]
    arg2 [text!]
    &amp;lt;l&amp;hellip;">
    <meta name="generator" content="Discourse 3.4.0.beta3-dev - https://github.com/discourse/discourse version 93983286b54a0e96b8073abce23f4566e9f296f7">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../2210.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_b36da8919caf93960d3b4470a90d0e79c6a110e2.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/checklist_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/footnote_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="footnote"  />
  <link href="https://forum.rebol.info/stylesheets/poll_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/spoiler-alert_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="spoiler-alert"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_bac9ab3eace9fe3f17026a3c4dbf25e3e9e1e9a0.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;SET-WORD! To Initialize Locals In Function Specs?&#39;" href="../2210.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/set-word-to-initialize-locals-in-function-specs/2210/2" />
<meta name="twitter:url" content="https://forum.rebol.info/t/set-word-to-initialize-locals-in-function-specs/2210/2" />
<meta property="og:title" content="SET-WORD! To Initialize Locals In Function Specs?" />
<meta name="twitter:title" content="SET-WORD! To Initialize Locals In Function Specs?" />
<meta property="og:description" content="When the higher-level FUNCTION code was removed, that removed the code for assigning default values to locals.  As I mentioned, it was done with GROUP!s:  /foo: function [arg1 arg2 &lt;local&gt; x y (1 + 2) z (null)] [...body...]  The way it worked was to augment the function&#39;s body:  /foo: function [arg1 arg2 &lt;local&gt; x y z] [    y: &#39;3    z: ~null~    (...body...) ]  It evaluated the expression once, and then used a ^META of the evaluation product as the thing to assign.  Native &lt;local&gt; Handling Bring..." />
<meta name="twitter:description" content="When the higher-level FUNCTION code was removed, that removed the code for assigning default values to locals.  As I mentioned, it was done with GROUP!s:  /foo: function [arg1 arg2 &lt;local&gt; x y (1 + 2) z (null)] [...body...]  The way it worked was to augment the function&#39;s body:  /foo: function [arg1 arg2 &lt;local&gt; x y z] [    y: &#39;3    z: ~null~    (...body...) ]  It evaluated the expression once, and then used a ^META of the evaluation product as the thing to assign.  Native &lt;local&gt; Handling Bring..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Functions" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2024-11-22T04:04:06+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../2210.html">SET-WORD! To Initialize Locals In Function Specs?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Functions</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='SET-WORD! To Initialize Locals In Function Specs?'>
      <link itemprop='url' href='../2210.html'>
      <meta itemprop='datePublished' content='2024-08-24T03:00:51Z'>
        <meta itemprop='articleSection' content='Functions'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' href='https://forum.rebol.info/u/hostilefork'>
          </span>
        <meta itemprop='text' content='(cc: @IngoHohmann as you have had opinions on these kinds of things.) 
It seems it would be nice if you had the option of setting your locals when you define them. 
foo: func [
    arg1 [integer!]
    arg2 [text!]
    &amp;lt;l&amp;hellip;'>

          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2024-11-22T04:04:06Z' class='post-time'>
                    November 22, 2024,  4:04am
                  </time>
                  <meta itemprop='dateModified' content='2024-11-22T10:08:10Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>When <a href="../../dropping-with-in-static/2335.html">the higher-level FUNCTION code</a> was removed, that removed the code for assigning default values to locals.</p>
<p>As I mentioned, it was done with GROUP!s:</p>
<pre><code>/foo: function [arg1 arg2 &lt;local&gt; x y (1 + 2) z (null)] [...body...]
</code></pre>
<p>The way it worked was to augment the function's body:</p>
<pre><code>/foo: function [arg1 arg2 &lt;local&gt; x y z] [
   y: '3
   z: ~null~
   (...body...)
]
</code></pre>
<p>It evaluated the expression once, and then used a ^META of the evaluation product as the thing to assign.</p>
<h2><a name="p-7926-native-local-handling-brings-long-desired-advantage-1" class="anchor" href="2.html#p-7926-native-local-handling-brings-long-desired-advantage-1"></a>Native <code>&lt;local&gt;</code> Handling Brings Long-Desired Advantage</h2>
<aside class="quote no-group quote-modified" data-username="hostilefork" data-post="1" data-topic="2210">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="../../../user_avatar/forum.rebol.info/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>As it so happens, there's potential to exploit this for efficiency. The frame mechanics have a slot for each local in the function archetype that currently just holds nothing (~ antiform), and it could hold this default value / expression. So it wouldn't just save on typing the local name and then later the name again and the expression...but you're avoiding the need to perform the evaluation to do the assignment on each call!</p>
</blockquote>
</aside>
<p>This theoretical advantage was not realized by the FUNCTION abstraction, as it was just injecting assignments into the body.</p>
<p>But now that the FUNC native is orchestrating the situation, the advantage is there.</p>
<h2><a name="p-7926-feature-question-multi-returns-2" class="anchor" href="2.html#p-7926-feature-question-multi-returns-2"></a>Feature Question: Multi-Returns</h2>
<p>When I brought up the question of <strong><code>[&lt;local&gt; word: expr]</code></strong> instead of <strong><code>[&lt;local&gt; word (expr)]</code></strong>, I didn't consider whether you could do multi-returns:</p>
<pre><code>/bar: function [arg &lt;local&gt; [begin end]: (find series "a")] [...]
</code></pre>
<p>First of all, I'm not certain that feels like it "belongs" in the spec.  <img src="../../../images/emoji/twitter/face_with_raised_eyebrow.png%3Fv=12" title=":face_with_raised_eyebrow:" class="emoji" alt=":face_with_raised_eyebrow:" loading="lazy" width="20" height="20"></p>
<p>Secondly, this would require some significant redesign.  <img src="../../../images/emoji/twitter/fearful.png%3Fv=12" title=":fearful:" class="emoji" alt=":fearful:" loading="lazy" width="20" height="20"></p>
<p>The problem is, that at the time of the spec processing, there's no object in existence to bind into and do such an evaluation.</p>
<p>So this would have to somehow collect the words inside the SET-BLOCK, save the expression, make the archetypal frame, bind into the <em>archetypal frame</em> and evaluate into its locals.</p>
<p>Continuing on this...</p>
<h2><a name="p-7926-set-words-not-being-bound-has-other-consequences-3" class="anchor" href="2.html#p-7926-set-words-not-being-bound-has-other-consequences-3"></a>SET-WORD!s Not Being Bound Has Other Consequences</h2>
<p>Evaluating the expression, and then writing it into a slot of a partially constructed archetypal FRAME! has other things that are ruled out:</p>
<aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="2210">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="../../../user_avatar/forum.rebol.info/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>What binding rules is it using? Could you initialize local3 and then say <strong><code>local4: (local2 * arg1)</code></strong>?</p>
<ul>
<li>Almost certainly not, and it would just be using the binding of the spec block</li>
</ul>
</blockquote>
</aside>
<p>So that can't work, because what's happening is that the expression is just being evaluated and put in a spot that represents local4.  No "SET" is actually happening, because there's no completed context to assign it to.</p>
<p>That rules out other ideas, like <a href="../../a-dream-for-debugging-generalized-accessors/2259.html">assigning an "accessor"</a>.</p>
<p>When put this way, it makes it seem like using a GROUP! is clearer, because it makes you aware that there's no actual SET-WORD! to assign to.</p>
<h2><a name="p-7926-does-this-suggest-a-redesign-is-needed-4" class="anchor" href="2.html#p-7926-does-this-suggest-a-redesign-is-needed-4"></a>Does This Suggest A Redesign Is Needed?</h2>
<p>The system <em>could</em> generate the archetypal frame, with nothing in the local slots, and then bind the expressions into it and run them...just as they would run had it been an instantiated function.</p>
<p>So this would be a two-phase thing, that would enable things like multi-returns, accessors, weird-infix-functions that capture the thing they're assigning to in order to know their names...etc.</p>
<p><strong>It's definitely a lot more than I bargained for when I suggested the feature.</strong>  So what would happen here is that only a subset would be implemented, with the rest being done at a future date...</p>
<p><strong>What it does point out is the set of things that the GROUP!-based syntax cannot do.</strong></p>
<pre><code> /foo: function [arg1 arg2 &lt;local&gt; x y (1 + 2) z (null)] [...body...]
</code></pre>
<p>So the big question is whether that's by design ("we don't plan to implement anything more, it's a simple low-hanging fruit you can take advantage of if it fits")... or if it's too limited.</p>
<h2><a name="p-7926-then-is-freeform-dialecting-good-5" class="anchor" href="2.html#p-7926-then-is-freeform-dialecting-good-5"></a>Then... Is Freeform Dialecting Good?</h2>
<p>It forces the question of "is the word and set-word mix good"</p>
<pre><code> /foo: function [arg1 arg2 &lt;local&gt; x y: 1 + 2 z: null] [...body...]
</code></pre>
<p><em>Instinctually, I feel uneasy about that.</em></p>
<p>If we went that direction, I'd kind of rather have all the locals be SET-WORD!, and allow you to chain the assignments:</p>
<pre><code> /foo: function [arg1 arg2 &lt;local&gt; x: y: z: ~] [...body...]
</code></pre>
<p>I think that if people were hinted that they <em>could</em> assign the locals there, and if they found out this gave them an efficiency boost, the feature might be taken advantage of more.</p>
<p>But they would not be able to be assigned in terms of arguments, so that's a limitation.</p>
<p>And if it's going to be limited anyway, might it be best to let people in on the limitations and just keep it as WORD! plus GROUP! ?</p>
<h2><a name="p-7926-leaning-to-stick-with-word-optional-group-6" class="anchor" href="2.html#p-7926-leaning-to-stick-with-word-optional-group-6"></a>Leaning To: Stick With WORD! + optional GROUP!</h2>
<p>Really, what we're talking about here is an optimization.</p>
<ol>
<li>
<p>If a local wants a fixed value upon entry to the function on each call, that fixed value can be stored by the archetypal frame and copied into a new instance's cell, at the same cost that initializing it with nothing would cost.</p>
</li>
<li>
<p>If you are initializing a local in such a way, you don't have to repeat its name to initialize it... because you're putting the initial value beside it.</p>
</li>
</ol>
<p>If the function creation process becomes two-pass, doing strange bindings/etc., you're starting to drift from the "optimizing" part of the optimization.  And I'm concerned about the complexity cost of that code.  Thinking about it now, there are details to where I'm not sure how it would work.</p>
<p>Evaluating a GROUP! and dropping its value into the slot of an incomplete archetype you're building is cheap-as-free, and not complicated.</p>
<p>It's a natural extension of just listing out locals as words, and I think it turns out to probably be for the best.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../dropping-with-in-static/2335/3.html">Dropping `&lt;with&gt;`, `&lt;in&gt;`, `&lt;static&gt;`</a>
                        <meta itemprop='position' content='3'>
                      </div>
                </div>
          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../2210.html#post_2">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
