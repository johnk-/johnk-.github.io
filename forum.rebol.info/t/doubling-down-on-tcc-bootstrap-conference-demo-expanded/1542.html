<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Doubling-Down on TCC Bootstrap: Conference Demo Expanded! - Language Bridging - AltRebol</title>
    <meta name="description" content="cc: interested irregular forum readers, or, at least irregular posters... (e.g. @MarkI, @giluiolunati) 
In doing some prioritization, I posted about putting aside FFI, ZeroMQ, and the Serial port...since none of those ar&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://forum.rebol.info/t/doubling-down-on-tcc-bootstrap-conference-demo-expanded/1542" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_cdfbc200d3f5311dbee0f69ae668cfc42cfc8cb7.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_7b2b5b1bc734c2cc3b6ad5e0f49f467e8601ef2c.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Doubling-Down on TCC Bootstrap: Conference Demo Expanded!&#39;" href="1542.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/doubling-down-on-tcc-bootstrap-conference-demo-expanded/1542" />
<meta name="twitter:url" content="https://forum.rebol.info/t/doubling-down-on-tcc-bootstrap-conference-demo-expanded/1542" />
<meta property="og:title" content="Doubling-Down on TCC Bootstrap: Conference Demo Expanded!" />
<meta name="twitter:title" content="Doubling-Down on TCC Bootstrap: Conference Demo Expanded!" />
<meta property="og:description" content="cc: interested irregular forum readers, or, at least irregular posters... (e.g. @MarkI, @giluiolunati)  In doing some prioritization, I posted about putting aside FFI, ZeroMQ, and the Serial port...since none of those are particularly mission-critical.  They did exercise some code, but they no longer represented any particular exercise that wasn&#39;t already covered elsewhere.  Limited efforts are better focused on things that will matter to more people (e.g. the web build).  But one effort that is..." />
<meta name="twitter:description" content="cc: interested irregular forum readers, or, at least irregular posters... (e.g. @MarkI, @giluiolunati)  In doing some prioritization, I posted about putting aside FFI, ZeroMQ, and the Serial port...since none of those are particularly mission-critical.  They did exercise some code, but they no longer represented any particular exercise that wasn&#39;t already covered elsewhere.  Limited efforts are better focused on things that will matter to more people (e.g. the web build).  But one effort that is..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="4 ❤" />
<meta property="article:published_time" content="2021-03-06T04:34:42+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="https://forum.rebol.info/t/doubling-down-on-tcc-bootstrap-conference-demo-expanded/1542">Doubling-Down on TCC Bootstrap: Conference Demo Expanded!</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/language-bridging/35" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Language Bridging</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/doubling-down-on-tcc-bootstrap-conference-demo-expanded/1542">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2021-03-06T04:34:42Z'>
              <time itemprop='dateModified' datetime='2021-03-06T05:54:39Z' class='post-time'>
                March 6, 2021,  5:54am
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><em>cc: interested irregular forum readers, or, at least irregular posters... (e.g. <span class="mention">@MarkI</span>, <span class="mention">@giluiolunati</span>)</em></p>
<p>In doing some prioritization, I posted about putting aside FFI, ZeroMQ, and the Serial port...since none of those are particularly mission-critical.  They did exercise some code, but they no longer represented any particular exercise that wasn't already covered elsewhere.  Limited efforts are better focused on things that will matter to more people (e.g. the web build).</p>
<p><strong>But one effort that is a big deal that I wanted to preserve is the TCC Extension, as well as the concept of being able to build the interpreter itself with TCC.</strong>  As I demonstrated in July 2019, those two things add up to being able to download the source code and bootstrap a new interpreter with no build tools on your system besides a single "r3-with-tcc" executable<sup><strong>1</strong></sup>.</p>
<p><em>(1) Well, you need the libc headers and include files and libs for your OS.  Things we require like <code>&lt;string.h&gt;</code>.  If we wanted to be masochistic, we could get into the business of zipping those up and either pulling them off the web via TLS/HTTPS/Unzip.reb or encapping them into the executable.  If we were to do this, we should look into doing it with <a href="https://musl.libc.org/about.html">musl</a> and not the likes of GNU's glibc.</em></p>
<p>So I slogged through to make a turnkey version of <a href="https://youtu.be/PT3GOe1pj9I?t=163">the conference demo</a>.  It's new and improved, and you can run it right from your Linux desktop, if you feel like it.</p>
<h2>Single-EXE Bootstrap...Now Reproduced As A GitHub Action!</h2>
<p>It's now more streamlined...automated, reproducible, and broken into sections.  You can see these sections in the GitHub continuous integration run:</p>
<p><strong><a href="https://github.com/metaeducation/ren-c/runs/2044725810">https://github.com/metaeducation/ren-c/runs/2044725810</a></strong></p>
<p>The script behind this is really just doing a few basic steps, which I will paraphrase here:</p>
<pre><code> # Install TCC and the libraries for embedding TCC services into C programs
 sudo apt install tcc libtcc-dev

 # Use TCC (and prebuilt R3 as make tool) to build a TCC-capable interpreter
 $R3_MAKE make.r config=configs/tcc.r extensions="TCC +"

 # Keep just the executable we made (call it r3-with-tcc for clarity)
 cp build/r3 ./r3-with-tcc

 # Now, you can throw away the prebuilt R3_MAKE tool and TCC executable
 rm $R3_MAKE
 sudo apt remove tcc  # keep the `libtcc-dev` for embedding TCC in C programs

 # Delete the source code that was cloned via git
 rm &lt;all the sources&gt;

 # Now use the sole executable to bootstrap itself, pulling the source code
 # down from GitHub over HTTPS as a .ZIP, unzipping it with the embedded
 # unzip.r, and rigging up the r3-with-tcc executable to act as an impromptu
 # interpreter of C99 command lines.
 ./r3-with-tcc "bootstrap"
</code></pre>
<p>After doing basically just that, your build/r3 is now a newly minted r3-with-tcc...which could continue doing this bootstrap process indefinitely!</p>
<p>You can read the actual workflow script here: <a href="https://github.com/metaeducation/ren-c/blob/master/.github/workflows/tcc-build.yml">%tcc-build.yml</a></p>
<p>It does a few more things, including using the "build matrix" to do one run with <code>debug=none</code> and another with <code>debug=normal</code>.  It runs a few tests, but the real big test here is just the build in and of itself!  That exercises an insane amount of code.</p>
<h2>More Rigorous Than The Conference Demo</h2>
<p>This took a couple days of pretty intense work.  I'd sort of hacked the demo together the day before the conference, so it needed to be made less ad-hoc.  But also, there have been some changes which needed to be worked through...mbedTLS wasn't being used in 2019, so it hadn't been run through this.  There are little issues that come up with new things.</p>
<p>Plus, I started the presentation with a prebuilt r3-with-tcc that I used...but I had built that using GCC (not TCC).  And I didn't build the TCC extension into the bootstrapped executable, so it would not be capable of continuing the process.  There wasn't any demo of this being a "sustainable" bootstrap.</p>
<p>But here it is, done legit.</p>
<h2>Lots Still To Do...</h2>
<p>We're well aware that Rebmake is a beast, <a href="https://forum.rebol.info/t/new-build-executables-new-build-strategy/1432">and something needs to be done about that</a>.  But seeing one make tool written entirely in Ren-C points to the idea that it could be improved.  It sets a baseline and we can just keep aiming for it.</p>
<p>Performance is getting pretty bad, due to virtual binding and LET and other things that are still getting hammered out.  And that needs to be attacked, but the user experience has to be reasoned through completely first.  Once we decide something is simply not the way things should work--like FUNCTION auto-gathering SET-WORD!s deeply through the body--then trying other approaches is the only sane response.  <em>(If there's advantages to plunging forward with known broken things just for the sake of being first-to-market, Rebol2 would have found them...or Red will be finding them... <span class="hashtag">#goodluckwiththat</span>)</em>.  Outside of the performance issues, LET is looking mostly promising.</p>
<p>But the more we can hone this experience, I think the better the system coheres on its message, and so I'm comfortable with pushing this through and taking the time to do it.</p>
        </div>

        <meta itemprop='headline' content='Doubling-Down on TCC Bootstrap: Conference Demo Expanded!'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../goodbye-travis-but-its-not-all-despair/1421/5.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forum.rebol.info/t/goodbye-travis-but-its-not-all-despair/1421/5'>
                      <span itemprop='name'>Goodbye, Travis. (But it&#39;s not all despair.)</span>
                    </a>
                    <meta itemprop='position' content='6'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../androids-back-modernized-and-with-continuous-integration/1544.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forum.rebol.info/t/androids-back-modernized-and-with-continuous-integration/1544'>
                      <span itemprop='name'>Android&#39;s Back! Modernized, and With Continuous Integration</span>
                    </a>
                    <meta itemprop='position' content='7'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/doubling-down-on-tcc-bootstrap-conference-demo-expanded/1542">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2022-09-14T22:00:58Z' class='post-time'>
                September 14, 2022, 10:00pm
              </time>
              <meta itemprop='dateModified' content='2022-09-14T22:00:58Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I'd allowed the TCC bootstrap to lapse...because holding up progress at intermediate states for a demo like this doesn't always make sense.</p>
<p>But taking too long to get back to it doesn't make sense, either.  Because if you wait too long, it becomes a massive effort to resurrect it.</p>
<p><strong>However, it's resurrected now.</strong></p>
<p>Doing so exposed a bug in REMOVE where if the /PART was before the input series position it wasn't acting correctly (R3-Alpha and Rebol2 would just adjust it and flip the input with the /PART, so it didn't matter).  So I brought it in line with that behavior.</p>
<h2>TCC Doesn't Stand Still (but their VERSION stamp does...)</h2>
<p>The most problematic TCC change to absorb is that they added a warning for when it seems like a C function was written without returning a value.</p>
<p>This happens on purpose sometimes--when a function jumps the stack (like a failure interrupting the control flow and using an exception or a longjmp...or if you call exit() to end a process).  The function won't return in such cases.</p>
<p>So there are ways of saying "I know this function doesn't return"...although it's been frustratingly nonstandard.  Eventually C11 standardized it as a <strong><code>_Noreturn</code></strong>  signal you can put on things...and if it doesn't interfere with existing uses of the symbol "noreturn" you can <strong><span class="hashtag">#define</span> noreturn _Noreturn</strong> to make it look better.</p>
<p>But... they added both an ornery warning and the _Noreturn feature... without giving code any way to detect these things showing up.  In fact, they haven't updated the VERSION stamp you can test while compiling since 2017:</p>
<p><a href="https://repo.or.cz/tinycc.git/history/HEAD:/VERSION" class="inline-onebox">Public Git Hosting - tinycc.git/log - VERSION</a></p>
<p>I worked around it just by suppressing that particular warning when we embed the compiler.</p>
<h2>Did Bringing It Up To Date Raise Any Thoughts?</h2>
<p>Well one good thought is that Ren-C still does all its magic with nothing more than C99.  This is really what building with TCC is about--a bounded measure of the complexity footprint required, vs. anything particularly important or necessary about a TCC build in and of itself.</p>
<p>Another good thought is that the language is really improving.  The parse rules are better...passing integers to SKIP instead of having it being 0-arity...etc.  If I have to change something, I don't see many instances where I feel regret.</p>
<p><em>Things are definitely getting too slow.</em>  This just happens naturally over time as you work on a design and don't do any performance work.  It's around the right time to start looking at it.</p>
<p><em>Error reporting is definitely bad.</em>  If you're not me, then there are a lot of errors you don't have much of a shot at understanding.  And the only reason I can understand it is that I can set a breakpoint in the debugger and look around at the environment where the error is raised...and get some intuition about it.  When I use TCC there's more pain on that, because they don't generate usable debug and symbol information.  (or at least not historically, I guess I should check).</p>
<p>But I think what I do is probably a good model for error introspection that should be available in usermode.  When an error is about to be raised we should plop you in the console right there to look at it--inspect variables--and figure it out yourself.</p>
<p>There's a long way to go here--but--it's good to keep everything working.</p>
        </div>

        <meta itemprop='headline' content='Doubling-Down on TCC Bootstrap: Conference Demo Expanded!'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
