<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Function Spec Dialect: Who Should Analyze It, And How? - #2 by hostilefork - Help System - AltRebol</title>
    <meta name="description" content="When you supplied a function spec block in R3-Alpha, it would preserve that spec as a copy of whatever was passed to the low-level MAKE FUNCTION! call.  You could get it back with SPEC-OF.  (If your code was abstract and&amp;hellip;">
    <meta name="generator" content="Discourse 3.4.0.beta3-dev - https://github.com/discourse/discourse version 93983286b54a0e96b8073abce23f4566e9f296f7">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../1223.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_b36da8919caf93960d3b4470a90d0e79c6a110e2.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/checklist_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/footnote_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="footnote"  />
  <link href="https://forum.rebol.info/stylesheets/poll_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/spoiler-alert_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="spoiler-alert"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_bac9ab3eace9fe3f17026a3c4dbf25e3e9e1e9a0.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Function Spec Dialect: Who Should Analyze It, And How?&#39;" href="../1223.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/function-spec-dialect-who-should-analyze-it-and-how/1223/2" />
<meta name="twitter:url" content="https://forum.rebol.info/t/function-spec-dialect-who-should-analyze-it-and-how/1223/2" />
<meta property="og:title" content="Function Spec Dialect: Who Should Analyze It, And How?" />
<meta name="twitter:title" content="Function Spec Dialect: Who Should Analyze It, And How?" />
<meta property="og:description" content="This is coming closer and closer to reality.  You&#39;ve been able to go both ways for a while now: either MAKE FRAME! from an ACTION!. or MAKE ACTION! from a FRAME!.  But I&#39;ve managed to do some changes that make this process more fluid and less expensive.  How much less expensive?  MAKE ACTION! from any FRAME! now creates an entity that takes up just 8 platform pointers.  Before, creating actions always required creating a new parameter list to serve as the action&#39;s identity...so how much it cost..." />
<meta name="twitter:description" content="This is coming closer and closer to reality.  You&#39;ve been able to go both ways for a while now: either MAKE FRAME! from an ACTION!. or MAKE ACTION! from a FRAME!.  But I&#39;ve managed to do some changes that make this process more fluid and less expensive.  How much less expensive?  MAKE ACTION! from any FRAME! now creates an entity that takes up just 8 platform pointers.  Before, creating actions always required creating a new parameter list to serve as the action&#39;s identity...so how much it cost..." />
<meta property="og:article:section" content="Domains" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:section" content="Help System" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="article:published_time" content="2020-11-30T20:51:53+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../1223.html">Function Spec Dialect: Who Should Analyze It, And How?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/discoverability/51" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/discoverability/51" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Help System</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Function Spec Dialect: Who Should Analyze It, And How?'>
      <link itemprop='url' href='../1223.html'>
      <meta itemprop='datePublished' content='2019-10-06T08:44:49Z'>
        <meta itemprop='articleSection' content='Help System'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' href='https://forum.rebol.info/u/hostilefork'>
          </span>
        <meta itemprop='text' content='When you supplied a function spec block in R3-Alpha, it would preserve that spec as a copy of whatever was passed to the low-level MAKE FUNCTION! call.  You could get it back with SPEC-OF.  (If your code was abstract and&amp;hellip;'>

          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-11-30T20:51:53Z' class='post-time'>
                    November 30, 2020,  8:51pm
                  </time>
                  <meta itemprop='dateModified' content='2020-11-30T20:51:53Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="1223">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="../../../user_avatar/forum.rebol.info/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>But what I think the central point is, is that the interpreter core and "function spec blocks" are getting an increasingly distant relationship. I think that's a good thing, and I foresee something more like the post I made where parameter descriptions and HELP information are completely divorced from the language used to ask the core to make a function.</p>
</blockquote>
</aside>
<p><strong>This is coming closer and closer to reality.</strong></p>
<p>You've been able to go both ways for a while now: either MAKE FRAME! from an ACTION!. or MAKE ACTION! from a FRAME!.  But I've managed to do some changes that make this process more fluid and less expensive.</p>
<p>How much less expensive?  <em>MAKE ACTION! from any FRAME! now creates an entity that takes up just 8 platform pointers.</em>  Before, creating actions always required creating a new parameter list to serve as the action's identity...so how much it cost would depend on how many arguments and locals you had.  You'd need the same 8 platform pointers...plus 8 more platform pointers (archetype and end), plus 4 platform pointers per argument or local...plus round up for fitting in a memory pool.</p>
<p>This does make it very appealing to start thinking of making functions in a fast and direct way that doesn't necessarily go through any "spec parsing"... <em>and the spec language would no longer be built into the interpreter or evaluator</em>.</p>
<h2><a name="p-4348-lots-of-open-questions-though-1" class="anchor" href="2.html#p-4348-lots-of-open-questions-though-1"></a>Lots of Open Questions, Though.</h2>
<p>Right now, you have a chicken-and-egg problem when it comes to making ACTION!s out of FRAME!s... because the only way to get a FRAME! is from an existing ACTION! (which has encoded knowledge of what's a refinement, argument, local, quoted argument, etc.)</p>
<p>What will it take to be able to MAKE FRAME! from scratch, with information beyond just the key names?  And how do you give the frame <em>behavior</em>?</p>
<p>Brainstorming here: Perhaps it's a two step process, where making a frame from a BLOCK! sets up the parameterization with no initial behavior outside of type-checking.  Then you adapt it:</p>
<pre><code> frame: make frame! [
     return: &lt;return&gt;
     arg1: integer!, arg2: integer!
     hide local1: ~undefined~
 ]
 add-nums: adapt (make action! frame) [
     local1: arg1 + arg2
     return local1
 ]
</code></pre>
<p>That's a rough idea with a lot of hand-waving, but maybe it's pointing in a useful direction.  And even a weird notion that the non-hidden contents of frame values are their parameter gathering disposition...so if you ever wanted to specialize something, you'd actually hide it.</p>
<pre><code>&gt;&gt; f: make frame! :append
== make frame! [
    series: [any-series! port! map! object! module! bitset!]
    value: [&lt;opt&gt; any-value!]
    part: [any-number! any-series! pair!]
    only: []
    dup: [any-number! pair!]
    line: []
]

&gt;&gt; hide f/dup: 2  ; hiding means frame content is value, no longer typecheck
&gt;&gt; f/value: [integer!]  ; not hiding, so adjusting typecheck
&gt;&gt; ap2int: make action! f

&gt;&gt; ap2int [a b c] 10
== [a b c 10 10]

&gt;&gt; ap2int [a b c] "illegal"
** Error: ap2int doesn't allow TEXT! for its VALUE argument
</code></pre>
<p>Anyway, just trying to push a little of this thinking forward as to more what it might look like.  One way or another, I see FRAME! moving to a role of structural primacy in the evaluator...with spec blocks and their variations being designed to match the needs of their uses.</p>
<h2><a name="p-4348-some-more-details-on-new-efficiencies-2" class="anchor" href="2.html#p-4348-some-more-details-on-new-efficiencies-2"></a>Some More Details on New Efficiencies</h2>
<p>Without belaboring too many details of recent housecleaning...I've managed to align the workings of contexts and actions a bit better:</p>
<ul>
<li>
<p>Since the beginning of FRAME!, parameter lists of actions have been able to serve as the "keylist" of contexts.  But they were also acting as the identities of functions.  This meant every time you would ADAPT or SPECIALIZE something with 13 arguments and locals...you'd have to copy that 13-long array to get a new identity.</p>
</li>
<li>
<p>In the beginning, a frame was dependent on being able to glean an action's specific identity from the paramlist...because that's the only pointer it had.  As the design of "phase" information in the FRAME! cell got further along, this was no longer needed; the function identity could be known every step of the composition just by the phase.</p>
</li>
<li>
<p>Other changes consolidated that the paramlist no longer needed to be the identity of an action, and could thus be shared between them...with another array holding instance information about the action (such as the body block to run) being the identity.</p>
</li>
</ul>
<p>Not quite finished, but largely a clarifying change that reduces memory footprint.  Some performance work will be needed since it has to do calculations to find things that used to be closer at hand, but I don't think it should be too bad.  Biggest impact is that some of the <a href="../../advancements-in-information-hiding-sealed-frame-members/1396.html">parameter hiding</a> was based on having new paramlists at each level, so it will have to be seen if frame phasing can achieve the same effect...or if it's an acceptable loss to not hide access to locals in some cases (like ADAPT)</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../1223.html#post_2">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
