<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>TRANSCODE and LOAD Multi-Return Improvements - Show &amp; Tell - AltRebol</title>
    <meta name="description" content="TRANSCODE and LOAD were two of the first routines that took advantage of multi-returns, and showed a real cleanup.  To keep a writeup chronicling the development of multi-returns more focused, I&amp;#39;m moving the part where I&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="https://forum.rebol.info/uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="https://forum.rebol.info/uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://forum.rebol.info/t/transcode-and-load-multi-return-improvements/1925" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="https://forum.rebol.info/opensearch.xml" title="AltRebol Search">

      <link href="/stylesheets/desktop_cdfbc200d3f5311dbee0f69ae668cfc42cfc8cb7.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="/stylesheets/desktop_theme_2_7b2b5b1bc734c2cc3b6ad5e0f49f467e8601ef2c.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;TRANSCODE and LOAD Multi-Return Improvements&#39;" href="https://forum.rebol.info/t/transcode-and-load-multi-return-improvements/1925.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/transcode-and-load-multi-return-improvements/1925" />
<meta name="twitter:url" content="https://forum.rebol.info/t/transcode-and-load-multi-return-improvements/1925" />
<meta property="og:title" content="TRANSCODE and LOAD Multi-Return Improvements" />
<meta name="twitter:title" content="TRANSCODE and LOAD Multi-Return Improvements" />
<meta property="og:description" content="TRANSCODE and LOAD were two of the first routines that took advantage of multi-returns, and showed a real cleanup.  To keep a writeup chronicling the development of multi-returns more focused, I&#39;m moving the part where I sing the praises of the improvements to its own Show &amp; Tell thread!   [...In April 2020...] I was looking at TRANSCODE, which is a fairly complex in terms of its parameterization.  This is the basic routine that exposes the scanner and turns UTF-8 into Rebol values.  (Cool siden..." />
<meta name="twitter:description" content="TRANSCODE and LOAD were two of the first routines that took advantage of multi-returns, and showed a real cleanup.  To keep a writeup chronicling the development of multi-returns more focused, I&#39;m moving the part where I sing the praises of the improvements to its own Show &amp; Tell thread!   [...In April 2020...] I was looking at TRANSCODE, which is a fairly complex in terms of its parameterization.  This is the basic routine that exposes the scanner and turns UTF-8 into Rebol values.  (Cool siden..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 ❤" />
<meta property="article:published_time" content="2020-04-10T20:20:05+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="/">
          <img src="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="/t/transcode-and-load-multi-return-improvements/1925">TRANSCODE and LOAD Multi-Return Improvements</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/usage/7" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #3AB54A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Usage</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/usage/show-and-tell/33" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #3AB54A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Show &amp; Tell</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/transcode-and-load-multi-return-improvements/1925">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-04-10T20:20:05Z'>
              <time itemprop='dateModified' datetime='2022-08-19T14:46:42Z' class='post-time'>
                August 19, 2022,  2:46pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><em>TRANSCODE and LOAD were two of the first routines that took advantage of multi-returns, and showed a real cleanup.  To keep a writeup chronicling the development of multi-returns more focused, I'm moving the part where I sing the praises of the improvements to its own Show &amp; Tell thread!</em></p>
<hr>
<p>[...In April 2020...] I was looking at TRANSCODE, which is a fairly complex in terms of its parameterization.  This is the basic routine that exposes the scanner and turns UTF-8 into Rebol values.  <em>(Cool sidenote: in Ren-C with UTF-8 Everywhere you can now use it on strings, while R3-Alpha could only use it on binaries...)</em></p>
<p>A typical TRANSCODE operation turns a string into a block, so conceptually:</p>
<pre><code> &gt;&gt; transcode "1 [2] &lt;3&gt;"
 == [1 [2] &lt;3&gt;]

 &gt;&gt; transcode "[1 [2] &lt;3&gt;]"
 == [[1 [2] &lt;3&gt;]]   ; always a block of values, even if only one block value
</code></pre>
<p>Sometimes people want to transcode just one value at a time, so there is TRANSCODE/NEXT.  As with DO/NEXT, this introduces another useful output... which is where you want to write the advanced position to do further processing.  Let's look at it in that old style (none of this is real code in Ren-C, so just read it, don't run it):</p>
<pre><code> &gt;&gt; transcode/next "1 [2] &lt;3&gt;" 'new-pos
 == 1

 &gt;&gt; new-pos
 == "[2] &lt;3&gt;"
</code></pre>
<p>There's yet another potential output variation coming from the /RELAX switch.  This means that if you have gibberish, it will skip that token and return an ERROR! value:</p>
<pre><code> &gt;&gt; transcode/next/relax "4bad [2] &lt;3&gt;" 'new-pos
 == make error! [...whatever...]

 &gt;&gt; new-pos
 == "[2] &lt;3&gt;"
</code></pre>
<p>That's not ideal, as with some kind of ANY-CONTEXT! literal solution you might actually find an ERROR! value in a scan.</p>
<h3><a href="https://forum.rebol.info/t/multiple-return-values/1134/6">Then Multi-Returns Were Re-Conceived As Refinement Doppelgangers</a></h3>
<p>The way you would do a multi-return is to mark a parameter a "return" parameter, e.g. an output.  The parameter is set either to null, or something to assign--like a refinement--in order to indicate it is requested.  Then at the end of the function when it tears down the frame, those values are set.</p>
<p>So this way if you have a WORD! or PATH! you want to assign, you can pass it in as an argument.  But if you use the multi-return convention, it will implicitly load those slots with variables out of the block on the left.</p>
<p>That means these two situations would appear equivalent to the insides of TRANSCODE:</p>
<pre><code>&gt;&gt; value: transcode/next/relax "1 [2] &lt;3&gt;" 'next-pos 'error

&gt;&gt; [value next-pos error]: transcode "1 [2] &lt;3&gt;"
</code></pre>
<p>And then, these two would appear equivalent:</p>
<pre><code>&gt;&gt; value: transcode/relax "1 [2] &lt;3&gt;" 'error

&gt;&gt; [value _ error]: transcode "1 [2] &lt;3&gt;"
</code></pre>
<p>This means that there needs to be a way of marking arguments as returns in the function spec, and their order matters (just as order of ordinary arguments matters).</p>
<p>It was a great duality, giving you the option to work with named arguments if you want, but provides a shorthand...where SET-BLOCK! collaborates with the evaluator to push into those slots.</p>
<p><strong>It was quite amazing to see <a href="https://github.com/metaeducation/ren-c/blob/5d70aa4a85dbe3a831653e14b72117e90997fa09/tests/string/transcode.test.reb">the benefits to TRANSCODE right off the bat</a>!</strong></p>
<h2><a href="https://github.com/metaeducation/ren-c/commit/072e932260af3e9bd31fd0092ac80aeedb38139c">Then I repeated the success with LOAD...</a></h2>
<p>If you want a header you can just say:</p>
<pre><code>[data header]: load %some-file.reb
</code></pre>
<p>And if you don't want a header, you just say <strong>data: load %some-file.reb</strong> as normal.  This replaces the way the output <em>changed</em> in historical Rebol, where LOAD sometimes returned a BLOCK! with a header as the second item, and sometimes it did not.</p>
<pre><code>rebol2&gt;&gt; load {[Rebol [Title: "hi"] a b c]}
== [a b c]

rebol2&gt;&gt; load/header {[Rebol [Title: "hi"] a b c]}
== [make object! [
        Title: "hi"
        Date: none
        Name: none
        Version: none
        ; ...etc, etc...
        Language: none
        Type: none
        Content: none
    ] a b c
]
</code></pre>
<p>What's also an improvement by setting variables directly over the BLOCK! approach is that you don't have to put BLANK! in a slot, you can really return NULL:</p>
<pre><code>&gt;&gt; [data header]: load "&lt;no&gt; #header 'here"
== [&lt;no&gt; #header 'here]

&gt;&gt; data
== [&lt;no&gt; #header 'here]

&gt;&gt; header
; null
</code></pre>
<hr>
<p><em>Note: This was another change powered by <a href="https://forum.rebol.info/t/pure-and-refined-simplifying-refinements-to-one-or-zero-args/1120">Pure and Refined</a>...simplifying the nature of arguments in frames down to one-name-per argument and one-value-per lets us play with this equivalence.  We can imagine function frames expanding via AUGMENT to add new return values, too...</em></p>
        </div>

        <meta itemprop='headline' content='TRANSCODE and LOAD Multi-Return Improvements'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="https://forum.rebol.info/t/multiple-return-values/1134/8" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forum.rebol.info/t/multiple-return-values/1134/8'>
                      <span itemprop='name'>The History of Multi-Return in Ren-C</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/BlackATTR'><span itemprop='name'>BlackATTR</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/transcode-and-load-multi-return-improvements/1925">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-04-09T00:03:18Z'>
              <time itemprop='dateModified' datetime='2022-08-19T14:32:06Z' class='post-time'>
                August 19, 2022,  2:32pm
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Very cool. Thank you— I can see this being really useful for dialects (being coerced out of text, which is relevant for me), and almost anything which helps dialects is a good thing, in my opinion.</p>
        </div>

        <meta itemprop='headline' content='TRANSCODE and LOAD Multi-Return Improvements'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="https://forum.rebol.info/t/multiple-return-values/1134/7" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forum.rebol.info/t/multiple-return-values/1134/7'>
                      <span itemprop='name'>The History of Multi-Return in Ren-C</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
