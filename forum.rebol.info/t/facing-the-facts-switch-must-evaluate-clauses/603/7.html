<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Facing the facts: SWITCH must evaluate clauses - #7 - Internals - AltRebol</title>
    <meta name="description" content="I know the audience for my findings is, a small and self-selected one.  But still… 
don’t shoot the messenger: 
x: 304
switch x [
   300 + 4 [
       print &amp;quot;if things worked right, this would print&amp;quot;
   ]
   ...
]

Of cou&amp;hellip;">
    <meta name="generator" content="Discourse 3.1.0.beta4 - https://github.com/discourse/discourse version 25276f62f959eab4557049a655300a70835c5769">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="../../../stylesheets/color_definitions_base__2_caa66e77e807fc270e5b21d201643962219b6a9a.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="../../../stylesheets/desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="../../../stylesheets/chat_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="chat"  />
  <link href="../../../stylesheets/discourse-details_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="../../../stylesheets/discourse-lazy-videos_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="../../../stylesheets/discourse-local-dates_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="../../../stylesheets/discourse-narrative-bot_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="../../../stylesheets/discourse-presence_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="../../../stylesheets/docker_manager_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="../../../stylesheets/poll_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="poll"  />
  <link href="../../../stylesheets/chat_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="../../../stylesheets/poll_desktop_97f5da14b02e14a864d77b6d983a33a1b302f894.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../../stylesheets/desktop_theme_2_5e18a6fac02b6ab11e33445179f4a2961aadbfd8.css%3F__ws=forum.rebol.info.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Facing the facts: SWITCH must evaluate clauses&#39;" href="../603.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603/7" />
<meta name="twitter:url" content="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603/7" />
<meta property="og:title" content="Facing the facts: SWITCH must evaluate clauses" />
<meta name="twitter:title" content="Facing the facts: SWITCH must evaluate clauses" />
<meta property="og:description" content="I know the audience for my findings is, a small and self-selected one.  But still...  don&#39;t shoot the messenger:  x: 304 switch x [    300 + 4 [        print &quot;if things worked right, this would print&quot;    ]    ... ]  Of course that is not the case in Rebol2/etc.  You get instead the likes of:   switch &#39;+ [      300 + 4 [          print &quot;this will print in R3-Alpha/Rebol2/Red, and it is misguided&quot;      ]      ...  ]  Mechanically speaking, it is possible for SWITCH to discern a BLOCK! it evaluated..." />
<meta name="twitter:description" content="I know the audience for my findings is, a small and self-selected one.  But still...  don&#39;t shoot the messenger:  x: 304 switch x [    300 + 4 [        print &quot;if things worked right, this would print&quot;    ]    ... ]  Of course that is not the case in Rebol2/etc.  You get instead the likes of:   switch &#39;+ [      300 + 4 [          print &quot;this will print in R3-Alpha/Rebol2/Red, and it is misguided&quot;      ]      ...  ]  Mechanically speaking, it is possible for SWITCH to discern a BLOCK! it evaluated..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Internals" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2018-05-05T19:06:58+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="../../../index.html">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../603.html">Facing the facts: SWITCH must evaluate clauses</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/development/internals.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Internals</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Facing the facts: SWITCH must evaluate clauses'>
        <meta itemprop='articleSection' content='Internals'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-05-05T19:06:58Z' class='post-time'>
                    May 5, 2018,  7:06pm
                  </time>
                  <meta itemprop='dateModified' content='2018-05-05T20:33:42Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p>I know the audience for my findings is, a small and self-selected one.  But still...</p>
<p>don't shoot the messenger:</p>
<pre><code>x: 304
switch x [
   300 + 4 [
       print "if things worked right, this would print"
   ]
   ...
]
</code></pre>
<p>Of course that is not the case in Rebol2/etc.  You get instead the likes of:</p>
<pre><code> switch '+ [
     300 + 4 [
         print "this will print in R3-Alpha/Rebol2/Red, and it is misguided"
     ]
     ...
 ]
</code></pre>
<p>Mechanically speaking, it is possible for SWITCH to discern a BLOCK! it evaluated, from one that is referenced directly in the body.</p>
<pre><code>not-literal-wont-print: [print "subtlety"]
switch [print "this need not print"] [
    ([print "subtlety"]) not-literal-wont-print
    ([print "subtlety"]) [print "...but this *will* print"]
]
</code></pre>
<p>I think it is becoming beyond question:</p>
<pre><code> x: 10
 switch type of x [
     integer! [print "Don't you think this should run?"]
 ]
</code></pre>
<p>For the class of language that Rebol is, SWITCH should evaluate its clauses.  It is a force multiplier, and the right answer.</p>
<p>Now comes the question: how much will this break, and how well can we be told what the breaks are?</p>
<p>My idea is a shim, that checks to see if SWITCH evaluates a value to a WORD! that does not look up to a datatype...and errors if so.  This would be in effect for the indefinite future.</p>
<p>Perhaps we would have a switch/quote for the current behavior, aliased as <strong>switchq</strong> or something?  I don't know.</p>
<hr>
<p>I have been conflicted for a while, about the tradeoffs, but <em>when I think about things long enough, I solve them</em>.  I'm now sure about this.</p>
<hr>
<p>Looking at these seemingly "big" issues--which to be honest--aren't actually big (in terms of shaking language foundations) I think it's interesting to quote Carl <a href="http://www.rebol.com/article/0543.html" rel="nofollow noopener">circa 2014</a>:</p>
<blockquote>
<p>Having taken a long break from Rebol development, I guess these days I'm more in favor of disruption and going down a better path for new users. As I've said many times, Rebol 3 is still in alpha. That means we get to fix stuff and make it better. Sorry if it's a bit disruptive. There are always a few bumps in the development road, but you can<code>['t (sic)]</code> be afraid to keep moving forward.</p>
</blockquote>
<p>So "we're sorry" but the right answers must emerge.  And we <em>need</em> to have a way that your code can pin itself to a set of definitions, which I say we must make a hybrid Rebol2/R3-Alpha/Red dependency.  If you say that's what you depend on, then SWITCH must use the old meaning.  We need to be sure this legacy idea is easy to use and works for those who can't handle the truth.  <img src="../../../images/emoji/twitter/slight_smile.png%3Fv=7" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../should-datatype-be-killed-off-in-favor-of-integer-word-etc/1177/7.html">Should DATATYPE! Be ANY-WORD! (such as @integer)</a>
                        <meta itemprop='position' content='2'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../switch-and-soft-quoted-branches/1176.html">SWITCH and soft-quoted branches</a>
                        <meta itemprop='position' content='3'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="http://forum.rebol.info/t/relationship-between-switch-and-case/1088">Relationship between SWITCH and CASE</a>
                        <meta itemprop='position' content='4'>
                      </div>
                </div>
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/gchiu'><span itemprop='name'>gchiu</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-05-05T20:43:57Z' class='post-time'>
                    May 5, 2018,  8:43pm
                  </time>
                  <meta itemprop='dateModified' content='2018-05-05T20:52:47Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>So this code is from the rebolbook</p>
<pre><code>cd: func [
    "Change directory (shell shortcut function)." 
    [catch] 
    'path "Accepts %file, :variables and just words (as dirs)"
        [file! word! path! unset! string! paren!] 
][
    if paren? get/any 'path [set/any 'path do path] 
    switch/default type?/word get/any 'path [
        unset! [print what-dir] 
        file! [change-dir path] 
        string! [change-dir to-rebol-file path] 
        word! path! [change-dir to-file path]
    ][
        throw-error 'script 'expect-arg reduce ['cd 'path type? get/any 'path]]
    ]
</code></pre>
<p>I hope it's going to look a lot better now!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-05-05T21:10:41Z' class='post-time'>
                    May 5, 2018,  9:10pm
                  </time>
                  <meta itemprop='dateModified' content='2018-12-04T11:23:29Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <blockquote>
<p>I hope it’s going to look a lot better now!</p>
</blockquote>
<p>That function is old, it manually "soft-quotes".  <code>if paren? get/any 'path [set/any 'path do path]</code> is an unnecessary line--by having the parameter being <code>'path</code> it gets what the intended behavior was--actually soft quoting is richer than that (supports GET-PATH! and GET-WORD! for instance, not just GROUP!/"paren!").  So axe that first line...being able to do so is supported in Ren-C, and also both R3-Alpha and Red.</p>
<p>Further, since the system is doing the soft quoting, you don't have to do your own type checking on reduced products.  Meaning the THROW-ERROR is superfluous, you only get the types in the spec.  Again, that's in R3-Alpha and Red too.</p>
<p>But other than that, since you're using datatypes here, evaluative is fine.  The TYPE OF a NULL is NULL.</p>
<pre><code>cd: func [
    "Change directory (shell shortcut function)"
    return: [&lt;opt&gt; file!] 
    'path "Accepts %file, :variables and just words (as dirs)"
        [&lt;end&gt; file! word! path! string!] 
][
    change-dir switch type of get 'path [
        null [print what-dir | return]
        file! [path] 
        string! [local-to-file path] 
        word! path! [to file! path]
    ]
]</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/gchiu'><span itemprop='name'>gchiu</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-05-05T23:10:34Z' class='post-time'>
                    May 5, 2018, 11:10pm
                  </time>
                  <meta itemprop='dateModified' content='2018-05-05T23:10:34Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Well that looks a lot less cryptic than the original!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-12-04T11:38:44Z' class='post-time'>
                    December 4, 2018, 11:38am
                  </time>
                  <meta itemprop='dateModified' content='2022-06-02T10:34:24Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>We're a bit downstream of <strong>Facing the facts: SWITCH must evaluate clauses</strong>.  I think it has been a huge success.</p>
<p>Beyond the anticipated benefits, there have been several cool surprises:</p>
<h2>You can switch on NULLs</h2>
<p>There's no such thing as a null literal.  Nulls can't be put in blocks.  You have to use evaluation to get them, but since they can appear you might want to switch on them.</p>
<p>e.g. the TYPE OF a NULL is NULL:</p>
<pre><code> switch type of get word [
     null [...]
     ...
 ]
</code></pre>
<h2>Allows for Fallout</h2>
<p>SWITCH has a newfound ability to just let whatever comes last "fall out" of the switch, which has turned out to be a great trick.  So technically you don't need it there, you could just use a GROUP!:</p>
<pre><code>switch thing [
     'foo [...]
     'bar [...]
     (...)
 ]
</code></pre>
<p>This works because only literal blocks are considered as switch branches, so if your code evaluates to a BLOCK! then it's compared normally:</p>
<pre><code> switch [a b c] [
     ([a b c]) [print "This will run"]
 ]
</code></pre>
<h2>You can FAIL without invoking a defaulting pattern</h2>
<p>It's easier than ever to have a failure message if a switch case doesn't match.  No /DEFAULT or DEFAULT or ELSE clause needed:</p>
<pre><code>switch thing [
     'foo [...]
     'bar [...]
     fail ["Thing must be foo or bar, not" thing]
 ]
</code></pre>
<p><em>(Note: This pattern also works in CASE--but it would have always worked there, and you can use it in R3-Alpha or Red too, but with <code>do make error!</code> instead of FAIL(tm))</em></p>
<h2>All in all, quite the win.</h2>
<p>I noticed a remark from Carl asking <a href="http://www.rebol.net/r3blogs/0090.html">if SWITCH should be made a native</a>:</p>
<blockquote>
<p>The  <strong>switch</strong>  function is used quite frequently in programs, but it presents challenges to new users, due to it's non-evaluated case labels.</p>
</blockquote>
<p>So the non-evaluated case labels were something that was under scrutiny in the first place.  We now have ample evidence that bringing in the evaluator is critical--and differentiating to bring in expressive power that other languages don't have, and being able to match the clarity they do have.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/BlackATTR'><span itemprop='name'>BlackATTR</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-12-04T14:05:23Z' class='post-time'>
                    December 4, 2018,  2:05pm
                  </time>
                  <meta itemprop='dateModified' content='2018-12-04T14:05:23Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This is full of win. Thank you for the switching on NULL -- that's going to be incredibly helpful, I expect.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-01-14T20:37:24Z' class='post-time'>
                    January 14, 2021,  8:37pm
                  </time>
                  <meta itemprop='dateModified' content='2021-01-15T00:53:22Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>We're a couple years downstream of the SWITCH change to evaluative clauses.  I no longer have qualms about it.</p>
<aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="603">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="https://forum.rebol.info/user_avatar/forum.rebol.info/hostilefork/40/26_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>For the class of language that Rebol is, SWITCH should evaluate its clauses. <strong>It is a force multiplier, and the right answer.</strong></p>
</blockquote>
</aside>
<p>Now that there's generic quoting, we have nice things like being able to switch on literal blocks or groups:</p>
<pre><code>minus: [a - b]
code: [e * f]
switch code [
    minus [print "Subtracting A and B"]
    (elide print "Wasn't the minus case... it's something else")
    '[c + d] [print Adding C and D"]
    (reverse copy [f * e]) [print "Multiplying E and F"]
]
then item -&gt; [
    print ["A branch ran and gave" mold item]
    print "ELIDE, THEN/ELSE, NULL isotopes, and lambdas...-wow-"
    print "(Don't forget predicates...)"
]
</code></pre>
<p>Generic quoting also makes a shim for the Rebol2 behavior a piece of cake.  Just add a quote level to everything that isn't a block!</p>
<pre><code>switch: adapt :switch [
    body: map-each item body [either block? :item [item] [quote :item]]
]
</code></pre>
<p><em>(It would be nice to have some way of phrasing that which didn't need to say "item" twice.  Like a version of MAP-EACH that assumed the original value if the body returned NULL.  UPDATE-EACH?)</em></p>
<p><strong>So I have no regrets at this point about the evaluativeness of the clauses.  And at this point, my presumption is nobody else does either.</strong></p>
<h2>But... Multiple Clauses Means No Soft Quoted Branches</h2>
<p>Rebol's SWITCH took a cue from C's switch in letting you have multiple matches for a single clause</p>
<pre><code>switch value [
    1 2 3 [print "some cases"]
    4 5 6 [print "some more cases"]
]
</code></pre>
<p>This means that SWITCH literally has to look for blocks at each step.  Note that in the current logic, blocks that are part of expressions are not candidates...only blocks that are the start of new expressions:</p>
<pre><code>switch value [
   first [a b c] [print "This runs if value = a"]
]
</code></pre>
<p>That's a little confusing, but CASE has the same character.</p>
<p>In any event, all this adds up to mean you can't do an abbreviated form of switch with quoted branches, because it thinks all of these are things to match:</p>
<pre><code>&gt;&gt; switch 2 [
    1 'a
    2 'b
    3 'c
]
== 2   (follows "fallout" rule since no block, but imagine I wanted b)
</code></pre>
<h2>Should We Have An Operator That Presumes Alternation?</h2>
<p>I've been wondering if we need a variant of SWITCH that is still evaluative, but assumes a precise alternation of values to match and what's picked.</p>
<p>When I've imagined it, I've called it CHOOSE:</p>
<pre><code>&gt;&gt; choose 2 [
   1 [print "This would print if 1"]
   2 'b
   1 + 2 '[literal block if 3]
]
== b
</code></pre>
<p>But usually when messing with CHOOSE scenarios, I don't need branches to run.  So it's like it could be a more static thing, like SELECT...possibly using a COMPOSE:</p>
<pre><code>&gt;&gt; select 2 compose [
   1 a
   2 b
   (1 + 2) [literal block if 3]
]
== b
</code></pre>
<p>This runs up against some questions we've had about the nature of SELECT, where <a class="mention" href="../../../u/rgchris.html">@rgchris</a> has wanted it to treat the data as a table and only consider odd slots for the keys...while I've been wondering about something more freeform that treats SET-WORD! (and SET-BLOCK!?) as keys.</p>
<p>Either way, a SELECT wouldn't have the attribute of running clauses on a match.  How important is it to have an alternating form that does?</p>
<h2>It Comes Up When Using The API</h2>
<p>The cases where it does are usually not evaluative, most of them are just transformations from word-to-integer or something like that.  Right now that's laborious and forces you to make BLOCK!s...more typing and more cost:</p>
<pre><code>rebUnboxInteger("switch", rebQ(word), "[",
    "'some-word [", rebI(SOME_C_CONSTANT), "]",
   ...
</code></pre>
<p>I use SELECT, but with the current worries that a value slot might be treated as a key:</p>
<pre><code>rebUnboxInteger("select just", word, "[",
    "'some-word", rebI(SOME_C_CONSTANT),
    ...
</code></pre>
<p>There's a lot of degrees of freedom here, but I just wanted to point out how the CHOOSE described is different from a SELECT, and wonder a bit more about the nature of SWITCH...</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/rgchris'><span itemprop='name'>rgchris</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-01-27T03:56:40Z' class='post-time'>
                    January 27, 2021,  3:56am
                  </time>
                  <meta itemprop='dateModified' content='2021-01-27T03:56:40Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I don't know if this is mentioned or a good idea, but evaluative SWITCH can also be used as an alternative to case:</p>
<pre><code class="lang-nohighlight">switch true [
    expression-1 [...]
    expression-2 expression-3 [...]
]
</code></pre>
<p>It does have the marginal advantage of dispensing with ANY in such CASE statements:</p>
<pre><code class="lang-nohighlight">case [
    expression-1 [...]
    any [
        expression-2
        expression-3
    ] [...]
]
</code></pre>
<p>Benefits from expression barrier, be it comma or other:</p>
<pre><code class="lang-nohighlight">switch true [
    expression-1 [...]
    expression-2,
    expression-3 [...]
]
</code></pre>
<p>Again, not saying this is a good or bad pattern, just that it is now possible.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-02-27T21:12:59Z' class='post-time'>
                    February 27, 2021,  9:12pm
                  </time>
                  <meta itemprop='dateModified' content='2021-02-27T21:24:31Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="rgchris" data-post="11" data-topic="603">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="https://forum.rebol.info/user_avatar/forum.rebol.info/rgchris/40/14_2.png" class="avatar"> rgchris:</div>
<blockquote>
<p>Benefits from expression barrier, be it comma or other:</p>
<pre><code>switch true [
    expression-1 [...]
    expression-2,
    expression-3 [...]
]
</code></pre>
</blockquote>
</aside>
<p>So on this note: what if we presume values and branches alternate, unless COMMA! is used...in which case each element of the comma clause is assumed to be a value to match?</p>
<p>That would avoid the explicit search for BLOCK!, allowing QUOTED! and GROUP! branches:</p>
<pre><code>&gt;&gt; x: 5
&gt;&gt; switch x [
   1 [2 3]
   4, 5 '[6]
]
== [6]
</code></pre>
<p>You'd be able to switch on blocks:</p>
<pre><code>&gt;&gt; x: [a b]
&gt;&gt; switch x [
    [a b] [print "first match!"]
 ]
first match!

&gt;&gt; x: [a b]
&gt;&gt; switch x [
    [a b], [c d] [print "first match!"]
 ]
first match!

&gt;&gt; x: [a b]
&gt;&gt; switch x [
    [a b], [c d] '[print "first match!"]
 ]
== [print "first match!"]
</code></pre>
<p>You'd still be able to match commas, though we might have to make it legal to say <strong><code>',,</code></strong> ... for now it works if you space it out:</p>
<pre><code>&gt;&gt; x: ',
&gt;&gt; switch x [
   1, ', , 2 [print "match!"]
]
match!
</code></pre>
<p>Weird, but, if it comes up you could express it.  For those concerned with legibility, there's other ways since it's an evaluative slot:</p>
<pre><code>switch x [
    1, first [,], 2 [print "match!"]
]
</code></pre>
<p>This seems like it might be a good compromise, and normal cases should look pretty good:</p>
<pre><code>switch type of x [
    integer!, block! [
        print "It was an integer or a block"
    ]
 ]
</code></pre>
<p>The same feature could be implemented for CASE.  Since commas cannot appear internally to single expressions, the only place they could have appeared would have been right before the branch anyway.</p>
<pre><code>case [
     x &gt; 5, x &lt; 20 [
         print "This would be kind of cool, eh?"
     ]
     y &gt; 10,
     y &lt; 1000 [
        print "Looks good with multiple lines too."
    ]
]
</code></pre>
<p>But in that situation you could have done it before with an ANY [ ].  Still, it looks pretty nice.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="https://forum.rebol.info/t/match-in-rust-vs-switch/1835">MATCH in Rust vs. SWITCH</a>
                        <meta itemprop='position' content='1'>
                      </div>
                </div>
          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
                  Split this topic 
              </span>

              <link itemprop="mainEntityOfPage" href="https://forum.rebol.info/t/facing-the-facts-switch-must-evaluate-clauses/603">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-06-02T10:31:48Z' class='post-time'>
                    June 2, 2022, 10:31am
                  </time>
                  <meta itemprop='dateModified' content='2022-06-02T10:31:48Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>A post was split to a new topic: <a href="../../match-in-rust-vs-switch/1835.html">MATCH in Rust vs. SWITCH</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
    </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../../guidelines.html' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../../tos.html' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../../privacy.html' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
