<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Semantics of UPARSE&#39;s FURTHEST - Parsing - AltRebol</title>
    <meta name="description" content="Upon the announcement of UPARSE, @Brett listed as his secondmost missing feature the idea of knowing &amp;quot;how far a parse got&amp;quot;: 


An ability to return the furthest input point matched and the rule that caused rollback from &amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1868.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_cdfbc200d3f5311dbee0f69ae668cfc42cfc8cb7.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_7b2b5b1bc734c2cc3b6ad5e0f49f467e8601ef2c.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Semantics of UPARSE&#39;s FURTHEST&#39;" href="1868.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/semantics-of-uparses-furthest/1868" />
<meta name="twitter:url" content="https://forum.rebol.info/t/semantics-of-uparses-furthest/1868" />
<meta property="og:title" content="Semantics of UPARSE&#39;s FURTHEST" />
<meta name="twitter:title" content="Semantics of UPARSE&#39;s FURTHEST" />
<meta property="og:description" content="Upon the announcement of UPARSE, @Brett listed as his secondmost missing feature the idea of knowing &quot;how far a parse got&quot;:    An ability to return the furthest input point matched and the rule that caused rollback from there on parse failure. During development of rules this generally indicates the rule that is not properly specified.   I implemented a wrapper around combinators which basically got control before each combinator, and after.  Every parser that succeeded I&#39;d look at how far it sa..." />
<meta name="twitter:description" content="Upon the announcement of UPARSE, @Brett listed as his secondmost missing feature the idea of knowing &quot;how far a parse got&quot;:    An ability to return the furthest input point matched and the rule that caused rollback from there on parse failure. During development of rules this generally indicates the rule that is not properly specified.   I implemented a wrapper around combinators which basically got control before each combinator, and after.  Every parser that succeeded I&#39;d look at how far it sa..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 ❤" />
<meta property="article:published_time" content="2022-07-09T12:21:05+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="1868.html">Semantics of UPARSE&#39;s FURTHEST</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/15" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/parsing/16" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Parsing</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1868.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2022-07-09T12:21:05Z'>
              <time itemprop='dateModified' datetime='2022-07-09T12:34:13Z' class='post-time'>
                July 9, 2022, 12:34pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Upon the announcement of UPARSE, <a class="mention" href="https://forum.rebol.info/u/brett">@Brett</a> listed as his <a href="../introducing-uparse-the-hackable-usermode-parse/1529/4.html">secondmost missing feature</a> the idea of knowing "how far a parse got":</p>
<blockquote>
<ol start="2">
<li>An ability to return the furthest input point matched and the rule that caused rollback from there on parse failure. During development of rules this generally indicates the rule that is not properly specified.</li>
</ol>
</blockquote>
<p>I implemented a wrapper around combinators which basically got control before each combinator, and after.  Every parser that succeeded I'd look at how far it said it got in the input...and if that was further than the previous "furthest" it would bump it.</p>
<p><strong>But what happens when a combinator calls a parser that succeeds, but that success isn't used?</strong></p>
<p>Examples would be things like AHEAD, or TO:</p>
<pre><code> &gt;&gt; [result furthest]: uparse "aabbcc" [to "bb"]
 ; how can FURTHEST be "bbcc" and not "cc"
</code></pre>
<p>TO iterates, checking to see if "aabbcc" matches, then if "abbcc" matches, then finds a match at "bbcc".</p>
<p>But the reason it found a match at "bbcc" is that it ran "bb" on that and got "cc".  The "bb" combinator has the wrapper, and so FURTHEST got pushed.</p>
<p><strong>TO and AHEAD actually used to work on accident, before <a href="https://forum.rebol.info/t/output-variables-in-multi-return/1859">changing multi-returns</a>, because they didn't ask for the remainder from the parser parameter that they called.</strong></p>
<p>Previously the nature of multi-return was that you'd actually get the variable to write to as the multi-return parameter.  This made them compatible with historical refinements like /NEXT of DO that passed variables, and was just an alternative syntax for that.  It's far superior to do proxying to those variables at the end of the function...and allow the multi-return to be read and written as a normal variable.</p>
<p>But when you could see the variable, there was the ability to choose a different behavior when it was a "BLACKHOLE" indicator (#) that you weren't planning to use the result.</p>
<p>So the TO combinator would pass in a blackhole saying it wasn't planning on using the remainder of the parser it was calling on each iteration.  This meant the wrapper actually didn't find out how far the combinator TO called got, because there was no variable to write to.  If it tried to read the <strong>index of</strong> it would fail, so the protection of not updating furthest "just did the right thing".</p>
<p><strong>But that's not a general solution...</strong></p>
<p>There was a parallel problem with rollback, where not all succeeding parsers were supposed to contribute to an in-progress COLLECT.  This led to the PENDING mechanism, where some parsers had to explicitly route the output and say "yes, I want this to be collected".</p>
<p><em>(Hence combinators don't "roll back" collections, they just don't commit to routing what they aggregate from component parsers until they are finished.)</em></p>
<p>Which leads to the discovery of a quirk... TO does not manage its pending explicitly...it uses the default "auto-routing".  Hence the success of the last parser it calls--whose advancement it doesn't want--counts in a collect:</p>
<pre><code>&gt;&gt; uparse "aabbcc" [collect to [some keep "b"], elide [2 "b" 2 "c"]]
== ["b" "b"]
</code></pre>
<p>Is that right?  (cc: <a class="mention" href="https://forum.rebol.info/u/rgchris">@rgchris</a>)</p>
<p>If so, it means <em>"I want to consider the called parser's pending results, yet I don't want to incorporate its advancement in FURTHEST."</em></p>
<p>That would rule out something I was pondering, which was if there was some way of tying those two things together (only advance furthest if the pendings are used).</p>
<h2>Pathology Studies: How About MINMATCH?</h2>
<p>I made MAXMATCH as a case study of different approaches to influence on COLLECT:</p>
<p><strong><a href="https://github.com/metaeducation/ren-c/blob/8ed60125a473fe285e56213f82a6e7e4fa1d9e5a/tests/parse/examples/maxmatch.parse.test.reb">maxmatch.parse.test.reb</a></strong></p>
<p>Similarly we could ask about MINMATCH, and what its participation with FURTHEST should be.</p>
<p>MINMATCH wouldn't have the crutch of not having asked for the remainder from its component parsers.  So it wouldn't have worked accidentally.</p>
<p>It could call two parsers...have both succeed...and then only advance the smaller amount of the two.  We might say this "foils" a wrapper-based approach to updating furthest, as it would be advanced by the larger amount.</p>
<h2>At The Moment, TO and AHEAD Skew FURTHEST a Bit Far</h2>
<p>I can't stop the presses and not incorporate the multi-return change.  So right now, you get this:</p>
<pre><code>&gt;&gt; [result furthest]: uparse "aabbcc" [to "bb"]
; null

&gt;&gt; furthest
== "cc"
</code></pre>
<p>I'm hesitant to burden combinator authors with another parameterization just for this feature.</p>
<p>I am a little bit wondering if it's worth it to convey to a function that a multi-return result is "requested, but will not be written back to a variable".  There are some optimizations functions might make that are pertinent to that.  So we might be able to go back to how it used to be where if the remainder is requested as a "blackhole" then the furthest is not updated.  It could fix TO and AHEAD.</p>
<p>But MINMATCH would still be the kind of thing that would raise questions.</p>
        </div>

        <meta itemprop='headline' content='Semantics of UPARSE&#39;s FURTHEST'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
