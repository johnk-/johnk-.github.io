<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Soliciting Ideas for a BITWISE Dialect - #2 by hostilefork - Math - AltRebol</title>
    <meta name="description" content="With the creation of ENBIN and DEBIN, I think I showed off how a Rebol approach of dialecting could truly make something easy that&amp;#39;s painful in other languages (and a historical pain point in Rebol too, with how people h&amp;hellip;">
    <meta name="generator" content="Discourse 3.4.0.beta3-dev - https://github.com/discourse/discourse version 93983286b54a0e96b8073abce23f4566e9f296f7">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../1302.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_b36da8919caf93960d3b4470a90d0e79c6a110e2.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/checklist_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/footnote_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="footnote"  />
  <link href="https://forum.rebol.info/stylesheets/poll_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/spoiler-alert_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="spoiler-alert"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_bac9ab3eace9fe3f17026a3c4dbf25e3e9e1e9a0.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Soliciting Ideas for a BITWISE Dialect&#39;" href="../1302.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/soliciting-ideas-for-a-bitwise-dialect/1302/2" />
<meta name="twitter:url" content="https://forum.rebol.info/t/soliciting-ideas-for-a-bitwise-dialect/1302/2" />
<meta property="og:title" content="Soliciting Ideas for a BITWISE Dialect" />
<meta name="twitter:title" content="Soliciting Ideas for a BITWISE Dialect" />
<meta property="og:description" content="I wrote about my recent realizations that there just isn&#39;t the generic compatibility between INTERSECT/AND, or COMPLEMENT/NOT...that Ladislav had intuited.  The bitwise operations and set operations come into contention.  Framed this way, I&#39;ve concluded that you shouldn&#39;t be using INTERSECT on INTEGER!...or COMPLEMENT either.  When you say BITWISE-AND and BITWISE-NOT you&#39;re talking about something different.  Simple Attempt At BITWISE Shows Dialect Quandaries Needing somewhere to start with BITW..." />
<meta name="twitter:description" content="I wrote about my recent realizations that there just isn&#39;t the generic compatibility between INTERSECT/AND, or COMPLEMENT/NOT...that Ladislav had intuited.  The bitwise operations and set operations come into contention.  Framed this way, I&#39;ve concluded that you shouldn&#39;t be using INTERSECT on INTEGER!...or COMPLEMENT either.  When you say BITWISE-AND and BITWISE-NOT you&#39;re talking about something different.  Simple Attempt At BITWISE Shows Dialect Quandaries Needing somewhere to start with BITW..." />
<meta property="og:article:section" content="Domains" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:section" content="Math" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="article:published_time" content="2020-10-19T17:35:45+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../1302.html">Soliciting Ideas for a BITWISE Dialect</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/math/60" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/math/60" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Math</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Soliciting Ideas for a BITWISE Dialect'>
      <link itemprop='url' href='../1302.html'>
      <meta itemprop='datePublished' content='2020-07-15T22:59:38Z'>
        <meta itemprop='articleSection' content='Math'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' href='https://forum.rebol.info/u/hostilefork'>
          </span>
        <meta itemprop='text' content='With the creation of ENBIN and DEBIN, I think I showed off how a Rebol approach of dialecting could truly make something easy that&amp;#39;s painful in other languages (and a historical pain point in Rebol too, with how people h&amp;hellip;'>

          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-10-19T17:35:45Z' class='post-time'>
                    October 19, 2020,  5:35pm
                  </time>
                  <meta itemprop='dateModified' content='2020-10-19T18:07:34Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I wrote about my recent realizations that <a href="../../naming-of-bitwise-or-and-xor/472.html">there just isn't the generic compatibility between INTERSECT/AND, or COMPLEMENT/NOT</a>...that Ladislav had intuited.  The bitwise operations and set operations come into contention.</p>
<p>Framed this way, I've concluded that you shouldn't be using INTERSECT on INTEGER!...or COMPLEMENT either.  When you say BITWISE-AND and BITWISE-NOT you're talking about something different.</p>
<h2>Simple Attempt At BITWISE Shows Dialect Quandaries</h2>
<p>Needing somewhere to start with BITWISE, I thought about the simplest implementation I could imagine: just bind code into a context of bitwise operations and run it:</p>
<pre><code>bitwise-ctx: make object! [
    and: :bitwise-and
    or: :bitwise-or
    xor: :bitwise-xor
    not: :bitwise-not
    &lt;&lt;: :bitwise-shift-left
    &gt;&gt;: bitwise-shift-right
]

bitwise: func [block [block!]] [
    do in bitwise-ctx block
]
</code></pre>
<p>With this, you could just say <strong>bitwise [(a xor b) and not c]</strong> and get the answer.</p>
<p>But something bothered me about this as a "dialect strategy".  What if I had some code I wanted to escape out of the bitwise mode...the way you can just have a GROUP! of ordinary DO code in parse, where NOT meant what it usually did?  It seemed any dialect based on binding like this would lose out on such mixtures.  You could make an <strong>unbitwise [...]</strong> operator of a similar ilk, but how would it know what you had the bindings at to put them back?  :-/  It would have to assume, and could guess wrong.</p>
<p>This made me think about the way TAG! is used in COMPOSE.  What if you tagged parts of your code that <em>weren't</em> bitwise?</p>
<pre><code> bitwise &lt;$&gt; [(a xor b) and not (&lt;$&gt; if not setting [c] else [d])]
</code></pre>
<p>That's an idea, albeit an ugly one.  Though if we were to take a cue from PARSE, then BITWISE wouldn't go through BIND at all...and not use DO...but do its own processing based on BLOCK!s for grouping, leaving the GROUP!s bound as they were:</p>
<pre><code> bitwise [[a xor b] and not (if not setting [c] else [d])]
</code></pre>
<p>This takes us away from the "easy" re-use of the evaluator.  But it's hard to say how this example is any different from the desires of anyone who wants to attack a dialect.  So it feels like there has to be a roadmap.</p>
<h2>Bit Manipulation Is  A Tricky Domain</h2>
<p>Doing weird things like "switching from GROUP! to BLOCK! for precedence" in BITWISE is probably small potatoes compared to the big thoughts needed to make a "good" dialect for the purpose.</p>
<p>For instance: some recent experiences with C integer promotions reminds me that <em>it's really risky to have a dialect that just guesses at things regarding the size</em>.  Consider this simple case:</p>
<pre><code>uint16_t some_16bit = ...;
uint16_t another_16bit = ...;
uint32_t result_32bit = (some_16bit &lt;&lt; 16) + another_16bit;
</code></pre>
<p>Here you are left shifting a 16-bit integer by 16 bits to take up the high bits of a 32-bit number, and adding it to another 16-bit integer for the low-bits.  Seems about as straightforward as bitwise math gets, right?</p>
<p><strong>Wrong</strong>.  In C, when you left shift a type smaller than an integer that can fit in a signed integer, <em>it becomes a signed integer</em>.  So it acts like if you had written:</p>
<pre><code>uint32_t result_32bit = ((int)some_16bit &lt;&lt; 16) + another_16bit;
</code></pre>
<p>If your <code>some_16bit</code> number had a 1 in the high bit, that 16 bit left shift could be shifting the 1 into the highest 32nd bit...used for the signed-int's sign.  That is undefined behavior in C.  So you have to explicitly cast it to an unsigned integer:</p>
<pre><code>uint32_t result_32bit = ((uint32_t)some_16bit &lt;&lt; 16) + another_16bit;
</code></pre>
<p>Not only is it a tricky domain, but when your implementation is written in C...you have to be aware of the pitfalls when exposing that functionality through an interpreter.</p>
<h2>Examples Needed</h2>
<p>I'm a bit unsettled that I can't even think of what a basic BITWISE dialect notation should be.  If my example of <strong>bitwise [(a xor b) and not c]</strong> can't even be trusted as the notation to be implemented, what can?  Can we trust:</p>
<pre><code> axb: bitwise [a xor b]
 nc: bitwise [not c]
 axbanc: bitwise [axb and nc]
</code></pre>
<p>...or is even <em>that</em> up for debate?</p>
<p>Stepping out of the domain of DO, there are possibilities of using TUPLE! and PATH! in creative ways.<br>
To throw out one example...what if number-led decorators instruct the dialect to do casting?</p>
<pre><code> bitwise 32.[8.a xor 16.b]  ; 32 bit result, cast a to 8-bit, b to 16-bit?
</code></pre>
<p><em>The most intimidating thing about tackling such a dialect right now is the idea of trying to design something for a use-case we're not really ready for.</em>  It's a completely new thing with no customers.  If you're trying to put something in the box, it would be better to have a set of prior attempts to look at what was good and bad about each...and pick the best ideas.  Right now all we have is DO plus some infix operators.</p>
<p>So I'll kick this particular can down the street a bit, and move the INTEGER!/BINARY! behavior for bitwise operations to join AND+ OR+ and XOR+.</p>
<ul>
<li>COMPLEMENT on INTEGER! and BINARY! will become NOT+</li>
<li>EXCLUDE on INTEGER! and BINARY! will be AND-NOT+</li>
</ul>
<p>This will allow the set intersect/union/etc. operations on BINARY! to become series-based on ordered byte-collections again...removing that ambiguity.</p>
<p>In all of this, I've realized also that we need a form of SHOVE that works left, for turning enfix invocations into prefix ones:</p>
<pre><code> and -&lt; arg1 arg2
</code></pre>
<p>This helps mitigate the need to come up with a prefix name for everything.  It's a little bit ugly, but at least it's general.  R3-Alpha used the name <code>and~</code> for prefix AND...which had to be declared somewhere and wasn't a general method for making enfix prefix.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../1302.html#post_2">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
