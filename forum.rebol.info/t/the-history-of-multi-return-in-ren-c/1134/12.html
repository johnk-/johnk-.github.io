<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>The History of Multi-Return in Ren-C - #12 by hostilefork - Functions - AltRebol</title>
    <meta name="description" content="This thread merges discussions of history across several threads to cover the key points, starting with material from the post announcing the addition of the SET-BLOCK! and GET-BLOCK!...and then folding in important poin&amp;hellip;">
    <meta name="generator" content="Discourse 3.4.0.beta3-dev - https://github.com/discourse/discourse version 93983286b54a0e96b8073abce23f4566e9f296f7">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../../multiple-return-values/1134.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://forum.rebol.info/stylesheets/color_definitions_base__2_b36da8919caf93960d3b4470a90d0e79c6a110e2.css?__ws=forum.rebol.info" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://forum.rebol.info/stylesheets/desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://forum.rebol.info/stylesheets/chat_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat"  />
  <link href="https://forum.rebol.info/stylesheets/checklist_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-details_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-lazy-videos_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-local-dates_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-narrative-bot_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forum.rebol.info/stylesheets/discourse-presence_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forum.rebol.info/stylesheets/docker_manager_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="docker_manager"  />
  <link href="https://forum.rebol.info/stylesheets/footnote_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="footnote"  />
  <link href="https://forum.rebol.info/stylesheets/poll_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forum.rebol.info/stylesheets/spoiler-alert_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="spoiler-alert"  />
  <link href="https://forum.rebol.info/stylesheets/chat_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="chat_desktop"  />
  <link href="https://forum.rebol.info/stylesheets/poll_desktop_eb475c67ca07665cb858ddf2ea6c953c2e3e2b85.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forum.rebol.info/stylesheets/desktop_theme_2_bac9ab3eace9fe3f17026a3c4dbf25e3e9e1e9a0.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;The History of Multi-Return in Ren-C&#39;" href="../1134.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/the-history-of-multi-return-in-ren-c/1134/12" />
<meta name="twitter:url" content="https://forum.rebol.info/t/the-history-of-multi-return-in-ren-c/1134/12" />
<meta property="og:title" content="The History of Multi-Return in Ren-C" />
<meta name="twitter:title" content="The History of Multi-Return in Ren-C" />
<meta property="og:description" content="The proxying technique had shown clear advantages for the authors of functions, to be able to do direct assignments vs. need to remember to always SET the named variable passed in.  But underneath the hood, the names of the variables were still like inputs to the lower-level function.  This went as far as trying to act compatibly with the variable-passed-by-refinement trick that historical Redbol used for multiple returns.  Among the many problems were trying to write something like ENCLOSE.  A..." />
<meta name="twitter:description" content="The proxying technique had shown clear advantages for the authors of functions, to be able to do direct assignments vs. need to remember to always SET the named variable passed in.  But underneath the hood, the names of the variables were still like inputs to the lower-level function.  This went as far as trying to act compatibly with the variable-passed-by-refinement trick that historical Redbol used for multiple returns.  Among the many problems were trying to write something like ENCLOSE.  A..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Functions" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2022-11-27T04:54:58+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://forum.rebol.info/">
    AltRebol
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../../multiple-return-values/1134.html">The History of Multi-Return in Ren-C</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Functions</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='The History of Multi-Return in Ren-C'>
      <link itemprop='url' href='../../multiple-return-values/1134.html'>
      <meta itemprop='datePublished' content='2019-03-28T01:56:31Z'>
        <meta itemprop='articleSection' content='Functions'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' href='https://forum.rebol.info/u/hostilefork'>
          </span>
        <meta itemprop='text' content='This thread merges discussions of history across several threads to cover the key points, starting with material from the post announcing the addition of the SET-BLOCK! and GET-BLOCK!...and then folding in important poin&amp;hellip;'>

          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-11-27T04:54:58Z' class='post-time'>
                    November 27, 2022,  4:54am
                  </time>
                  <meta itemprop='dateModified' content='2024-09-30T12:00:55Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="9" data-topic="1134">
<div class="title">
<div class="quote-controls"></div>
<img loading="lazy" alt="" width="24" height="24" src="../../../user_avatar/forum.rebol.info/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>But lingering issues regarding wrapping and composing multi-returns remained...</p>
</blockquote>
</aside>
<p>The proxying technique had shown clear advantages for the authors of functions, to be able to do direct assignments vs. need to remember to always <strong><code>SET</code></strong> the named variable passed in.</p>
<p>But underneath the hood, the names of the variables were still like inputs to the lower-level function.  This went as far as trying to act compatibly with the variable-passed-by-refinement trick that historical Redbol used for multiple returns.</p>
<p>Among the many problems were trying to write something like ENCLOSE.  An enclosing function could only influence the primary output, unless it went through some particularly convoluted work:</p>
<ul>
<li>
<p>It would have to capture the variable name passed in before delegating, because the name would be repurposed as the proxied value slot</p>
</li>
<li>
<p>The delegated function would be called and would update the variable as part of its RETURN</p>
</li>
<li>
<p>The encloser would then have to read back this written variable with GET to see it, and use SET to update it...again.</p>
</li>
</ul>
<p>Here's an example of what you could think you might have to do:</p>
<pre><code>multi-returner: func [
    return: [integer!]
    extra: [integer!]
][
    extra: 20  ; by this point, variable passed as /EXTRA hidden
    return 10  ; stowed /EXTRA variable written back using EXTRA's 20 value
]

wrapper: enclose :multi-returner func [f [frame!]] [
    let extra-var: f.extra  ; capture var before call via DO moves it aside
    result: do f  ; callee proxies input variable during RETURN
    set extra-var (get extra-var) + 1  ; get new written value and update it 
    return result + 1
]

&gt;&gt; [a b]: wrapper
== 11

&gt;&gt; a
== 11

&gt;&gt; b
== 21
</code></pre>
<p><em>The situation was actually even worse than that.</em>  All the complex logic for filling proxy slots with variable WORD!s was done during the frame building.  e.g. <strong><code>extra-var</code></strong> wasn't the hypothetical "parameter passed to extra before it got shifted into a hidden variable slot by FUNC", it was already the unset slot to be filled by the callee.  And the actual variable name was private, known only to the enclosed function.</p>
<p><em>And it's worse than that</em> if you want to preserve the ability to have behavior depending on how many inputs are requested, because there may be no variable at all... or an "opt in for the feature without a variable" placeholder.  Correct code would be much more convoluted, if meaningful code could be written at all.</p>
<p>The headaches go deeper.  Copying a frame and running it multiple times introduced semantic and ordering problems about the writing of these additional outputs!</p>
<h2><a name="p-6498-simply-put-variable-names-as-inputs-make-poor-outputs-1" class="anchor" href="12.html#p-6498-simply-put-variable-names-as-inputs-make-poor-outputs-1"></a>Simply Put: Variable Names As Inputs Make Poor Outputs</h2>
<p>All of this pointed to the inconvenient truth:</p>
<p><strong>Implementing a function's conceptual outputs by passing named variables as input that are imperatively written during the function's body--anywhere, even at the end--is something that will break composition.</strong></p>
<p><strong>It's also horrible for atomicity, because a SET of an output variable may happen but then there's an error which occurs before the final return result can be produced... so any multi-return function working in this way is either broken or bearing an undue burden to do its own "transaction management", which is to say probably also broken.</strong></p>
<p>Of course we knew this.  But to get the desired effects (single return unless you use a SET-BLOCK!), there's no other choice, right?</p>
<p>The idea of making an ANY-VALUE! which tried to bundle values was nixed in the beginning.  Because if we declared some new datatype to represent a multi-return pack that decays to its first value when assigned to a variable, you enter a catch-22, like this early puzzle when <strong><code>@[...]</code></strong> was being considered to denote multi-returns:</p>
<pre><code>multi-return: func [] [
    return @[10 20]  ; assume RETURN is "magic" and returns @[10 20] vs. 10
]

&gt;&gt; x: multi-return
== 10

&gt;&gt; [x y]: multi-return
== 10

&gt;&gt; x
== 10

&gt;&gt; y
== 20
</code></pre>
<p>The problems are apparent on even a trivial analysis.  These "highly reactive" <strong><code>@[...]</code></strong> values wreak havoc in a general system.  If you walked across a block and encountered one, trying to work with it to store them in a variable would introduce distortions on assignment when they "decayed" to their first element.</p>
<pre><code>for-each x [foo @[10 20] bar] [
    if integer? x [...]  ; INTEGER? sees @[10 20] as just 10
] 
</code></pre>
<p><img src="../../../images/emoji/twitter/man_facepalming.png%3Fv=12" title=":man_facepalming:" class="emoji" alt=":man_facepalming:" loading="lazy" width="20" height="20"> ...but gee... if only there were some variation of BLOCK! which you could be guaranteed not to encounter when enumerating other blocks, and that couldn't be stored in variables... and a method for dealing with transforming them into and out of reified states so you could work with them...</p>
<p><em>Hey, waitaminute...</em> <img src="../../../images/emoji/twitter/atom_symbol.png%3Fv=12" title=":atom_symbol:" class="emoji" alt=":atom_symbol:" loading="lazy" width="20" height="20"></p>
<h2><a name="p-6498-september-2022-core-multi-return-via-antiform-block-2" class="anchor" href="12.html#p-6498-september-2022-core-multi-return-via-antiform-block-2"></a>September 2022: Core Multi-Return via Antiform BLOCK!</h2>
<p><a href="../../a-justification-of-generalized-isotopes/1918.html">Generalized Isotopes</a> made longstanding problems seem to fall like dominos; like block splicing and error handling.  And they could be applied here, too... solving several profound problems:</p>
<ul>
<li>
<p>As with all antiforms, you wouldn't be able to put BLOCK! antiforms in blocks...alleviating many conceptual problems.</p>
</li>
<li>
<p>Yet even more severely, you wouldn't be able to put BLOCK! antiforms in <em>variables</em>.  Antiform BLOCK!s would decay to their first value when assigned to <em>any</em> variable</p>
<ul>
<li>
<p>This turned out to be the <em>only</em> antiform "decay" mechanism required, subsuming prior concepts like decaying "heavy null" to "light null".  Heavy null would simply be a null representation in an antiform block.</p>
</li>
<li>
<p>Representing things like null would be possible since ^META values would be used in the multi-return convention, to afford the multi-return of antiforms themselves</p>
</li>
</ul>
</li>
<li>
<p>Fitting in with the general rules of isotopes, a QUASI-BLOCK! would evaluate to an antiform block:</p>
<pre><code>&gt;&gt; ~['10 '20]~
== ~['10 '20]~  ; anti

&gt;&gt; x: ~['10 '20]~
== 10
</code></pre>
</li>
<li>
<p>Functions that might be interested in the antiform state would need to take a parameter via a ^META parameter, in which case they would receive a QUASI-BLOCK! vs the decayed parameter</p>
<ul>
<li>
<p>A good example of a function that would want this would be RETURN, in order to be able to have a forwarding mode that would return an antiform result vs. its decayed first value</p>
</li>
<li>
<p><strong>This doesn't rule out building generators that proxy named output variables</strong>.  In fact it fixes its problems, by limiting the relevance of the fact that proxying is being used to the interior of the function, and making its externals speak the antiform block protocol.  If you want a proxying-FUNC you can have it...just define your own RETURN variation and wire it up.</p>
</li>
<li>
<p>It also opens the doors to many other conceptions of how to abstract the multi-return process</p>
</li>
</ul>
</li>
<li>
<p>SET-BLOCK! assignments would have special understandings of how to decompose antiform blocks and assign the component variables</p>
<ul>
<li>
<p>This would break the uneasy "backchannel" between caller and callee of variable names</p>
</li>
<li>
<p>The most obvious sign this had been a problem was that mere parenthesization would break historical multi-assignment:</p>
<pre><code>&gt;&gt; [a b]: multi-return   ; would work

&gt;&gt; [a b]: (multi-return)  ; would act like `(a: multi-return)`
</code></pre>
</li>
<li>
<p>Now any expression that doesn't store a variable as intermediate can act pass-thru (such as a conditional), and if a variable wanted to capture the multi-return character temporarily it could META it...potentially manipulate the QUASI-BLOCK!, and UNMETA it back</p>
</li>
</ul>
</li>
</ul>
<h2><a name="p-6498-casualties-of-composability-3" class="anchor" href="12.html#p-6498-casualties-of-composability-3"></a>Casualties of Composability</h2>
<p>One casualty of this was be the feature of being able to make a function's behavior depend on how many outputs were requested.  But the feature can still be achieved with enfix quoting left-hand-side and managing the assignment, it's just no longer something the core attempts to generalize.</p>
<p>Another casualty is legacy compatibility with passing in variable names via refinement.  But again: this feature could be achieved by AUGMENT-ing the function with the refinement, then ENCLOSE-ing that with something that wrote the multi-return's output to the variable passed in via that augmented refinement.</p>
<p>But there's really no competition here.  As I've hopefully made clear, passing in a named variable via refinement is simply not in the same league as a mechanism which legitimately makes additional outputs.</p>
<p><strong>As usual with these things, I'll admit it may not be simple or obvious at first glance, but the results are speaking for themselves!</strong></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../a-lot-to-unpack-replacing-the-set-of-reduce-block-idiom/1634/10.html">A Lot To UNPACK: (Replacing the SET of REDUCE BLOCK! Idiom)</a>
                        <meta itemprop='position' content='2'>
                      </div>
                </div>
          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../../multiple-return-values/1134.html#post_12">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forum.rebol.info/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
