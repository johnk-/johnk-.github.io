<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Pure WASM + Pthreads: Faster, Better, Smaller - WASM - AltRebol</title>
    <meta name="description" content="In the web console demo, when running with the &amp;quot;emterpreter&amp;quot; build: 
 &amp;gt;&amp;gt; â€Œâ€Œdelta-time [x: 0 loop 1000000 [x: x + 1]]
== 0:00:28.202  ; that&amp;#39;s 28 seconds, to count to a million

But when that same web console is running o&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="1069.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Pure WASM + Pthreads: Faster, Better, Smaller&#39;" href="1069.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/pure-wasm-pthreads-faster-better-smaller/1069" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/pure-wasm-pthreads-faster-better-smaller/1069" />
<meta property="og:title" content="Pure WASM + Pthreads: Faster, Better, Smaller" />
<meta name="twitter:title" content="Pure WASM + Pthreads: Faster, Better, Smaller" />
<meta property="og:description" content="In the web console demo, when running with the &quot;emterpreter&quot; build:   &gt;&gt; â€Œâ€Œdelta-time [x: 0 loop 1000000 [x: x + 1]] == 0:00:28.202  ; that&#39;s 28 seconds, to count to a million  But when that same web console is running on the same machine, in the new and bleeding edge pure WASM with Pthreads build:  &gt;&gt; â€Œdelta-time [x: 0 loop 1000000 [x: x + 1]] == 0:00:00.863  ; more than THIRTY TIMES FASTER  Of course, we&#39;d like to see that number go down too.  And you might not notice the console seeming all t..." />
<meta name="twitter:description" content="In the web console demo, when running with the &quot;emterpreter&quot; build:   &gt;&gt; â€Œâ€Œdelta-time [x: 0 loop 1000000 [x: x + 1]] == 0:00:28.202  ; that&#39;s 28 seconds, to count to a million  But when that same web console is running on the same machine, in the new and bleeding edge pure WASM with Pthreads build:  &gt;&gt; â€Œdelta-time [x: 0 loop 1000000 [x: x + 1]] == 0:00:00.863  ; more than THIRTY TIMES FASTER  Of course, we&#39;d like to see that number go down too.  And you might not notice the console seeming all t..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="WASM" />
<meta property="og:article:section:color" content="25AAE2" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 â¤" />
<meta property="article:published_time" content="2019-02-14T19:30:29+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="1069.html">Pure WASM + Pthreads: Faster, Better, Smaller</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/wasm/5" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/wasm/5" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>WASM</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Pure WASM + Pthreads: Faster, Better, Smaller'>
      <link itemprop='url' href='1069.html'>
      <meta itemprop='datePublished' content='2019-02-14T19:30:29Z'>
        <meta itemprop='articleSection' content='WASM'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="1069.html">


              <span class="crawler-post-infos">
                  <time  datetime='2019-02-14T19:30:29Z' class='post-time'>
                    February 14, 2019,  7:30pm
                  </time>
                  <meta itemprop='dateModified' content='2019-02-15T04:03:51Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>In the web console demo, when running with the "emterpreter" build:</p>
<pre><code> &gt;&gt; â€Œâ€Œdelta-time [x: 0 loop 1000000 [x: x + 1]]
== 0:00:28.202  ; that's 28 seconds, to count to a million
</code></pre>
<p>But when that same web console is running on the same machine, in the <a href="http://hostilefork.com/media/shared/replpad-js/">new and bleeding edge pure WASM with Pthreads build</a>:</p>
<pre><code>&gt;&gt; â€Œdelta-time [x: 0 loop 1000000 [x: x + 1]]
== 0:00:00.863  ; more than THIRTY TIMES FASTER
</code></pre>
<p>Of course, we'd like to see that number go down too.  And you might not notice the console seeming all that much faster on printing lines...but that's a different problem to address (related to callbacks and context switches).</p>
<p>The point is: by its very nature, the emterpreter was painfully slow.  But now with pure WASM not only is it tremendously faster, the build products are <em>half the size</em>.</p>
<p>Try it out...but don't do stack overflows yet (that needs a different strategy than what R3-Alpha was using).</p>
<p>Note that if you're not using Chrome, you will have to enable SharedArrayBuffer and WASM threading.<br>
It's in the <a href="http://hostilefork.com/media/shared/replpad-js/shared-memory-firefox.png"><code>about:config</code> settings of Firefox</a>.  And if you're on Android you'll need to <a href="http://hostilefork.com/media/shared/replpad-js/webassembly-chrome-android.png">tick a couple of <code>chrome://flags</code></a>.  Browsers are aiming to have these on by default...once they get over whatever their Spectre bug concern is.  Odds are very high they'll be mainstream by the time any serious usage of Ren-C in browser happens.  Even still, there's always the emterpreter fallback...and we can make that fallback more automatic (while trying to lobby you to change your switches).  No shortage of options, here.</p>
<h2><a name="p-3083-fyi-this-is-not-easy-stuff-to-do-1" class="anchor" href="1069.html#p-3083-fyi-this-is-not-easy-stuff-to-do-1"></a>FYI: this is NOT easy stuff to do</h2>
<p>Since not everyone completely understands the difficulty curve of various advancements, this one is <strong><a href="https://github.com/metaeducation/ren-c/blob/master/src/extensions/javascript/mod-javascript.c">pretty hard</a></strong>.  Not as much that any particular line of code is hard to write in and of itself...but it's an intersection of a tremendous number of things:</p>
<ul>
<li>Trying to keep it all boxed up so that all the JavaScript pieces stay isolated to the JavaScript extension, and you can build without any of it contaminating anything else.</li>
<li>Keeping the emterpreter version still working--since not all environments support pthread+WASM (yet)</li>
<li>Writing complex, multithreaded C without being able to use a debugger on it</li>
<li>Understanding all the inter-related concerns of C, Rebol, and JavaScript</li>
<li>Planning for multiple deployment environments (Browser, Node) and multiple future paths for those environments</li>
<li>Just reasoning about and designing this whole API model in the first place</li>
</ul>
<h2><a name="p-3083-theres-still-a-lot-to-do-2" class="anchor" href="1069.html#p-3083-theres-still-a-lot-to-do-2"></a>There's still a lot to do</h2>
<p>What's there now is a proof of concept.  It needs to be gone over--ideally that would include some people who aren't me.  :-/</p>
<p>Outside of stack overflows, there's still a whole slew of issues...regarding what to do about HALT and cancellation, as well as various other error/throw situations in the API.</p>
<p>But it's very encouraging, and I think there's a lot of potential in this direction.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/BlackATTR.html'><span itemprop='name'>BlackATTR</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-02-14T21:43:34Z' class='post-time'>
                    February 14, 2019,  9:43pm
                  </time>
                  <meta itemprop='dateModified' content='2019-02-14T21:43:34Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>That's some deep voodoo Brian. Great update.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
