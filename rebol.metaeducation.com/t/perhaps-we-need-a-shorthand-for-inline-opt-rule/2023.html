<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PERHAPS We Need a Shorthand for `inline (opt rule)` ? - Parsing - AltRebol</title>
    <meta name="description" content="Today, rules that look up to NULL will PANIC in parse--right at the moment of fetching the word: 
&amp;gt;&amp;gt; prefix: null, suffix: &amp;quot;)&amp;quot;

&amp;gt;&amp;gt; parse &amp;quot;aaa)&amp;quot; [prefix, some &amp;quot;a&amp;quot;, suffix]
** PANIC: (prefix is null, and we raise errors fo&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="2023.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;PERHAPS We Need a Shorthand for `inline (opt rule)` ?&#39;" href="2023.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/perhaps-we-need-a-shorthand-for-inline-opt-rule/2023" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/perhaps-we-need-a-shorthand-for-inline-opt-rule/2023" />
<meta property="og:title" content="PERHAPS We Need a Shorthand for `inline (opt rule)` ?" />
<meta name="twitter:title" content="PERHAPS We Need a Shorthand for `inline (opt rule)` ?" />
<meta property="og:description" content="Today, rules that look up to NULL will PANIC in parse--right at the moment of fetching the word:  &gt;&gt; prefix: null, suffix: &quot;)&quot;  &gt;&gt; parse &quot;aaa)&quot; [prefix, some &quot;a&quot;, suffix] ** PANIC: (prefix is null, and we raise errors for that in parse)  If we didn&#39;t panic, there would really only be two other options:    Make null always succeed, keeping the parse position where it is (synonym for [])    Make null always be an unsuccessful combinator match, but not cause a failure (synonym for VETO)    The beha..." />
<meta name="twitter:description" content="Today, rules that look up to NULL will PANIC in parse--right at the moment of fetching the word:  &gt;&gt; prefix: null, suffix: &quot;)&quot;  &gt;&gt; parse &quot;aaa)&quot; [prefix, some &quot;a&quot;, suffix] ** PANIC: (prefix is null, and we raise errors for that in parse)  If we didn&#39;t panic, there would really only be two other options:    Make null always succeed, keeping the parse position where it is (synonym for [])    Make null always be an unsuccessful combinator match, but not cause a failure (synonym for VETO)    The beha..." />
<meta property="og:article:section" content="Domains" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:section" content="Parsing" />
<meta property="og:article:section:color" content="F1592A" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 â¤" />
<meta property="article:published_time" content="2023-04-07T00:14:18+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="2023.html">PERHAPS We Need a Shorthand for `inline (opt rule)` ?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/domains/parsing/16" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/domains/parsing/16" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Parsing</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='PERHAPS We Need a Shorthand for `inline (opt rule)` ?'>
      <link itemprop='url' href='2023.html'>
      <meta itemprop='datePublished' content='2023-04-07T00:14:18Z'>
        <meta itemprop='articleSection' content='Parsing'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="2023.html">


              <span class="crawler-post-infos">
                  <time  datetime='2023-04-07T00:14:18Z' class='post-time'>
                    April 7, 2023, 12:14am
                  </time>
                  <meta itemprop='dateModified' content='2025-07-12T10:41:06Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Today, rules that look up to NULL will PANIC in parse--right at the moment of fetching the word:</p>
<pre><code>&gt;&gt; prefix: null, suffix: ")"

&gt;&gt; parse "aaa)" [prefix, some "a", suffix]
** PANIC: (prefix is null, and we raise errors for that in parse)
</code></pre>
<p>If we didn't panic, there would really only be two other options:</p>
<ol>
<li>
<p>Make <strong><code>null</code></strong> always succeed, keeping the parse position where it is (synonym for <strong><code>[]</code></strong>)</p>
</li>
<li>
<p>Make <strong><code>null</code></strong> always be an unsuccessful combinator match, but not cause a failure (synonym for <strong><code>VETO</code></strong>)</p>
</li>
</ol>
<p>The behavior I'm looking for in this post is optionality, which would correspond to the "always succeed" behavior.  (e.g. if there is no prefix, so I want to skip worrying about matching it).  I feel it is pretty obvious that should not be the default behavior for encountering a null variable.</p>
<p>(If null variables did anything other than error, they should probably do (2) and not match... but I don't think that's very wise compared with panic'ing.)</p>
<h2><a name="p-6590-how-to-get-optionality-today-inline-opt-rule-1" class="anchor" href="2023.html#p-6590-how-to-get-optionality-today-inline-opt-rule-1"></a>How To Get Optionality Today: <strong><code>inline (opt rule)</code></strong></h2>
<p>INLINE will take the synthesized product of the following rule (usually a GROUP!) and use it like a rule--as if it had been COMPOSE'd into the stream of operations.</p>
<p>If you inline a NULL, that's presumed to be an accident so it panics.  But if you inline a VOID, that is considered a no-op, so it does nothing.  Hence if you OPT a NULL to get a VOID and inline that, it will succeed with no effect:</p>
<pre><code>&gt;&gt; prefix: null, suffix: ")"

&gt;&gt; parse "aaa)" [inline (opt prefix), some "a", inline (opt suffix)]
== ")"
</code></pre>
<p>This works, but one can wonder about a combinator which was more succinct to accomplish the same thing, without the parentheses and without the OPT.</p>
<p>Since we don't have a name for it, let's call it PERHAPS for a moment:</p>
<pre><code>&gt;&gt; prefix: null, suffix: ")"

&gt;&gt; parse "aaa)" [perhaps prefix, some "a", perhaps suffix]
== ")"
</code></pre>
<p>It seems like a close parallel to OPT in the evaluative world, where NULL is turned into VOID with other things passed thru...</p>
<p>...but PARSE's OPT is entrenched as being about optionality of a rule that exists matching... not optionality of the rule itself.  So this is a fundamentally different intent.</p>
<h2><a name="p-6590-trickery-needed-to-combinate-null-2" class="anchor" href="2023.html#p-6590-trickery-needed-to-combinate-null-2"></a>Trickery Needed To "COMBINATE" NULL</h2>
<p>Unless quoting is involved, the combinator that would be getting the NULL from a word lookup initially would be the WORD! combinator.</p>
<p>So when a parser gets produced from a WORD! combinator, when that parser is called by another combinated parser it will PANIC.  It can't return an ERROR!, because that would just be interpreted as a rule that didn't match.</p>
<p>So the only way I can see a null-tolerant PERHAPS fitting in would be that it would have to quote its argument, so the WORD! combinator didn't get involved.  It would then do the WORD! fetch itself, turning into a failing combinator if it fetched null.</p>
<p>That may seem to work, but...</p>
<h2><a name="p-6590-compositional-problems-with-perhaps-3" class="anchor" href="2023.html#p-6590-compositional-problems-with-perhaps-3"></a>Compositional Problems With PERHAPS</h2>
<p>Let's say you wanted this:</p>
<p><em>"if there's a prefix, match some non-zero number of instances, but if prefix is null then don't worry about matching"</em>:</p>
<p>INLINE can do it:</p>
<pre><code>&gt;&gt; parse "aaa)))" [
       inline (when prefix '[some prefix])  ; when is IF, but VOID if no branch
       some "a"
       inline (when suffix '[some suffix])
   ]
== ")"
</code></pre>
<p>You can actually leverage VETO and COMPOSE here, to get the COMPOSE to cut itself short:</p>
<pre><code>&gt;&gt; parse "aaa)))" [
       inline (opt compose [some (any [prefix veto])])
       some "a"
       inline (opt compose [some (any [suffix veto])])
   ]
== ")"
</code></pre>
<p>You can shorthand that to get something brief that doesn't need to repeat PREFIX/SUFFIX.  But it would still be kind of long.</p>
<p>But what if we tried to do that with the hypothetical PERHAPS...could it work?</p>
<pre><code>&gt;&gt; parse "aaa)))" [some perhaps prefix, some "a", some perhaps suffix]
; infinite loop!
</code></pre>
<p>There's a problem here.  Because <strong>perhaps prefix</strong> just succeeds and doesn't advance the input when prefix is null.  But if you combine that with <code>some</code> the null case will just match nothing in perpetuity, causing an infinite loop.</p>
<p>This may look familiar, because if you write <strong>some opt [...anything...]</strong> you'll always get an infinite loop.  But in that case it's just wrong thinking: you know that the repetitive nature of <code>some</code> looking for an eventual non-match meant you must have intended <strong>some [...anything...]</strong> (at least one) or <strong>opt some [...anything...]</strong> (zero or more).</p>
<p><img src="../../images/emoji/twitter/thinking.png%3Fv=14" title=":thinking:" class="emoji only-emoji" alt=":thinking:" loading="lazy" width="20" height="20"></p>
<h3><a name="p-6590-note-that-historical-parse-has-no-good-answer-for-this-4" class="anchor" href="2023.html#p-6590-note-that-historical-parse-has-no-good-answer-for-this-4"></a>NOTE THAT HISTORICAL PARSE HAS NO GOOD ANSWER FOR THIS</h3>
<p>Rebol2 treats NONE! as a no-op which just succeeds but doesn't advance the input.  So the following gives you an infinite loop:</p>
<pre><code> rebol2&gt;&gt; prefix: none suffix: ")"

 rebol2&gt;&gt; parse "aaa)))" [some prefix some "a" some suffix]   
 ; infinite loop
</code></pre>
<p>The hackish "must make progress" rules in R3-Alpha actually make the above "work as intended", because the SOME will bail out after one non-advancing match.  I don't consider that a "good" answer--more a random effect.</p>
<h2><a name="p-6590-some-perhaps-is-semantically-perilous-5" class="anchor" href="2023.html#p-6590-some-perhaps-is-semantically-perilous-5"></a><strong><code>some perhaps</code></strong> Is Semantically Perilous</h2>
<p>Parsers can only succeed or fail right now.  So for <strong>some perhaps</strong> to work, you'd have to be able to say something else: "opt out above me as far as you can, but be fundamentally successful".</p>
<p>How far would that make sense to go?  It would certainly have to stop at the BLOCK! combinator to be of any use.  But what makes the BLOCK! combinator special to squash the "bubble up opt-out success" idea?</p>
<p>The reason that INLINE can work with a cobbled together rule is because it can be specific about where the point of opting-out should stop.  If PERHAPS is nested inside and trying to signal that outward, it doesn't work.</p>
<h2><a name="p-6590-is-perhaps-still-useful-enough-to-make-6" class="anchor" href="2023.html#p-6590-is-perhaps-still-useful-enough-to-make-6"></a>Is PERHAPS Still Useful Enough To Make?</h2>
<p>A quoting combinator that glosses over null rules seems useful--even if it can't be used in composition.  Though given that OPT is taken for something much more common and relevant to parsing, it's hard to give it a good name.</p>
<p>The alternative is perhaps use <strong><code>[]</code></strong> or some <strong><code>noop</code></strong> rule (if that's clearer/faster) as the state of your rule when it's not applicable.  But the whole thing is that you might want to use null for the state for its conditional falseyness for other parts of your situation.</p>
<p><em>Perhaps</em> it isn't necessary.  But it's been on my mind a while, and I wanted to write it up.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
