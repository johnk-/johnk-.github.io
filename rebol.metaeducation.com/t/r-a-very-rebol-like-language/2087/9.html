<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>R: a very Rebol-like language - #9 by bradrn - Foreign Inspiration - AltRebol</title>
    <meta name="description" content="In my last post, I mentioned that the R language is remarkably similar to Rebol in some respects. Now, R is not perfect — there is a lot to complain about (126 pages of it, to be precise). But as a widely-used language w&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../2087.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;R: a very Rebol-like language&#39;" href="../2087.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/r-a-very-rebol-like-language/2087/9" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/r-a-very-rebol-like-language/2087/9" />
<meta property="og:title" content="R: a very Rebol-like language" />
<meta name="twitter:title" content="R: a very Rebol-like language" />
<meta property="og:description" content="Since my first post above, I’ve been contemplating cases such as this:  &gt; add_quasi &lt;- function(arg1, arg2) quo({{ arg1 }} + {{ arg2 }}) &gt; test &lt;- function(arg) { +     x &lt;- 10 +     add_quasi({{ arg }}, x) + } &gt; x &lt;- 5 &gt; eval_tidy(test(x)) [1] 15  Here, add_quasi creates a quosure from both its arguments (using rlang’s quasiquotation syntax). test then passes its argument into add_quasi, alongside a local variable x. Finally, we call test with the global variable x. This gives a quosure contain..." />
<meta name="twitter:description" content="Since my first post above, I’ve been contemplating cases such as this:  &gt; add_quasi &lt;- function(arg1, arg2) quo({{ arg1 }} + {{ arg2 }}) &gt; test &lt;- function(arg) { +     x &lt;- 10 +     add_quasi({{ arg }}, x) + } &gt; x &lt;- 5 &gt; eval_tidy(test(x)) [1] 15  Here, add_quasi creates a quosure from both its arguments (using rlang’s quasiquotation syntax). test then passes its argument into add_quasi, alongside a local variable x. Finally, we call test with the global variable x. This gives a quosure contain..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Foreign Inspiration" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2024-01-06T07:49:34+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../2087.html">R: a very Rebol-like language</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/development/foreign-inspiration.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/development/foreign-inspiration.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Foreign Inspiration</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='R: a very Rebol-like language'>
      <link itemprop='url' href='../2087.html'>
      <meta itemprop='datePublished' content='2023-12-30T09:36:01Z'>
        <meta itemprop='articleSection' content='Foreign Inspiration'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='bradrn'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/bradrn'>
          </span>
        <meta itemprop='text' content='In my last post, I mentioned that the R language is remarkably similar to Rebol in some respects. Now, R is not perfect — there is a lot to complain about (126 pages of it, to be precise). But as a widely-used language w&amp;hellip;'>

          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/bradrn'><span itemprop='name'>bradrn</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2024-01-06T07:49:34Z' class='post-time'>
                    January 6, 2024,  7:49am
                  </time>
                  <meta itemprop='dateModified' content='2024-01-06T08:54:24Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Since my first post above, I’ve been contemplating cases such as this:</p>
<pre data-code-wrap="r"><code class="lang-r">&gt; add_quasi &lt;- function(arg1, arg2) quo({{ arg1 }} + {{ arg2 }})
&gt; test &lt;- function(arg) {
+     x &lt;- 10
+     add_quasi({{ arg }}, x)
+ }
&gt; x &lt;- 5
&gt; eval_tidy(test(x))
[1] 15
</code></pre>
<p>Here, <code>add_quasi</code> creates a quosure from both its arguments (using rlang’s quasiquotation syntax). <code>test</code> then passes its argument into <code>add_quasi</code>, alongside a local variable <code>x</code>. Finally, we call <code>test</code> with the global variable <code>x</code>. This gives a quosure containing code <code>x + x</code>, and the result of evaluating this is <code>10 + 5</code>, i.e. <code>15</code>.</p>
<p>Now, in Rebol this wouldn’t be too surprising, since each WORD! has its own binding. In R, however, it is: quosures associate one environment with a whole syntax tree, so we might expect it to evaluate to either <code>5 + 5</code> or <code>10 + 10</code>. How does this work?</p>
<p>The answer becomes obvious if we print the quosure itself:</p>
<pre data-code-wrap="r"><code class="lang-r">&gt; result &lt;- test(x)
&gt; result
&lt;quosure&gt;
expr: ^(^x) + (^x)
env:  0x55dc115b55e8
</code></pre>
<p>This is a nested quosure! And of course, each one carries around its own environment:</p>
<pre data-code-wrap="r"><code class="lang-r">&gt; quo_get_expr(result)[[2]]
&lt;quosure&gt;
expr: ^x
env:  global
&gt; quo_get_expr(result)[[3]]
&lt;quosure&gt;
expr: ^x
env:  0x55dc11710650
</code></pre>
<p>So the first <code>x</code> here is global, while the second is looked up in a local environment. (And the top-level quosure has a different environment yet again, in which <code>+</code> is looked up.)</p>
<p>If we choose, we can also collapse it into one big expression with a single environment, causing it to all be evaluated in the same scope:</p>
<pre data-code-wrap="r"><code class="lang-r">&gt; squashed &lt;- quo_squash(result)
&gt; squashed
x + x
&gt; eval_tidy(squashed)
[1] 10
</code></pre>
<p>In fact, we should really ask rlang to warn us about such a destructive operation:</p>
<pre data-code-wrap="r"><code class="lang-r">&gt; quo_squash(result, warn=TRUE)
x + x
Warning messages:
1: Collapsing inner quosure 
2: Collapsing inner quosure 
</code></pre>
<p>Actually evaluating nested quosures in R is slightly non-obvious, since quosures aren’t part of the base language. Insofar as I can tell, rlang implements <code>eval_tidy</code> using a bit of syntactic trickery — <code>"quosure"</code> is defined as a subclasse of <code>"formula"</code>, a built-in variety of quoted code which uses a tilde for evaluation. <code>eval_tidy</code> then rebinds the tilde operator to evaluate quosures in their environments.</p>
<p>What would such a system look like in the context of Rebol? I think it would be a system where bindings can be associated with <em>more than one type</em>: not just WORD!, but also BLOCK! (and presumably also GROUP!, etc.). A WORD! would be evaluated in the context of its own binding if it has one; otherwise it would get looked up in the environment of the first containing BLOCK!/GROUP! which has a binding.</p>
<p>Considering such a system more seriously, I believe it would cope quite easily with code like that mentioned in <a href="../../rebol-and-scopes-well-why-not/1751.html" class="inline-onebox">Rebol And Scopes: Well, Why Not?</a> :</p>
<pre data-code-wrap="r"><code class="lang-r"> global: 10
 x: &lt;not an integer&gt;

 wrapper: func [string] [
     return do compose [interpolate (string)]
 ]

 foo: func [x] [
     let local: 20
     return wrapper {The sum is $(x + local)}
 ]

 foo 30
</code></pre>
<p>Starting with <code>foo</code>, it would bind its body block to a new environment. Then, <code>foo 30</code> would cause the block to be evaluated — the words within it don’t have their own bindings yet, so everything executes within <code>foo</code>’s environment. <code>foo</code> proceeds to create <code>local</code> within its environment, and then it makes a string <em>which is bound to its environment</em> (since strings would also require bindings in order for string interpolation to work). Then, it calls <code>wrapper</code>, which similarly has bound its body to its own environment. As with <code>foo</code>, every word in its body would be looked up in <code>wrapper</code>’s environment — <em>except for the variables in <code>string</code></em>, because <code>string</code> already has its own binding.</p>
<p>It also copes with this case:</p>
<aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="1751">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"><a href="../../rebol-and-scopes-well-why-not/1751/1.html">Rebol And Scopes: Well, Why Not?</a></div>
<blockquote>
<p>If you're dynamically creating a function with some block material you got "from somewhere else", that material may have been written with the express knowledge that certain words were supposed to be overridden by the place it's being substituted, with others left alone.</p>
</blockquote>
</aside>
<p>Because you can still rebind whatever you want within a block. So a dialect can create its own environment, populate it with whichever words it wants, and then rebind words within a block to refer to that environment. And it all just works, because the rebound words will use their own bound environment, and the other words will use their parent block’s environment.</p>
<p>So, it seems to me like this system could just possibly work. But I’m admittedly bad with reasoning about this stuff — are there any edge cases I’ve missed? Is there some obvious reason why this <em>wouldn’t</em> work?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../2087.html#post_9">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
