<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Module Startup and Shutdown (Constructors, Destructors?) - #6 by hostilefork - Modules - AltRebol</title>
    <meta name="description" content="I&amp;#39;ve been trying to move toward a model extensions are just &amp;quot;modules that ship along with a DLL that have some native code, too&amp;quot;.  This helps avoid having parallel-and-variously-incompatible versions of the same features&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../960.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Module Startup and Shutdown (Constructors, Destructors?)&#39;" href="../960.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/module-startup-and-shutdown-constructors-destructors/960/6" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/module-startup-and-shutdown-constructors-destructors/960/6" />
<meta property="og:title" content="Module Startup and Shutdown (Constructors, Destructors?)" />
<meta name="twitter:title" content="Module Startup and Shutdown (Constructors, Destructors?)" />
<meta property="og:description" content="I love GENERATORS and YIELDERS, however they have a dark side...  If you are enumerating something with a generator or yielder, and you don&#39;t call it to exhaustion, it never cleans up... leaving latent locks  on series, and just clogging up memory.  History and experience with serious languages like C++ and Rust have shown that we don&#39;t really have better a better answer for default lifetime control than scope.  So let&#39;s try a thought experiment.  &gt;&gt; foo: func [data [block!]] [       let g: mak..." />
<meta name="twitter:description" content="I love GENERATORS and YIELDERS, however they have a dark side...  If you are enumerating something with a generator or yielder, and you don&#39;t call it to exhaustion, it never cleans up... leaving latent locks  on series, and just clogging up memory.  History and experience with serious languages like C++ and Rust have shown that we don&#39;t really have better a better answer for default lifetime control than scope.  So let&#39;s try a thought experiment.  &gt;&gt; foo: func [data [block!]] [       let g: mak..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Modules" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2025-05-11T14:51:22+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../960.html">Module Startup and Shutdown (Constructors, Destructors?)</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/modules/21" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/modules/21" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Modules</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Module Startup and Shutdown (Constructors, Destructors?)'>
      <link itemprop='url' href='../960.html'>
      <meta itemprop='datePublished' content='2018-12-14T00:37:40Z'>
        <meta itemprop='articleSection' content='Modules'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'>
          </span>
        <meta itemprop='text' content='I&amp;#39;ve been trying to move toward a model extensions are just &amp;quot;modules that ship along with a DLL that have some native code, too&amp;quot;.  This helps avoid having parallel-and-variously-incompatible versions of the same features&amp;hellip;'>

          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2025-05-11T14:51:22Z' class='post-time'>
                    May 11, 2025,  2:51pm
                  </time>
                  <meta itemprop='dateModified' content='2025-05-13T16:52:07Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="960">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>Rebol doesn't have constructors and destructors...but, maybe it should?</p>
</blockquote>
</aside>
<p>I love <a href="../../yielder-and-generator-and-thinking-about-coroutines/1311.html">GENERATORS and YIELDERS</a>, however they have a dark side...</p>
<p>If you are enumerating something with a generator or yielder, and you don't call it to exhaustion, it never cleans up... leaving latent locks  on series, and just clogging up memory.</p>
<p><strong>History and experience with serious languages like C++ and Rust have shown that we don't really have better a better answer for default lifetime control than scope.</strong></p>
<p><strong>So let's try a thought experiment.</strong></p>
<pre><code>&gt;&gt; foo: func [data [block!]] [
      let g: make-generator [
          for-each 'item data [print "Inside!" yield item + 1]
      ]
      return reduce [g g]
   ]

&gt;&gt; foo [10 20 30 40]
Inside!
Inside!
== [11 21]
</code></pre>
<p><strong>Imagine if at the moment of returning from FOO, the incomplete generator G should be destroyed, and its locks released.</strong></p>
<p>OTOH, if you have a module-level variable that's a generator, we can't automatically get rid of it.  And setting it to NULL wouldn't be enough to get it synchronously GC'd.  You would have to FREE it.</p>
<h2><a name="p-8256-so-many-questions-1" class="anchor" href="6.html#p-8256-so-many-questions-1"></a>So Many Questions...</h2>
<p>There's actually one important mechanism that the system has now, which is the ability to FREE basically anything and have stray references crash the GC.</p>
<p>So if LET wants to, it can FREE whatever it holds when the scope exits.</p>
<p>But now we enter a situation where not just exiting from scope, but a new assignment would have to free the generator too:</p>
<pre><code>foo: func [data [block!]] [
    let g: make-generator [
        for-each 'item data [print "Inside!" yield item + 1]
    ]
    let data: reduce [g g]
    g: 1020
    return data
]
</code></pre>
<p>Overwriting G with 1020 would <em>synchronously</em> FREE the previous contents of G.</p>
<p>Clearly not all variables being overwritten should free them.  If you passed G to another function, and that function made a couple of calls and then overwrote the argument... it shouldn't in the general case mean FOO lost G... unless it did a transfer of ownership.</p>
<p>So maybe this needs to be conveyed with a new concept, <a href="https://en.cppreference.com/w/cpp/memory/unique_ptr">like C++'s <code>unique_ptr</code></a>.</p>
<p>Let's say the concept is UNIQUE:</p>
<pre><code>let g: unique make-generator [
     for-each 'item data [print "Inside!" yield item + 1]
]
</code></pre>
<p>When you say that something is unique, you're saying that if that variable slot gets overwritten for any reason... it should free the value.  This needs to include cases of exiting scope.</p>
<p><strong>This may have potential, and it may be able to be implemented <a href="../../a-dream-for-debugging-generalized-accessors/2259.html">using the same mechanics as accessor</a>.</strong>  In other words, it could be usermode... UNIQUE would be an infix function that specifically sets up the left hand side as a slot that runs code on overwrite of the variable.</p>
<h2><a name="p-8256-what-about-indefinite-word-lifetime-2" class="anchor" href="6.html#p-8256-what-about-indefinite-word-lifetime-2"></a>What About Indefinite Word Lifetime?</h2>
<p>This has always been a bit of a thorn:</p>
<p><a href="../../what-happens-to-function-arguments-and-locals-when-the-call-ends/234.html" class="inline-onebox">What happens to FUNCTION! arguments and locals when the call ends?</a></p>
<p>If LETs and function args are getting wiped clean on function exit... (sometimes clearing out UNIQUE or other accessors, other times having no effect)... then returning code bound to those LETs would not be usable.</p>
<p>There's never really been a satisfying answer to indefinite lifetime.  But it's almost like you want to do the opposite of UNIQUE, to tell a variable "hey, I need you to live".  Some kind of UNSCOPE operation, or SURVIVE or something.</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">&gt;&gt; f: func [x] [return [x]]

&gt;&gt; b: f 10
== [x]

&gt;&gt; reduce b
!! PANIC: X is trash  ; or whatever, wiped out by function exit
</code></pre>
<p>vs.</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">&gt;&gt; f: func [x] [survive $x, return [x]]

&gt;&gt; b: f 10
== [x]

&gt;&gt; reduce b
[10]
</code></pre>
<p>So what SURVIVE would do is stop the system from setting X to trash on exit of F.</p>
<p>This starts to put a lot of little invisible bits on things, which makes me a bit uneasy.  But there's no in-band way to do this.  The values themselves can't encode information about their lifetimes (e.g. some UNIQUE! antiform which is a box around a value... you'd have to unbox the value every time you used it).</p>
<p>Though... quick devil's advocacy detour <img src="../../../images/emoji/twitter/ogre.png%3Fv=14" title=":ogre:" class="emoji" alt=":ogre:" loading="lazy" width="20" height="20"> ...it is the case that quasiform actions can be accessed and run via <strong><code>/^g</code></strong>, and so you might say <em>"What if <em>meta</em> actions were immune to freeing, but normal ones were not."</em>  That's kind of dumb, but it does point to the idea that there might be some way of encoding the "don't free me automatically on exiting functions" state in a value itself, if you were willing to use a special decoration to refer to that value to undo whatever you did to make it denote indefinite lifetime.</p>
<p>Maybe this is "meta-fencing" values?</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">&gt;&gt; f: func [x] [x: generator [yield 10], return [x]]

&gt;&gt; b: f 10
== [x]

&gt;&gt; reduce b
!! PANIC: X is trash  ; or whatever, wiped out by function exit
</code></pre>
<p>vs.</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">&gt;&gt; f: func [x] [^{x}: generator [yield 10], return [^{x}]]

&gt;&gt; b: f 10
== [^{x}]

&gt;&gt; reduce b
[10]
</code></pre>
<p>The thought here would be something like:</p>
<pre><code>&gt;&gt; ^{x}: 10
== 10

&gt;&gt; x
== {'10}

&gt;&gt; ^{x}
== 10
</code></pre>
<p>Then say that these fences keepalive things that would otherwise be wiped out on function exit.  Notably you could put quasiforms of generators and such in these.</p>
<p><strong>Not a good idea, I was just playing devil's advocate when I said the only way to talk about modifying a variable's lifetime was with out of band bits...and needed to justify that statement.</strong></p>
<h2><a name="p-8256-could-unique-and-survive-cover-enough-common-cases-3" class="anchor" href="6.html#p-8256-could-unique-and-survive-cover-enough-common-cases-3"></a>Could UNIQUE And SURVIVE Cover Enough Common Cases?</h2>
<p>It's hard to say.</p>
<p>But GENERATOR and YIELDER definitely present a challenge, because cleaning them up requires running finalization code.  That finalization code might panic.  If that happens at an arbitrary moment in time, you'll just get a random error popping out of nowhere.</p>
<p>So in a sense, a running GENERATOR and YIELDER pretty much can't be GC'd--<em>in effect, they hold references to themselves while they're still running</em>.  That's among the many reasons why it's important to clean them up intentionally.</p>
<p>They're not the only such entities with this problem.  User objects that hold onto resources are in the same category, they need to be shut down.</p>
<p>It seems to me that something needs to be tried, I just wanted to look at the landscape a bit and see if there was anything new in the picture.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../960.html#post_6">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
