<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Multiply-Unpacking Multi-Returns - Semantics - AltRebol</title>
    <meta name="description" content="I haven&amp;#39;t really figured out my philosophy about putting multi-returns in multi-returns. 
Looking at the question just in terms of fundamentals...should this be legal? 
&amp;gt;&amp;gt; x: pack [pack [1 2] 3]
== 1  ; double-decay?

An&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="2367.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Multiply-Unpacking Multi-Returns&#39;" href="2367.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/multiply-unpacking-multi-returns/2367" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/multiply-unpacking-multi-returns/2367" />
<meta property="og:title" content="Multiply-Unpacking Multi-Returns" />
<meta name="twitter:title" content="Multiply-Unpacking Multi-Returns" />
<meta property="og:description" content="I haven&#39;t really figured out my philosophy about putting multi-returns in multi-returns.  Looking at the question just in terms of fundamentals...should this be legal?  &gt;&gt; x: pack [pack [1 2] 3] == 1  ; double-decay?  And this seems rather ambiguous:  &gt;&gt; [x y]: pack [pack [1 2] 3] == ???  Is that x = 1 and y = 3?  Or x = 1 and y = 2 ?  I&#39;ll point out the availability of nested block notation:  &gt;&gt; [[x] y]: pack [pack [1 2] 3] == 1  &gt;&gt; x == 1  &gt;&gt; y == 3  So it seems to me that should be legal, in ..." />
<meta name="twitter:description" content="I haven&#39;t really figured out my philosophy about putting multi-returns in multi-returns.  Looking at the question just in terms of fundamentals...should this be legal?  &gt;&gt; x: pack [pack [1 2] 3] == 1  ; double-decay?  And this seems rather ambiguous:  &gt;&gt; [x y]: pack [pack [1 2] 3] == ???  Is that x = 1 and y = 3?  Or x = 1 and y = 2 ?  I&#39;ll point out the availability of nested block notation:  &gt;&gt; [[x] y]: pack [pack [1 2] 3] == 1  &gt;&gt; x == 1  &gt;&gt; y == 3  So it seems to me that should be legal, in ..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Semantics" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2025-03-06T20:56:40+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="2367.html">Multiply-Unpacking Multi-Returns</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/semantics/55" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/semantics/55" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Semantics</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Multiply-Unpacking Multi-Returns'>
      <link itemprop='url' href='2367.html'>
      <meta itemprop='datePublished' content='2025-03-06T20:56:39Z'>
        <meta itemprop='articleSection' content='Semantics'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="2367.html">


              <span class="crawler-post-infos">
                  <time  datetime='2025-03-06T20:56:40Z' class='post-time'>
                    March 6, 2025,  8:56pm
                  </time>
                  <meta itemprop='dateModified' content='2025-03-06T21:03:26Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I haven't really figured out my philosophy about putting multi-returns in multi-returns.</p>
<p>Looking at the question just in terms of fundamentals...should this be legal?</p>
<pre><code>&gt;&gt; x: pack [pack [1 2] 3]
== 1  ; double-decay?
</code></pre>
<p>And this seems rather ambiguous:</p>
<pre><code>&gt;&gt; [x y]: pack [pack [1 2] 3]
== ???
</code></pre>
<p>Is that <code>x = 1</code> and <code>y = 3</code>?  Or <code>x = 1</code> and <code>y = 2</code> ?</p>
<p>I'll point out the availability of nested block notation:</p>
<pre><code>&gt;&gt; [[x] y]: pack [pack [1 2] 3]
== 1

&gt;&gt; x
== 1

&gt;&gt; y
== 3
</code></pre>
<p>So it seems to me <em>that</em> should be legal, in the sense that you've indicated that you know what you're doing in the unpacking.  It isn't necessary for the first element to be a pack...</p>
<pre><code>&gt;&gt; [[x] y]: pack [1 3]
== 1

&gt;&gt; x
== 1

&gt;&gt; y
== 3
</code></pre>
<p>You're just covering the case of demonstrating that you know the first thing might be a pack.</p>
<h2><a name="p-8023-case-study-evaluate-1" class="anchor" href="2367.html#p-8023-case-study-evaluate-1"></a>Case Study: EVALUATE</h2>
<p>I've talked about how using :STEP <a href="../re-imagining-eval-next/767.html">changes the return result of EVALUATE into a multi-return unconditionally</a>, with the synthesized product as the second result.</p>
<p>This is to say that if you have a function that returns multiple values, you can dodge ambiguity by making it so that the first result can never be a multi-return.  This lets you unambiguously interpret the multi-return.</p>
<p>So in places where EVAL:STEP is used, I've effectively been saying this is legal:</p>
<pre><code>&gt;&gt; [pos result]: pack [[print "hi"] pack [2 3]]
== [print "hi"]

&gt;&gt; pos
== [print "hi"]

&gt;&gt; result
== 2
</code></pre>
<p>If you wanted to unpack it further, you'd need <strong><code>[pos [a b]]:</code></strong> or to ask for the pack in its meta form, such as by <strong><code>[pos ^result]:</code></strong></p>
<p>If this is allowed, it makes it seem "unfair" that the first position wouldn't double-decay.  Would it be too much to ask to require you to say <strong><code>[pos [result]]:</code></strong> if there was a chance of the second value being a multi-return?</p>
<p>That <em>feels</em> like too much to ask to me.  If I could write <strong><code>result: some-multi-return-func</code></strong> then it seems I should be able to write <strong><code>[pos result]: eval:step [some-multi-return-func]</code></strong></p>
<p>But if double decay is allowed, does that mean triple-decay is too?  Arbitrary-recursive decay where you get an infinite loop, by building self-referential packs?</p>
<p>Is it better to have a rule that the first slot won't double-decay, or just enforce it by convention by trying not to design functions that are multi-return which have multi-returns in their first position?</p>
<h2><a name="p-8023-another-case-study-parse-2" class="anchor" href="2367.html#p-8023-another-case-study-parse-2"></a>Another Case Study: PARSE</h2>
<p>Right now, PARSE is broken into layers... a lower level <code>PARSE*</code> that is always a multi-return function (if it's not raising an error), and it gives back a synthesized result as well as an array of residual "pending" items.</p>
<p><em>(Residual pending items are leftover items that combinators produced in the pending list, that were neither rolled back nor consumed by another combinator.  It's what you'd get if you did something like <code>parse "a" [keep "a"]</code>, e.g. did a KEEP with no corresponding COLLECT to filter the collected item out of the list.  Sometimes residual pending items are intentional, e.g. in the <a href="../visual-parse-on-the-web-has-arrived/1837.html">Visual Parse Demo</a> where a list of underlines--produced by any MARK combinators that don't get rolled back--bubble up to the EPARSE driver so it can draw those underlines.)</em></p>
<p>The higher level PARSE doesn't offer the pending items--it just errors if it sees any leftovers.  The problem would be that without these layers, the default interpretation of unpacking wouldn't be able to unpack multi-returns synthesized by parse:</p>
<pre><code>&gt;&gt; [x y]: parse "bbb" [some "a" (pack [1 2]) | some "b" (pack [3 4])]
; I want to get x = 3, y = 4 from this
</code></pre>
<p>The desire to have this be the common behavior is why <code>PARSE*</code> is needed to get the pending list as a multi-return.</p>
<p>But I've faced some problems with wrappers over the lower level PARSE* having to redo work, e.g. to implement the PARSE:MATCH refinement, which can't be put on the lower level parse and needs to be repeated in each wrapper.</p>
<p>It might be that thinking of this in terms of "higher level" and "lower level" is wrong, and I should follow the method of EVAL to actually use a refinement to change the return result of a single PARSE construct.  So PARSE:PENDING or somesuch, to shift into a multi-return mode where the pending list is the main result, and the synthesized result (which may be a multi-return) is secondary.</p>
<p>Anyway, I'll take another look at this.  Questions remain about how many decays to allow, but so long as this is seen as a kind of video game we shouldn't be afraid of infinite loops.  They're trivial enough to cause in other places.  <img src="../../images/emoji/twitter/man_shrugging.png%3Fv=14" title=":man_shrugging:" class="emoji" alt=":man_shrugging:" loading="lazy" width="20" height="20">  Just make sure you can Ctrl-C out of it and try to give some guidance... (hopefully you can debug step through the decays, I'll have to think about that).</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
