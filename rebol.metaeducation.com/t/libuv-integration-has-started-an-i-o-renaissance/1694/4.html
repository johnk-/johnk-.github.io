<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>libuv Integration Has Started...an I/O Renaissance - #4 by hostilefork - Ports - AltRebol</title>
    <meta name="description" content="So I put together a build with libuv, and... 
...It&amp;#39;s Gone Extremely Well!
:flight_departure: 
As a first step, I decided I&amp;#39;d try using libuv for all of our filesystem calls.  They&amp;#39;re based on the POSIX filesystem APIs, &amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../1694.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;libuv Integration Has Started...an I/O Renaissance&#39;" href="../1694.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/libuv-integration-has-started-an-i-o-renaissance/1694/4" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/libuv-integration-has-started-an-i-o-renaissance/1694/4" />
<meta property="og:title" content="libuv Integration Has Started...an I/O Renaissance" />
<meta name="twitter:title" content="libuv Integration Has Started...an I/O Renaissance" />
<meta property="og:description" content="I&#39;ve now taken the next big step in terms of implementation, in changing over the networking TLS code to use libuv.  That covers listening sockets for servers, as well as streaming data for reading and writing.  There&#39;s no new asynchronousness, but the custom/buggy/bad ways based on &quot;devices&quot; are gone...as well as my custom/buggy/bad temporary replacement to help migrate to libuv.  So it&#39;s one of those things where if this step goes well, you shouldn&#39;t be able to tell a difference.  (It&#39;s fortu..." />
<meta name="twitter:description" content="I&#39;ve now taken the next big step in terms of implementation, in changing over the networking TLS code to use libuv.  That covers listening sockets for servers, as well as streaming data for reading and writing.  There&#39;s no new asynchronousness, but the custom/buggy/bad ways based on &quot;devices&quot; are gone...as well as my custom/buggy/bad temporary replacement to help migrate to libuv.  So it&#39;s one of those things where if this step goes well, you shouldn&#39;t be able to tell a difference.  (It&#39;s fortu..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Ports" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2021-10-02T11:39:43+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../1694.html">libuv Integration Has Started...an I/O Renaissance</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/ports/37" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/ports/37" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Ports</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='libuv Integration Has Started...an I/O Renaissance'>
      <link itemprop='url' href='../1694.html'>
      <meta itemprop='datePublished' content='2021-08-31T03:37:40Z'>
        <meta itemprop='articleSection' content='Ports'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'>
          </span>
        <meta itemprop='text' content='So I put together a build with libuv, and... 
...It&amp;#39;s Gone Extremely Well!
:flight_departure: 
As a first step, I decided I&amp;#39;d try using libuv for all of our filesystem calls.  They&amp;#39;re based on the POSIX filesystem APIs, &amp;hellip;'>

          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-10-02T11:39:43Z' class='post-time'>
                    October 2, 2021, 11:39am
                  </time>
                  <meta itemprop='dateModified' content='2021-10-03T09:55:49Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="1694">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>The real benefit will be having vetted asynchronous <strong>network</strong> I/O. It will take the place of buggy garbage we had, that was nigh undebuggable.</p>
</blockquote>
</aside>
<p>I've now taken the next big step in terms of implementation, in changing over the networking TLS code to use libuv.  That covers listening sockets for servers, as well as streaming data for reading and writing.</p>
<p>There's no <em>new</em> asynchronousness, but the custom/buggy/bad ways based on "devices" are gone...as well as my custom/buggy/bad temporary replacement to help migrate to libuv.</p>
<p>So it's one of those things where if this step goes well, you shouldn't be able to tell a difference.  (It's fortunate that I'd written some stress tests for the httpd server, because that catches a lot of issues.)</p>
<h2><a name="p-5544-were-still-using-usermode-httptls-code-1" class="anchor" href="4.html#p-5544-were-still-using-usermode-httptls-code-1"></a>We're Still Using Usermode HTTP/TLS Code</h2>
<p>An interesting thing about libuv is that it doesn't have any built in TLS integration:</p>
<p><a href="https://github.com/libuv/libuv/issues/1128" class="inline-onebox">SSL support · Issue #1128 · libuv/libuv · GitHub</a></p>
<p>This means our usermode TLS code--built on the cryptographic primitives of mbedTLS--is actually a kind of interesting option.</p>
<p>The TLS code itself is sort of coherent in terms of being an "executable spec".  If the dialects used continue to converge with the RFC, it might have the bones to become one of the most understandable codebases for TLS there is.  Maybe.  <img src="../../../images/emoji/twitter/man_shrugging.png%3Fv=14" title=":man_shrugging:" class="emoji" alt=":man_shrugging:" loading="lazy" width="20" height="20"></p>
<p>But I say <em>"interesting"</em> option (as opposed to <em>"practical"</em>) because we should remember that the usermode TLS is slow, incomplete, on the fringe of being maintained at all, and known to be insecure.  As I've mentioned previously, it extracts certificates and decrypts the data without actually verifying against a certificate authority.  A so-called man-in-the-middle attack could be done by someone who impersonated the other side of the connection.  It's not exactly <em>zero</em> security...your average person watching wireshark packets go by wouldn't be able to read plaintext passwords go by.</p>
<p>Still...it's a bit of a novelty people might find thought-provoking, that could grow into something better in the future.  And my point is that there's no free lunch with libuv and TLS.  If we weren't using the usermode Rebol TLS, then we'd have to use the higher-level facilities in mbedTLS that take care of that (right now we only build in the lower-level cryptography that the usermode TLS uses).</p>
<h2><a name="p-5544-big-questions-about-the-event-loop-loom-2" class="anchor" href="4.html#p-5544-big-questions-about-the-event-loop-loom-2"></a>Big Questions About The Event Loop Loom</h2>
<p>The networking code is the first case of using the libuv callbacks and delegating to the libuv event loop.  So it's a much bigger deal than the synchronous filesystem API substitutions.</p>
<p>Right now the only time we call the event loop is in WAIT, and it's still using some ad hoc timer logic instead of libuv timers.  As I say--it's a first step.  It's a long way to the point where you could have an interactive chat program feeding lines at the unix prompt coming from the internet while you're idle at the keyboard.</p>
<p>Regardless of the specifics...<strong><a href="../../semantics-of-read-and-tcp-streams-past-and-future/1733.html">I'm proposing a grand vision of scrapping the existing attempts at asynchronousness to replace with green threads and "channels", as in Go</a>.</strong>  Event dispatch would be very different in that world...and libuv might not even be the best choice.  Maybe everything should just be rewritten in Go.  <img src="../../../images/emoji/twitter/man_facepalming.png%3Fv=14" title=":man_facepalming:" class="emoji" alt=":man_facepalming:" loading="lazy" width="20" height="20"></p>
<p>Ignoring all that for now... <em>at least we're building on a platform abstraction layer that other people develop, maintain, <strong>and document</strong>.</em>  That fights much more than half the battle in the event that you decide you want to pick another platform abstraction layer.</p>
<p>Anyway I just wanted to give an update that libuv networking is in.  Report anything broken, at least that wasn't already broken before...</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../1694.html#post_4">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
