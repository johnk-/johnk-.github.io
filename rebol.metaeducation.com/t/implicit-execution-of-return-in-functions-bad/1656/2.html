<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Implicit Execution of RETURN in functions = ...BAD (?) - #2 by hostilefork - Functions - AltRebol</title>
    <meta name="description" content="Let&amp;#39;s say you write something like this: 
foo: func [
    return: [integer!]
    arg [integer! text! tag!]
][
    if integer? arg [
        return arg + 1000
    ]
    if text? arg [
        return reverse arg
    ]
    &amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../1656.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Implicit Execution of RETURN in functions = ...BAD (?)&#39;" href="../1656.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/implicit-execution-of-return-in-functions-bad/1656/2" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/implicit-execution-of-return-in-functions-bad/1656/2" />
<meta property="og:title" content="Implicit Execution of RETURN in functions = ...BAD (?)" />
<meta name="twitter:title" content="Implicit Execution of RETURN in functions = ...BAD (?)" />
<meta property="og:description" content="I&#39;ve been back to working on stackless, and am dead-set on getting it merged in.  This puts me face to face with some tough issues surrounding function implementations and RETURN.  No Feedback Here So I Have To Go After It @gchiu has been living under a rock (well, in New Zealand 🐑 same difference).   So he never even noticed Ren-C supports RETURN: specs.  Hence any RETURN he&#39;s ever used has been in a FUNC[TION] without a return spec.  But I think this does align with the reality that peop..." />
<meta name="twitter:description" content="I&#39;ve been back to working on stackless, and am dead-set on getting it merged in.  This puts me face to face with some tough issues surrounding function implementations and RETURN.  No Feedback Here So I Have To Go After It @gchiu has been living under a rock (well, in New Zealand 🐑 same difference).   So he never even noticed Ren-C supports RETURN: specs.  Hence any RETURN he&#39;s ever used has been in a FUNC[TION] without a return spec.  But I think this does align with the reality that peop..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Functions" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2022-06-15T08:50:33+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../1656.html">Implicit Execution of RETURN in functions = ...BAD (?)</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Functions</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Implicit Execution of RETURN in functions = ...BAD (?)'>
      <link itemprop='url' href='../1656.html'>
      <meta itemprop='datePublished' content='2021-08-12T19:00:01Z'>
        <meta itemprop='articleSection' content='Functions'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'>
          </span>
        <meta itemprop='text' content='Let&amp;#39;s say you write something like this: 
foo: func [
    return: [integer!]
    arg [integer! text! tag!]
][
    if integer? arg [
        return arg + 1000
    ]
    if text? arg [
        return reverse arg
    ]
    &amp;hellip;'>

          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-06-15T08:50:33Z' class='post-time'>
                    June 15, 2022,  8:50am
                  </time>
                  <meta itemprop='dateModified' content='2022-06-15T13:37:32Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I've been back to working on stackless, and am dead-set on getting it merged in.</p>
<p>This puts me face to face with some tough issues surrounding function implementations and RETURN.</p>
<h2><a name="p-5921-no-feedback-here-so-i-have-to-go-after-it-1" class="anchor" href="2.html#p-5921-no-feedback-here-so-i-have-to-go-after-it-1"></a>No Feedback Here So I Have To Go After It</h2>
<p><a class="mention" href="https://rebol.metaeducation.com/u/gchiu">@gchiu</a> has been living under a rock <em>(well, in New Zealand <img src="../../../images/emoji/twitter/sheep.png%3Fv=14" title=":sheep:" class="emoji" alt=":sheep:" loading="lazy" width="20" height="20"> same difference)</em>.   So he never even noticed Ren-C supports RETURN: specs.  Hence any RETURN he's ever used has been in a FUNC[TION] without a return spec.</p>
<p>But I think this does align with the reality that people expect FUNCTION to offer a return, out of the box...even with no return spec.</p>
<p>Guess this kills the idea that you have to put RETURN: in the spec to get a return.  But I'm still not at ease with the idea of "hiding" a secret call to RETURN under the hood of functions to get type checking.</p>
<h2><a name="p-5921-i-hate-to-say-it-but-man_facepalming-lets-do-what-javascript-does-2" class="anchor" href="2.html#p-5921-i-hate-to-say-it-but-man_facepalming-lets-do-what-javascript-does-2"></a>I Hate To Say It, But... <img src="../../../images/emoji/twitter/man_facepalming.png%3Fv=14" title=":man_facepalming:" class="emoji" alt=":man_facepalming:" loading="lazy" width="20" height="20"> Let's Do What JavaScript Does</h2>
<p><strong>In JavaScript you don't have to put a RETURN in a function.  <em>But if you don't use RETURN, the result is undefined.</em></strong></p>
<p>We'd do the same, except with "none" (the ~ isotope, value used to mark unset variables):</p>
<pre><code>&gt;&gt; scrambledrop: func [str] [take reverse str]

&gt;&gt; str: "Test"

&gt;&gt; scrambledrop str

&gt;&gt; str
== "seT"
</code></pre>
<p>Because there was no RETURN, the SCRAMBLEDROP gave back nothing... e.g. not the <strong><span class="hashtag-raw">#T</span></strong> that came back from the take.  But it didn't error either.</p>
<p><strong>JavaScript gives the alternative of lambda functions, which evaluate to the body with an implicit RETURN.</strong></p>
<p>We would do the same.  Except their lambdas have a return (you don't have to use it)...but our lambdas actually wouldn't have a RETURN of their own as an option, they'd only have a RETURN from any enclosing functions:</p>
<pre><code>  &gt;&gt; increment: lambda [x] [x + 1]

  &gt;&gt; increment 1019
  == 1020

  &gt;&gt; decrement: x -&gt; [x - 1]

  &gt;&gt; decrement 305
  == 304
</code></pre>
<p><em>(Not having their own RETURN is important for lambdas used as branches of conditionals today.)</em></p>
<h2><a name="p-5921-for-the-near-term-ill-make-func-with-no-return-raise-an-error-3" class="anchor" href="2.html#p-5921-for-the-near-term-ill-make-func-with-no-return-raise-an-error-3"></a>For the Near Term, I'll Make FUNC with no RETURN Raise an Error</h2>
<p>Since people have been depending on the result "falling out", we'll have an intermediate period where no RETURN will just error.</p>
<p>This is a good time to go through and shore up your RETURN: specs with types, because one thing RETURN gets you is typechecking.  <em>(I explain above why RETURN is the locus of typechecking, and in the implementation it will be the <em>only</em> place for typechecking.)</em></p>
<p>And if you feel that you don't want or need a RETURN, go ahead and embrace LAMBDA.   If you really are writing something quick and dirty where all the hassle of a spec is more than you want... why not go all the way with the arrow?</p>
<pre><code>increment: function [return: [integer!], x [integer!]] [  ; what a hassle!
    return x + 1
]

increment: function [x] [  ; at least there's no verbose type specs
    return x + 1
]

increment: func [x] [  ; hey, an abbreviation
    return x + 1
]

increment: lambda [x] [  ; lost the abbreviation but at least no RETURN
    x + 1
]

increment: x -&gt; [x + 1]  ; behold, laziness Nirvana!
</code></pre>
<h2><a name="p-5921-once-again-you-are-the-arbiter-of-your-experience-4" class="anchor" href="2.html#p-5921-once-again-you-are-the-arbiter-of-your-experience-4"></a>Once Again, You Are The Arbiter of Your Experience...</h2>
<p>Because I want to emulate Rebol2 and Red, I'm going to always look to make sure there are ways for everyone to get what they want.  And when you can take module isolation for granted as working properly... you should still be able to interoperate with other codebases--even if you pick something fundamentally different.</p>
<p>So if you wind up wanting it, you can say:</p>
<pre><code>func: adapt :func [
    body: compose [return (as group! body)]
]
</code></pre>
<p>With this, you'll get these semantics:</p>
<pre><code>bar: function [
    return: [integer!]
    arg [logic!]
][
    return: adapt :return [value: value + 300]
    if arg [
       return 4
    ]
    720
]

&gt;&gt; bar true
== 304

&gt;&gt; bar false
== 1020  ; the injected RETURN ran behind the scenes
</code></pre>
<p><a class="mention" href="https://rebol.metaeducation.com/u/gchiu">@gchiu</a> seemed to think that was sensible.</p>
<p>But I like things being less sneaky, I'd be more in favor of:</p>
<pre><code>func: adapt :func [
    any [
         find spec [return: &lt;none&gt;]
         find spec [return: &lt;void&gt;]
    ] else [
        body: compose [
            (as group! body)
            fail "HEY YOU FORGOT YOUR RETURN!"
        ]
    ]
]
</code></pre>
<p><strong>But this is where the adaptability is the great strength.</strong>  I make the core coherent and work.  Then you configure it how you like.</p>
<p>I think not erroring--but not letting a result drop out--is a good compromise.  It lets people who want to write "procedure"-like things do so without being forced to put in a RETURN they don't want.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../how-attached-are-we-to-functions-return-last-result/1219/5.html">How Attached are we to Functions Return Last Result?</a>
                        <meta itemprop='position' content='1'>
                      </div>
                </div>
          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../1656.html#post_2">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
