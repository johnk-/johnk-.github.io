<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Performance Implications of Antiform-FRAME!-is-Action - #2 by hostilefork - Optimization - AltRebol</title>
    <meta name="description" content="Making the antiform state of frames be &amp;quot;interpret this frame as an action when referenced through a WORD!&amp;quot; is a deep change.  The implications haven&amp;#39;t been fully absorbed, and there are some things I noticed that create &amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../2083.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Performance Implications of Antiform-FRAME!-is-Action&#39;" href="../2083.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/2415b9c261f2f11e18382b622ac6025a1148e3fc.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/2415b9c261f2f11e18382b622ac6025a1148e3fc.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/performance-implications-of-antiform-frame-is-action/2083/2" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/performance-implications-of-antiform-frame-is-action/2083/2" />
<meta property="og:title" content="Performance Implications of Antiform-FRAME!-is-Action" />
<meta name="twitter:title" content="Performance Implications of Antiform-FRAME!-is-Action" />
<meta property="og:description" content="Another Performance Wrinkle: Looking In Two Places During the argument gathering process, when the evaluator is visiting a slot it needs to have one of two things on hand:   the parameter specification (so it can know if it&#39;s a refinement or quoted or whatever while it gathers it)  -or- the specialized value  With the idea that FRAME!s are just automatically transmuted into actions by virtue of being antiform, we are saying that the specialization comes from the frame&#39;s cell for that slot if it..." />
<meta name="twitter:description" content="Another Performance Wrinkle: Looking In Two Places During the argument gathering process, when the evaluator is visiting a slot it needs to have one of two things on hand:   the parameter specification (so it can know if it&#39;s a refinement or quoted or whatever while it gathers it)  -or- the specialized value  With the idea that FRAME!s are just automatically transmuted into actions by virtue of being antiform, we are saying that the specialization comes from the frame&#39;s cell for that slot if it..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Optimization" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2023-12-20T22:38:25+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../2083.html">Performance Implications of Antiform-FRAME!-is-Action</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/optimization/53" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/optimization/53" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Optimization</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Performance Implications of Antiform-FRAME!-is-Action'>
      <link itemprop='url' href='../2083.html'>
      <meta itemprop='datePublished' content='2023-12-20T02:09:21Z'>
        <meta itemprop='articleSection' content='Optimization'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'>
          </span>
        <meta itemprop='text' content='Making the antiform state of frames be &amp;quot;interpret this frame as an action when referenced through a WORD!&amp;quot; is a deep change.  The implications haven&amp;#39;t been fully absorbed, and there are some things I noticed that create &amp;hellip;'>

          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>


                <link itemprop="image" href="../../../uploads/default/original/1X/2415b9c261f2f11e18382b622ac6025a1148e3fc.png">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2023-12-20T22:38:25Z' class='post-time'>
                    December 20, 2023, 10:38pm
                  </time>
                  <meta itemprop='dateModified' content='2025-04-20T18:25:13Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="2083">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<pre><code>&gt;&gt; f: make frame! :append
== make frame! [
    series: ~
    value: ~
    part: ~
    dup: ~
    line: ~
]
</code></pre>
</blockquote>
</aside>
<h2><a name="p-6772-another-performance-wrinkle-looking-in-two-places-1" class="anchor" href="2.html#p-6772-another-performance-wrinkle-looking-in-two-places-1"></a>Another Performance Wrinkle: Looking In Two Places</h2>
<p>During the argument gathering process, when the evaluator is visiting a slot it needs to have one of two things on hand:</p>
<ul>
<li><strong>the parameter specification</strong> (so it can know if it's a refinement or quoted or whatever while it gathers it)<br>
-or-</li>
<li><strong>the specialized value</strong></li>
</ul>
<p>With the idea that FRAME!s are just automatically transmuted into actions by virtue of being antiform, we are saying that the specialization comes from the frame's cell for that slot if it's not "trash" (~ antiform).  But if it <em>is</em> trash, we have to look somewhere else for the parameter information (namely the "parent" of the frame--whatever frame this was copied or instantiated from).</p>
<p><em>Having to look in two different places adds a not-insignificant cost.</em>  It means traversing two lists instead of one (incrementing two unrelated pointers), and is also a locality issue from not being able to just work on one location.</p>
<p>That caused me to wonder if the moment I describe of a <code>Force_Frame_Runnable()</code> that locks the frame and caches optimizations could sneakily write in the parameter information over any unset cells.  This would be done only once, and execution could be faster.</p>
<p>But this would weave a tangled web.  It would mean that an actual specialized frame would wind up looking like this after an execution:</p>
<pre><code>&gt;&gt; f
== make frame! [
    series: ~#[parameter! [types: [any-series?] refinement: ~false~ ...]]~
    value: 5
    part: ~#[parameter! [types: [integer! any-series?] refinement: ~true~ ...]]~
    dup: ~#[parameter! [types: [integer!] refinement: ~true~ ...]]~
    line: ~#[parameter! [types: ~null~  refinement: ~true~ ...]]~
]
</code></pre>
<p><em>(If you're wondering what a PARAMETER! is, it's an internal type which I've been inching toward exposing as a user-visible type for manipulating parameters.  Basically a compressed object--something like R3-Alpha's EVENT!--which only has very specific fields pertinent to parameter fulfillment.)</em></p>
<p>Hence I've been wracking my brain trying to figure out how to preserve the illusion of these fields being unset, when they've actually got a parameter specification in them.</p>
<p><em>It's a difficult illusion to implement</em>, and trying to do so starts bending the codebase pretty far from the goal of simplicity, just to accomplish some more performance.</p>
<h2><a name="p-6772-what-if-we-embrace-parameter-as-unspecialized-2" class="anchor" href="2.html#p-6772-what-if-we-embrace-parameter-as-unspecialized-2"></a>WHAT IF... We Embrace PARAMETER!-as-Unspecialized?</h2>
<p><strong>This way the "optimization" of using an unspecialized parameter slot to hold a parameter definition becomes the actual way in which parameters can be specified and reflected.</strong></p>
<p>You could build a function from scratch by making a FRAME! with these antiform parameters in it, and then ADAPT'ing some code into it.</p>
<pre><code>&gt;&gt; f: make frame! [x: anti make parameter! [integer!]]
== make frame! [
    x: ~#[parameter! [integer!]]~  ; anti
]

&gt;&gt; test: adapt f [print ["x is" x]]
== ~#[frame! ...]~  ; anti

&gt;&gt; test 10
x is 10
</code></pre>
<p>This is starting to look very much like my prophetic post: <strong><a href="../../seeing-all-action-s-as-variadic-frame-makers/1002.html">"Seeing all ACTION!s as Variadic FRAME!-makers"</a></strong>.  The idea gives the reflection we'd want of being able to extract the parameter information, as well as to be able to modify it.  The help string could actually go inside the parameter as well, which would solve some bloat that we experience due to putting this in a copied state elsewhere.</p>
<p>This would also mean that you could specialize parameters to be trash, as an isotopic parameter would be the only kind of value you couldn't specialize to.  The term for an isotopic parameter! could be "unspecialized?", so above <strong>unspecialized? f.series</strong> would return true.</p>
<h2><a name="p-6772-what-about-downsides-3" class="anchor" href="2.html#p-6772-what-about-downsides-3"></a>What About Downsides?</h2>
<p>Obviously the rendering is hideous, and I lament losing the elegance of the ~ that the unset state had.  The web console has much more leeway than a pure text one (for this and other rendering difficulties), like being able to show a collapsed form you can expand for more details.</p>
<p>We could try workarounds, like simply abbreviating when things are inside the frame, and then blow them up when they were extracted:</p>
<pre><code>&gt;&gt; f: make frame! [x: isotopic make parameter! [integer!]
== make frame! [
    x: ~#[parameter! ...]~
]

&gt;&gt; f.x
== ~#[parameter! [integer!]]  ; anti
</code></pre>
<p>You wouldn't be able to use DEFAULT to act on unspecialized fields, like <strong>f.x: default [...]</strong>, unless DEFAULT was rethought to consider unspecialized states as one of the things it considers "non-valued".</p>
<p>Once you overwrote an unspecialized slot, there wouldn't be an easy way to undo it.  Not necessarily important... just mentioning that it's different from today, where you can put a value in a slot and then change your mind by just overwriting it with trash again.</p>
<p>Using an unspecialized frame state wouldn't cause an error on access (though we'd presume there'd be relatively few places you could pass an antiform parameter as an argument, especially since they're not legal in parameter fulfillments since they represent the unspecialized state).</p>
<h2><a name="p-6772-still-only-partial-exposure-of-frame-magic-4" class="anchor" href="2.html#p-6772-still-only-partial-exposure-of-frame-magic-4"></a>Still Only Partial Exposure of FRAME! Magic</h2>
<p>The code that runs from a frame still lurks behind the scenes.  When you say <strong>adapt frame [...]</strong> to put code into it, you get back a FRAME! that looks identical to the one you put in--at least as far as the parameters and specializations are concerned.</p>
<p>This is kind of par for the course.  In JavaScript, digging into what it gives back for a function doesn't really give a body when you drill down...just the prototype:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../uploads/default/original/1X/2415b9c261f2f11e18382b622ac6025a1148e3fc.png" data-download-href="https://rebol.metaeducation.com/uploads/default/2415b9c261f2f11e18382b622ac6025a1148e3fc" title="image"><img src="../../../uploads/default/original/1X/2415b9c261f2f11e18382b622ac6025a1148e3fc.png" alt="image" data-base62-sha1="59dJCFLQg9e2oLJ4zASlYkpUcgs" width="426" height="478"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">426Ã—478 6.37 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>And of course, native code won't show a body (though we conceivably could expose the C code as a string, at the cost of having to ship that C code in the executable and take up space).</p>
<p>It's good to look at something like JavaScript just to get a reminder that nothing is perfect, and at least Ren-C's model is packing some serious functionality.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../2083.html#post_2">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
