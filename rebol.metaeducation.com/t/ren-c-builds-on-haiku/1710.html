<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ren-C Builds on Haiku! - Build System - AltRebol</title>
    <meta name="description" content="I didn&amp;#39;t realize bringing this up to date would take as long to tinker around with as it did (~ 8 hours), but... 
  
Why was it such a pain?... 
GCC 2.95.3 was Released in March 2001
Don&amp;#39;t let the 2017 build date fool yo&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="1710.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Ren-C Builds on Haiku!&#39;" href="1710.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/optimized/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5_2_1024x838.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/optimized/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5_2_1024x838.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/ren-c-builds-on-haiku/1710" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/ren-c-builds-on-haiku/1710" />
<meta property="og:title" content="Ren-C Builds on Haiku!" />
<meta name="twitter:title" content="Ren-C Builds on Haiku!" />
<meta property="og:description" content="I didn&#39;t realize bringing this up to date would take as long to tinker around with as it did (~ 8 hours), but...     Why was it such a pain?...  GCC 2.95.3 was Released in March 2001 Don&#39;t let the 2017 build date fool you.  That&#39;s a 20-year old compiler, which we assume has the occasional Haiku patch here and there.  I knew the compiler that came with Haiku had been old.  But when I was making decisions about letting go of C89 support (in the core) I figured that Haiku would be bumping their ver..." />
<meta name="twitter:description" content="I didn&#39;t realize bringing this up to date would take as long to tinker around with as it did (~ 8 hours), but...     Why was it such a pain?...  GCC 2.95.3 was Released in March 2001 Don&#39;t let the 2017 build date fool you.  That&#39;s a 20-year old compiler, which we assume has the occasional Haiku patch here and there.  I knew the compiler that came with Haiku had been old.  But when I was making decisions about letting go of C89 support (in the core) I figured that Haiku would be bumping their ver..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Build System" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:tag" content="best-of" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="13 ❤" />
<meta property="article:published_time" content="2021-09-10T17:28:40+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="1710.html">Ren-C Builds on Haiku!</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/build-system/44" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/build-system/44" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Build System</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/best-of.html' class='discourse-tag' rel="tag">best-of</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Ren-C Builds on Haiku!'>
      <link itemprop='url' href='1710.html'>
      <meta itemprop='datePublished' content='2021-09-10T17:28:40Z'>
        <meta itemprop='articleSection' content='Build System'>
      <meta itemprop='keywords' content='best-of'>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="1710.html">

                <link itemprop="image" href="../../uploads/default/original/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5.png">

              <span class="crawler-post-infos">
                  <time  datetime='2021-09-10T17:28:40Z' class='post-time'>
                    September 10, 2021,  5:28pm
                  </time>
                  <meta itemprop='dateModified' content='2025-04-16T09:55:22Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I didn't realize bringing this up to date would take as long to tinker around with as it did (~ 8 hours), but...</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5.png" data-download-href="https://rebol.metaeducation.com/uploads/default/1702f61a03d022ee405643e5defaa1521f3b7dd5" title="ren-c-haiku-2021"><img src="../../uploads/default/optimized/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5_2_610x500.png" alt="ren-c-haiku-2021" data-base62-sha1="3hzkeScW0sVzoA6Gja01IpM2cT3" width="610" height="500" srcset="../../uploads/default/optimized/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5_2_610x500.png, ../../uploads/default/optimized/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5_2_915x750.png 1.5x, ../../uploads/default/optimized/1X/1702f61a03d022ee405643e5defaa1521f3b7dd5_2_1220x1000.png 2x" data-dominant-color="A4B9CA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">ren-c-haiku-2021</span><span class="informations">1692×1386 184 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
<strong>Why was it such a pain?...</strong></p>
<h1><a name="p-5485-gcc-2953-was-released-in-march-2001httpsgccgnuorgreleaseshtml-1" class="anchor" href="1710.html#p-5485-gcc-2953-was-released-in-march-2001httpsgccgnuorgreleaseshtml-1"></a>GCC 2.95.3 was Released <a href="https://gcc.gnu.org/releases.html">in March 2001</a></h1>
<p><strong>Don't let the 2017 build date fool you.</strong>  That's a 20-year old compiler, which we assume has the occasional Haiku patch here and there.</p>
<p>I knew the compiler that came with Haiku had been old.  But when I was making decisions about letting go of C89 support (in the core) I figured that Haiku would be bumping their versions to support C99 at some point...</p>
<p><em>Nope.</em></p>
<p>The reason Haiku is still so far back appears to be because they depend on GCC 2.95 features that enable them to get binary compatibility with old BeOS packages.</p>
<p>You can install a more modern GCC if you like--but then you're off in the concerns of having multiple toolchains on your system.  And presumably it's harder to link up against the HaikuOS C++ platform APIs.  So I thought it would be a good proof of our light dependencies to build on what's there.</p>
<h2><a name="p-5485-note-not-just-us-mbedtls-dropped-their-c89-support-2" class="anchor" href="1710.html#p-5485-note-not-just-us-mbedtls-dropped-their-c89-support-2"></a>Note: Not Just Us, mbedTLS Dropped Their C89 Support</h2>
<p>Even the most die -hard of low-dependency systems have let go of the 80s.  In 2019, mbedTLS <a href="https://github.com/ARMmbed/mbedtls/issues/1484">ceased supporting C89</a>:</p>
<blockquote>
<p><em>"We've internally decided to drop support for C89 in the development branch. We've removed <code>-Wdeclaration-after-statement</code> to our build options in <code>CMakeLists.txt</code>. We run some builds with <code>gcc -std=c99 -pedantic</code> so we do test C99 compliance to a reasonable extent. Thus this issue is resolved."</em></p>
</blockquote>
<h2><a name="p-5485-options-were-either-give-up-or-revive-the-c98-build-3" class="anchor" href="1710.html#p-5485-options-were-either-give-up-or-revive-the-c98-build-3"></a>Options Were Either Give Up, Or Revive the C++98 Build</h2>
<p>At one point Ren-C was able to build as C++98.  I stopped seeing the point of maintaining this option...as it was silly to be keeping track of which features I could use from C++11 in which permutations.  So it was either you build as C or you build as C++11 (or higher).</p>
<p>But there really is no other choice with this GCC 2.95.  The code is now styled:</p>
<pre><code>printf("Here's a statement\n");

const char *str = "Here's a declaration after a statement";
</code></pre>
<p>The Haiku C compilation mode requires all your definitions to be before the statements:</p>
<pre><code>const char *str; 

printf("Here's a statement\n");

str = "Here's a declaration after a statement";
</code></pre>
<p><em>(Note: I hate that, because it makes maintenance much harder.  But <a href="https://rdrr.io/cran/httpuv/f/src/libuv/CONTRIBUTING.md">libuv is actually a holdout here</a>...they're carrying the torch for C89 and committers still have to code in that style.)</em></p>
<p>In any case, C++98 was able to do that.  So I revived the setting.  It wasn't too hard...I just made it act like the C build <em>almost all of the time</em>.  Hence no use of inheritance in REBVAL or anything like that.  It deviates only when it has to for compiler semantics.</p>
<h2><a name="p-5485-building-mbedtls-was-saved-by-a-pedantic-quirk-4" class="anchor" href="1710.html#p-5485-building-mbedtls-was-saved-by-a-pedantic-quirk-4"></a>Building mbedTLS Was Saved By A --pedantic Quirk</h2>
<p>While Ren-C was designed to compile as C or C++, mbedTLS is plain C.  C++ compilers will choke on some of the permissive treatment of <code>void*</code>.</p>
<p>I thought there'd be no way around this; because C++ compilers have no way to disable these errors.  <em>...or so I thought...</em>!</p>
<p>As it turns out, if you <em>raise</em> the error reporting level with "pedantic" warnings, the warning machinery notices the problems before the error!  And you can ignore warnings!</p>
<p>So oddly enough, I actually could compile the encryption code on Haiku (without having to go in and edit it).</p>
<h2><a name="p-5485-small-rewrites-needed-to-dodge-compiler-bugs-5" class="anchor" href="1710.html#p-5485-small-rewrites-needed-to-dodge-compiler-bugs-5"></a>Small Rewrites Needed To Dodge Compiler Bugs</h2>
<p>Minor changes were required to code that was triggering GCC 2.95 bugs that prevented the build.  I wouldn't be happy if I had to make a dozen changes for it, but it was a few.</p>
<p>I guess even if you write code that is correct, if you notice it triggering a compiler bug that may be a sign that it involves something hard for compilers to get right.  One might be able to balance the annoyance of having to make the change with the potential that maybe fewer compilers would be getting that bit wrong.</p>
<h2><a name="p-5485-networking-doesnt-work-but-after-libuv-switch-it-might-6" class="anchor" href="1710.html#p-5485-networking-doesnt-work-but-after-libuv-switch-it-might-6"></a>Networking Doesn't Work, But After LibUV Switch, It Might!</h2>
<p>I built the entirety of LibUV into the executable (even though I didn't technically have to).  And the filesystem code--which is now on libuv--seems to be working.</p>
<p>The networking isn't on libuv yet, and isn't seeming to work.  But maybe once it switches over, it will.  I mentioned that Haiku was one of the explicitly supported platforms of libuv.  So if all goes smoothly in that conversion, I imagine this will work!</p>
<h2><a name="p-5485-no-action-item-here-just-proving-it-could-be-done-7" class="anchor" href="1710.html#p-5485-no-action-item-here-just-proving-it-could-be-done-7"></a>No Action Item Here, Just Proving It Could Be Done</h2>
<p>This was a good head-check of what exactly has changed as Ren-C has refactored and evolved.  Letting certain dependencies creep in can make your source less adaptable and agile...and this helps be assured that things are still on track.</p>
<p>What's important here isn't "oh, now we can have millions of HaikuOS users".  Rather it serves as another example of managed dependency control--to lend confidence to the idea that porting to other new ones should be easy enough.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="6" />
              <span class='post-likes'>6 Likes</span>
            </div>

          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/cggong.html'><span itemprop='name'>cggong</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-12-14T22:26:21Z' class='post-time'>
                    December 14, 2021, 10:26pm
                  </time>
                  <meta itemprop='dateModified' content='2021-12-14T22:26:21Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>It's fascinating to know about Haiku, and that Ren-C is able to port there.<br>
I'm new to Ren-C and I just built Ren-C on my MacBook. It was a smooth experience. I tried a few Rebol-derived binaries, and only Ren-C works out of the box on both of my MacBooks.</p>
<aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="1710">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>The Haiku C compilation mode requires all your definitions to be before the statements:</p>
</blockquote>
</aside>
<p>To be pedantic, definitions and declarations are <a href="https://stackoverflow.com/questions/1410563/what-is-the-difference-between-a-definition-and-a-declaration" rel="noopener nofollow ugc">different</a>, which you probably know.<br>
Anyway, I like putting declarations before statements because I try to write C as portable assembly, keeping in mind how the assembly would look like when writing C. Putting declarations first makes it easier to reason about the assembly.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-12-14T22:43:19Z' class='post-time'>
                    December 14, 2021, 10:43pm
                  </time>
                  <meta itemprop='dateModified' content='2021-12-14T22:43:19Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="cggong" data-post="2" data-topic="1710">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../letter_avatar_proxy/v4/letter/c/71c47a/48.png" class="avatar"> cggong:</div>
<blockquote>
<p>I'm new to Ren-C</p>
</blockquote>
</aside>
<p>Hello there... and welcome... though we continue to be in an extremely experimental state which is really trying to explore what kinds of potentials there are in the odd medium of Rebol-like languages.  It's tough to onboard anyone as a user or participant, and so generally things just stay quiet, imagining that it would be the sort of thing that gets advertised "...someday".</p>
<p>(There are some cool tricks, but also a huge mess of half-implemented and not-documented things.  I think of it more like an interesting game than I do a tool for "real work".  All of its quirky novelty isn't going to help anyone with a deadline.  However, there's certainly interesting things to see for those who are persistent with it.)</p>
<aside class="quote no-group" data-username="cggong" data-post="2" data-topic="1710">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../letter_avatar_proxy/v4/letter/c/71c47a/48.png" class="avatar"> cggong:</div>
<blockquote>
<p>I just built Ren-C on my MacBook. It was a smooth experience</p>
</blockquote>
</aside>
<p>Glad to hear it.  "rebmake" is kind of a disaster, and this post explains how it got that way:</p>
<p><a href="../new-build-executables-new-build-strategy/1432/index.html" class="inline-onebox">New Build Executables, New Build Strategy</a></p>
<p>As crazy as maintaining a bootstrap for that is, it does help exercise more code.  The goal of Ren-C is to be a maximally skinnable and bendable language, so bending to act like older iterations of itself is one of those challenges.</p>
<blockquote>
<p>I like putting declarations before statements because I try to write C as portable assembly, keeping in mind how the assembly would look like when writing C.</p>
</blockquote>
<p>Philosophy of initializing variables at their point of declaration aside...you might be a good candidate for appreciating what Ren-C is attempting to accomplish.</p>
<p>But please introduce yourself a bit in the <a href="../../c/introductions.html">Introductions Section</a> and I can try to answer or address anything particular that has made you curious about the project.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>


                <link itemprop="image" href="../../uploads/default/original/1X/7c4711b897578e7539b53e1004c4a38e2265706c.png">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2025-04-16T09:51:17Z' class='post-time'>
                    April 16, 2025,  9:51am
                  </time>
                  <meta itemprop='dateModified' content='2025-04-16T09:51:17Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="1" data-topic="1710">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>I knew the compiler that came with Haiku had been old. But when I was making decisions about letting go of C89 support (in the core) I figured that Haiku would be bumping their versions to support C99 at some point...</p>
<p><em>Nope.</em></p>
</blockquote>
</aside>
<p>So Haiku does now provide a modern toolchain out of the box.</p>
<p>All you have to do is say <strong><code>setarch x86</code></strong> and suddenly you've got gcc 13.3</p>
<p>Despite being modern, it's missing some things on Haiku like Address Sanitizer.  But it works well enough.</p>
<p><strong>After a long night of tinkering and consulting with AI... I have my working branch running, as the first R3-derived executable with networking on Haiku! (thanks to using libuv...)</strong></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/1X/7c4711b897578e7539b53e1004c4a38e2265706c.png" data-download-href="https://rebol.metaeducation.com/uploads/default/7c4711b897578e7539b53e1004c4a38e2265706c" title="image"><img src="../../uploads/default/optimized/1X/7c4711b897578e7539b53e1004c4a38e2265706c_2_609x499.png" alt="image" data-base62-sha1="hJpteebh5sPDIM6nPQG0aakRJZq" width="609" height="499" srcset="../../uploads/default/optimized/1X/7c4711b897578e7539b53e1004c4a38e2265706c_2_609x499.png, ../../uploads/default/original/1X/7c4711b897578e7539b53e1004c4a38e2265706c.png 1.5x, ../../uploads/default/original/1X/7c4711b897578e7539b53e1004c4a38e2265706c.png 2x" data-dominant-color="C7D1DA"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">707×580 61.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<h2><a name="p-8144-what-work-had-to-be-done-1" class="anchor" href="1710.html#p-8144-what-work-had-to-be-done-1"></a>What Work Had To Be Done?</h2>
<p>We're still in a state where the bootstrap executable is a different wonky old codebase that's fast and stable enough to build the current very-experimental branch.</p>
<p>So this means I had to get <em>two</em> codebases working, with fairly different concerns.</p>
<p>It did take a pretty long time, but a lot of that was me figuring out what to use for a debugger on Haiku, and just generally struggling with the medium.  (Finding the <strong><code>setarch x86</code></strong> was itself a good hour of discovery.)  The ultimate changes were somewhat minimal:</p>
<h3><a name="p-8144-haiku-memory-alignment-is-non-standard-2" class="anchor" href="1710.html#p-8144-haiku-memory-alignment-is-non-standard-2"></a>Haiku Memory Alignment is Non-Standard</h3>
<p>Ren-C has to have careful consideration to make sure that when raw memory is returned from a malloc() to be laid out by the system, that manual layout puts 64-bit <code>double</code> at 64-bit aligned pointers.</p>
<p>The way we do this alignment is by trusting that what comes back from malloc() is itself 64-bit aligned.  This is required by the standard:</p>
<blockquote>
<p><em>"If allocation succeeds, returns a pointer that is suitably aligned for any object type with <a href="https://en.cppreference.com/w/c/language/object#Alignment">fundamental alignment</a>."</em></p>
</blockquote>
<p>That should include double, hence at least 64-bits.  But Haiku's legacy aligns on 32-bit, and we have asserts and problems that start firing if we notice bad alignment.</p>
<p>I found a switch for <code>-malign-double</code> which tells gcc to align on 64-bit boundaries and I thought that fixed it well enough.  But unfortunately any Haiku system calls you make expect the structures to not have that alignment, and so you start to notice problems once you're making OS calls.</p>
<p>There's things you can do, like ask for an allocation that's slightly larger, and track when you have to offset it to match the alignment.  But the reason Haiku has managed to get away with this bad behavior is because they only have distributions on x86 (and now x64), where bad double alignments still work... they're just slower.  There's no need to bulletproof Ren-C for a non-C-standards-compliant system... in the 32-bit version of the OS... just to make accesses to double precision floating point faster.</p>
<p>So the right answer here was just to turn off alignment checking for Haiku (discovered only after figuring out <code>-malign-double</code> was the culprit for breaking OS calls).</p>
<h3><a name="p-8144-haikus-int_fast8_t-can-hold-255-3" class="anchor" href="1710.html#p-8144-haikus-int_fast8_t-can-hold-255-3"></a>Haiku's int_fast8_t can hold 255</h3>
<p>This is something where I screwed up, and said <code>int_fast8_t</code> where I should have said <code>uint_fast8_t</code>.  As it so happens, Mac ARM and x86 Linux and Windows all use a signed char to implement <code>int_fast8_t</code>, so if you assign 255 to it you'll get -1 ... but Haiku uses a larger signed int, so it's still 255.</p>
<p>Pretty random, but took a while to figure out what was going on.</p>
<h3><a name="p-8144-explicit-includes-needed-some-places-4" class="anchor" href="1710.html#p-8144-explicit-includes-needed-some-places-4"></a>Explicit includes needed some places</h3>
<p>Haiku apparently factors the headers a bit more.  e.g. you can't just say <code>#include &lt;termios.h&gt;</code> and get everything, you have to say:</p>
<pre><code>#include &lt;sys/select.h&gt;  // for FD_ZERO, FD_SET, select()
#include &lt;sys/time.h&gt;    // for struct timeval
#include &lt;sys/types.h&gt;   // for fd_set

#include &lt;termios.h&gt;
</code></pre>
<h3><a name="p-8144-different-sized-network-address-info-for-ipv4-addresses-5" class="anchor" href="1710.html#p-8144-different-sized-network-address-info-for-ipv4-addresses-5"></a>Different-sized network address info for IPv4 addresses</h3>
<p>As a kind of sanity check on what was going on, I had an assert that for an IPv4 address:</p>
<pre><code>assert(req.addrinfo-&gt;ai_addrlen == 16);
</code></pre>
<p>But for whatever reason this isn't true on Haiku, it has seemingly extra space...that you can ignore.  It's voodoo to me.  I changed the assert:</p>
<pre><code>assert(req.addrinfo-&gt;ai_addrlen &gt;= 16);
</code></pre>
<h2><a name="p-8144-anyway-gave-up-on-the-c98-build-6" class="anchor" href="1710.html#p-8144-anyway-gave-up-on-the-c98-build-6"></a>Anyway, Gave Up on the C++98 Build</h2>
<p>It was an interesting trick to use the super old compiler to build Ren-C.  But it's no longer necessary, and I think TCC represents a better choice for a minimal target--more likely to be applicable to strange embedded platforms than Haiku's old compiler.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../oldes-rebol3-19-0-on-haiku-etc/2417.html">Oldes Rebol3.19.0 on Haiku, etc.</a>
                        <meta itemprop='position' content='2'>
                      </div>
                </div>
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
