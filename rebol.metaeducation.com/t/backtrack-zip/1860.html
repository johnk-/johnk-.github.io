<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Backtrack: Zip - R3C - AltRebol</title>
    <meta name="description" content="In contemplating what I&amp;#39;m looking to achieve with R3C, I&amp;#39;ve been backtracking on ways in which I&amp;#39;ve/we&amp;#39;ve approached working with common formats. 
I&amp;#39;ve mused over Zip before and given thought I&amp;#39;d revisit this first. This&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="1860.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Backtrack: Zip&#39;" href="1860.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/backtrack-zip/1860" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/backtrack-zip/1860" />
<meta property="og:title" content="Backtrack: Zip" />
<meta name="twitter:title" content="Backtrack: Zip" />
<meta property="og:description" content="In contemplating what I&#39;m looking to achieve with R3C, I&#39;ve been backtracking on ways in which I&#39;ve/we&#39;ve approached working with common formats.  I&#39;ve mused over Zip before and given thought I&#39;d revisit this first. This time in Rebol 2 (along with a core-friendly Deflate implementation).  Unpacking First goal here is versatility: no unzip and be doneâ€”rather try to isolate the atomic steps of retrieval so as to offer more control over the process. Thus:  archive: zip/load %archive.zip  Returns a..." />
<meta name="twitter:description" content="In contemplating what I&#39;m looking to achieve with R3C, I&#39;ve been backtracking on ways in which I&#39;ve/we&#39;ve approached working with common formats.  I&#39;ve mused over Zip before and given thought I&#39;d revisit this first. This time in Rebol 2 (along with a core-friendly Deflate implementation).  Unpacking First goal here is versatility: no unzip and be doneâ€”rather try to isolate the atomic steps of retrieval so as to offer more control over the process. Thus:  archive: zip/load %archive.zip  Returns a..." />
<meta property="og:article:section" content="Domains" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:section" content="R3C" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:tag" content="zip" />
<meta property="og:article:tag" content="core" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="7 â¤" />
<meta property="article:published_time" content="2022-07-04T20:23:47+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="1860.html">Backtrack: Zip</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/domains/r3c/58" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/domains/r3c/58" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>R3C</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/zip.html' class='discourse-tag' rel="tag">zip</a>, 
            <a href='../../tag/core.html' class='discourse-tag' rel="tag">core</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Backtrack: Zip'>
      <link itemprop='url' href='1860.html'>
      <meta itemprop='datePublished' content='2022-07-04T20:23:47Z'>
        <meta itemprop='articleSection' content='R3C'>
      <meta itemprop='keywords' content='zip, core'>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/rgchris'><span itemprop='name'>rgchris</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="1860.html">


              <span class="crawler-post-infos">
                  <time  datetime='2022-07-04T20:23:47Z' class='post-time'>
                    July 4, 2022,  8:23pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-04T20:23:47Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>In contemplating what I'm looking to achieve with R3C, I've been backtracking on ways in which I've/we've approached working with common formats.</p>
<p>I've <a href="../anatomy-of-a-zip-scheme/160.html">mused over Zip</a> before and given thought I'd revisit this first. <a href="https://github.com/rgchris/Scripts/blob/master/rebol-2/zip.r">This time in Rebol 2</a> (along with a <a href="https://github.com/rgchris/Scripts/blob/master/rebol-2/deflate.r">core-friendly Deflate</a> implementation).</p>
<h1><a name="p-5982-unpacking-1" class="anchor" href="1860.html#p-5982-unpacking-1"></a>Unpacking</h1>
<p>First goal here is versatility: no <em>unzip and be done</em>â€”rather try to isolate the atomic steps of retrieval so as to offer more control over the process. Thus:</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">archive: zip/load %archive.zip
</code></pre>
<p>Returns an object representing the archive and</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">entry: zip/step archive
</code></pre>
<p>Will return the next entry (or none if at the end). So far nothing has been decompressed thus is a relatively cheap operation. Metadata for that entry such as filename/date is readily available.</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">entry/filename
entry/date
</code></pre>
<p>As is the compressed content itself:</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">content: zip/unpack entry
</code></pre>
<p>With these building blocks, it's easy enough to extract a whole archive or target specific files:</p>
<pre data-code-wrap="rebol"><code class="lang-rebol">doc: zip/load %document.odt

while [
    file: zip/step doc
][
    if file/filename == %mimetype [
        probe zip/unpack file
        ; =&gt; "application/vnd.oasis.opendocument.text"
    ]
]
</code></pre>
<h1><a name="p-5982-packing-2" class="anchor" href="1860.html#p-5982-packing-2"></a>Packing</h1>
<p>This presented a few conceptional challenges as to how one represents archives/entries in construction. Essentially an archive is a block of entry objects sharing the same structure as above (conceptually you could just throw those extracted entry objects into a block and pack them, but in writing this I don't recall if I implemented thatâ€”need to go back and look, would be cool if so).</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">new-archive: reduce [
    zip/prepare %thing #{01234567}
]

write %thing.zip zip/pack new-archive
</code></pre>
<p>Again, a key here is to keep the steps atomized so they can be handled in different ways. One such way is a wrapper that provides shorthand contextual functions (in one sense a 'dialect' but is just regular code).</p>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">write %thing.zip zip/build [
    add-file %mimetype "application/x-rebol+zip"

    repeat count 3 [
        add-file join %thing- count #{01234567}
    ]

    add-comment "A possibly useful note"
]
</code></pre>
<h1><a name="p-5982-relevance-3" class="anchor" href="1860.html#p-5982-relevance-3"></a>Relevance</h1>
<p>I don't think anything here resembles anything particularly revolutionary, only that it's a departure from the typical Rebol way of doing things that I think opens up some possibilities. This isn't an end point, there's a bit more digging to do</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../backtrack-pdf/1861.html">Backtrack: PDF</a>
                        <meta itemprop='position' content='4'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../bincode/1863.html">&quot;Bincode&quot;</a>
                        <meta itemprop='position' content='5'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../the-parse-of-progress/1349/4.html">The PARSE of PROGRESS</a>
                        <meta itemprop='position' content='6'>
                      </div>
                </div>
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-04T21:19:15Z' class='post-time'>
                    July 4, 2022,  9:19pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-04T21:45:19Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I think it's a good approach (and a good tool for building higher-level zip dialects).</p>
<p>(Maybe it could be called ZIPPER or something like that to speak of its generality, and save ZIP for higher-level tools that could be very situationally specific to what people are doing in a particular project?  Doesn't matter as everyone can redefine everything.)</p>
<p>I would put in a plug for wherever this goes supporting the creation of a URI! for generalized reading, e.g. extracting single file, which I've mentioned before:</p>
<pre><code>data: read zip://wherever/something.zip/folder/file.dat
</code></pre>
<p>But that would be built on top of this.</p>
<aside class="quote no-group" data-username="rgchris" data-post="1" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/rgchris/48/14_2.png" class="avatar"> rgchris:</div>
<blockquote>
<p>First goal here is versatility: no <em>unzip and be done</em>â€”rather try to isolate the atomic steps of retrieval so as to offer more control over the process.</p>
</blockquote>
</aside>
<p>I've been skeptical of the arity-2 unzip, because I feel like UNZIP with the "unzip and be done" should take a file/url/binary and dump it in the "current directory".  (But the current directory should be able to be in memory in a virtual filesystem...)</p>
<blockquote>
<pre><code>archive: zip/load %archive.zip
</code></pre>
</blockquote>
<p>My first thought was "hey that's kind of like a <a href="../yielder-and-generator-and-thinking-about-coroutines/1311.html">generator or yielder</a>" <em>(note: not merged into mainline builds yet, though the stackless abilities they depend on are merged)</em></p>
<p>So I thought "maybe it could be an 'unzipper'"</p>
<pre><code>archive: unzipper %archive.zip  ; hmmm
</code></pre>
<p>But that makes ARCHIVE a function, which is hard to name.  Your approach is probably better to have the archive separately represent the state, and then call operations on it.</p>
<p><em>That said</em>, a generator/yielder might be useful in the internal implementation.  It may be easier to write ZIP/STEP if your enumeration can stay in the middle of whatever loop it's in and YIELD the data at each step, then communicate with the stepper.</p>
<blockquote>
<pre><code>write %thing.zip zip/build
</code></pre>
</blockquote>
<p>So zips can not only be read as streams, but also written as streams.  <a href="https://github.com/metaeducation/ren-c/blob/d4f0d1f281a0329f14d2e8f4f126eb9564ac7e91/scripts/unzip.reb#L345">I remark on something interesting about that</a>, involving a bug fixed in Ren-C's unzip:</p>
<pre><code>; NOTE: The original rebzip.r did decompression based on the local file
; header records in the zip file.  But due to streaming compression
; these can be incomplete and have zeros for the data sizes.  The only
; reliable source of sizes comes from the central file directory at
; the end of the archive.  That might seem redundant to those not aware
; of the streaming ZIP debacle, because a non-streaming zip can be
; decompressed without it...but streaming files definitely exist!
</code></pre>
<p>I guess since streamed-zip-writing came later in the lifetime of zip, there were a lot of files that had all the compressed sizes up front.  Enough so that some decompressions (at least unzip.reb) presumed that the person who wrote the files was <em>able</em> to go back and patch the bytes at the earlier point in the file.</p>
<p>Anyway, the point being that streaming zip writing is a thing.  Since you're looking at more granular means of not putting everything in memory at once, that might be relevant to consider... in terms of how the ZIP/BUILD might be able to emit information to a port as it goes.</p>
<p>Of course that's all in the "we don't know quite how to do this"...but stackless and green threads are things I believe will play in big with the streaming puzzle.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/rgchris'><span itemprop='name'>rgchris</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-04T21:48:49Z' class='post-time'>
                    July 4, 2022,  9:48pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-04T21:48:49Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I think in-memory is important when approaching Zip as a file format (ODT, ePub, etc) as opposed to an archive, so having a skeleton that can go in different directions is key</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/rgchris'><span itemprop='name'>rgchris</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-04T22:05:36Z' class='post-time'>
                    July 4, 2022, 10:05pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-04T22:05:36Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="2" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>Since you're looking at more granular means of not putting everything in memory at once, that might be relevant to consider... in terms of how the ZIP/BUILD might be able to emit information to a port as it goes.</p>
</blockquote>
</aside>
<p>Yes, but (and not a show stopper)â€”within ZIP/BUILD, individual functions return the entry so it can be manipulated:</p>
<pre data-code-wrap="rebol"><code class="lang-rebol">write %thing.zip zip/build [
    mimetype: add-file %mimetype "application/x-rebol+zip"
    mimetype/date: now - 10
    mimetype/is-executable: true
]
</code></pre>
<p>I mean, sureâ€”ADD-FILE could be refined to handle options, just food for thought</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-04T22:13:32Z' class='post-time'>
                    July 4, 2022, 10:13pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-04T22:13:32Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="rgchris" data-post="4" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/rgchris/48/14_2.png" class="avatar"> rgchris:</div>
<blockquote>
<pre><code>mimetype: add-file %mimetype "application/x-rebol+zip"
mimetype/date: now - 10
mimetype/is-executable: true
</code></pre>
</blockquote>
</aside>
<p>That is a good ability.  I guess I'd have to review to see how many of these attributes can be deferred to the directory at the end of the stream... maybe all of them can?</p>
<p>If so, ADD-FILE could already have sent the file over a network or whatever (maybe even be done by the time it returned, if it was quick).  Then if it keeps a memory of these metadata objects, it could write all your changes at the end...if it waited to write the directory until the very end of the build.</p>
<p>But anything that needs to be on the entry itself would have to be part of the input to ADD-FILE or you couldn't assume you could start streaming it yet.</p>
<p>(I haven't looked at zip in a while, so my knowledge is rusty.)</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/rgchris'><span itemprop='name'>rgchris</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-05T00:32:07Z' class='post-time'>
                    July 5, 2022, 12:32am
                  </time>
                  <meta itemprop='dateModified' content='2022-07-05T00:32:07Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="5" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>I'd have to review to see how many of these attributes can be deferred to the directory at the end of the stream</p>
</blockquote>
</aside>
<p>You can possibly get away deferring everything to the index, howeverâ€”I think it is considered best practice to have the index and entries match (<em><a href="https://www.bamsoftware.com/hacks/zipbomb/">A better Zip Bomb</a></em> is my guardrail for this)</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/rgchris'><span itemprop='name'>rgchris</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-08T17:19:07Z' class='post-time'>
                    July 8, 2022,  5:19pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-08T17:19:07Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="hostilefork" data-post="2" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>(Maybe it could be called ZIPPER or something like that to speak of its generality, and save ZIP for higher-level tools that could be very situationally specific to what people are doing in a particular project? Doesn't matter as everyone can redefine everything.)</p>
</blockquote>
</aside>
<p>There's a few areas where this would apply and I'm increasing leaning toward taking the format name (noun) and using that as a namespace for all operations pertaining to that format (where that makes sense). I know that ZIP(/UNZIP) is familiar as a verb, but I'm tending to find that starting from here leads to burning such words on such a narrow subset</p>
<p>I'd add DEFLATE(/INFLATE) as another data point: Deflate (the format) has more nuance to it than <code>thing &lt;-&gt; compressed-thing</code>. The current INFLATE verb, for instance, doesn't take advantage of Deflate's self-terminating quality, thus while it meets the most common need, more words are required for more subtle usage.</p>
<p>One solution could be to group such words in a single context: e.g. <code>formats/zip/unpack</code>. Idk, depends how messy that gets in code I guess.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2022-07-08T17:22:08Z' class='post-time'>
                    July 8, 2022,  5:22pm
                  </time>
                  <meta itemprop='dateModified' content='2022-07-08T17:22:08Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="rgchris" data-post="7" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/rgchris/48/14_2.png" class="avatar"> rgchris:</div>
<blockquote>
<p>I know that ZIP(/UNZIP) is familiar as a verb, but I'm tending to find that starting from here leads to burning such words on such a narrow subset</p>
</blockquote>
</aside>
<p>Maybe <strong><code>encode zip</code></strong> and <strong><code>decode zip</code></strong> could be a literate way of asking for the operation, leaving <strong>zip.xxx</strong> available as a namespace...</p>
<p><em>(This puts the burden on ENCODE and DECODE for explaining exactly what all it is they bring to the table as verbs, and what the "value-add" is over <code>zip.encode</code> and <code>zip.decode</code> as plain functions...but articulating that "value-add" is needed system-wide for things like READ and such as well.)</em></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2024-09-17T02:01:19Z' class='post-time'>
                    September 17, 2024,  2:01am
                  </time>
                  <meta itemprop='dateModified' content='2024-09-17T02:09:44Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="rgchris" data-post="1" data-topic="1860">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/rebol.metaeducation.com/rgchris/48/14_2.png" class="avatar"> rgchris:</div>
<blockquote>
<pre data-code-wrap="plaintext"><code class="lang-plaintext">write %thing.zip zip/build [
    add-file %mimetype "application/x-rebol+zip"

    repeat count 3 [
        add-file join %thing- count #{01234567}
    ]

    add-comment "A possibly useful note"
]
</code></pre>
</blockquote>
</aside>
<p>Though <a class="mention" href="https://rebol.metaeducation.com/u/rgchris">@rgchris</a> has had other things in life to deal with the last couple of years, we talked tonight.  We touched base on topics of whether the current isotope design meets with his approval--which is important as I consider him the Czar of Aesthetics.  It sounds like he's given his seal of approval to <a href="../which-antiforms-are-in-use/2276.html">the results</a>.  <img src="../../images/emoji/twitter/person_with_crown.png%3Fv=14" title=":person_with_crown:" class="emoji" alt=":person_with_crown:" loading="lazy" width="20" height="20"></p>
<p>We also spoke about things of interest for him to come back to.  This ZIP rethinking came up as being a notable example--of what he considers doing things in a better way than had sort of inadvertently become canon in the Redbol world.</p>
<p>So I wanted to bump this topic <em>(and bring this to the attention of <a class="mention" href="https://rebol.metaeducation.com/u/bradrn">@bradrn</a>)</em>, in terms of what it means to use a "context-based" approach vs. a "dialect-based" approach to a problem.  It has more in common with COLLECT+KEEP than it does with the somewhat famous <strong><a href="http://www.rebol.org/view-script.r?script=rebzip.r">%rebzip.r</a></strong>, which had you build a "zip spec" which it would process:</p>
<blockquote>
<pre><code> you can zip a single file:
       zip %new-zip.zip %my-file

   a block of files:
       zip %new-zip.zip [%file-1.txt %file-2.exe]

   a block of data (binary!/string!) and files:
       zip %new-zip.zip [%my-file "my data"]

   a entire directory:
       zip/deep %new-zip.zip %my-directory/

   from a url:
       zip %new-zip.zip ftp://192.168.1.10/my-file.txt

   any combinaison of these:
       zip/deep %new-zip.zip  [
           %readme.txt "An example" 
           ftp://192.168.1.10/my-file.txt
           %my-directory
       ]
       
   [unarchiving: unzip]
   ! only works from REBOL/View,
   ! only understands methods 'store and 'deflate
   
   you can uncompress to a directory (created if inexistant):
       unzip %my-new-dir %my-zip-file.zip
   
   or a block:
       unzip my-block %my-zip-file.zip

       my-block == [%file-1.txt #{...} %file-2.exe #{...}]
</code></pre>
</blockquote>
<p><em>(Another example of reimagining the old ways is his <strong><a href="../backtrack-pdf/1861.html">"PDF Backtrack"</a></strong>)</em></p>
<p>Since Chris's time is limited, I'd like to focus on bringing whatever he considers to be the highest priority items to be ported to Ren-C and in continuous integration.</p>
<p>And this looks like something we might want to shift to using--instead of shipping with something like rebzip (which we currently use a derivation of).</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
