<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Simplifying Refinement Promotion - #2 by hostilefork - Functions - AltRebol</title>
    <meta name="description" content="There are two modes of partial specialization which Ren-C has supported. 
One form would be like if APPEND takes something like :DUP and fixes it to a value: 
&amp;gt;&amp;gt; append2: specialize append/ [dup: 2]

&amp;gt;&amp;gt; append2 [a b c] &amp;lt;d&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../2338.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Simplifying Refinement Promotion&#39;" href="../2338.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/simplifying-refinement-promotion/2338/2" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/simplifying-refinement-promotion/2338/2" />
<meta property="og:title" content="Simplifying Refinement Promotion" />
<meta name="twitter:title" content="Simplifying Refinement Promotion" />
<meta property="og:description" content="There May (?) Be More Than One Kind of Promotion Currently there is some code which lets you &quot;build a frame by example&quot;:  &gt;&gt; make frame! [match integer!] == #[frame! [     test: &amp;[integer!]     value: ~ ]]  Even though MATCH takes two arguments, the evaluator went as far as it could and then stopped, leaving extra arguments unspecified.  But... what about refinements that take arguments?  Historically what you would get with refinement promotion would move the DUP to the head of the parameter li..." />
<meta name="twitter:description" content="There May (?) Be More Than One Kind of Promotion Currently there is some code which lets you &quot;build a frame by example&quot;:  &gt;&gt; make frame! [match integer!] == #[frame! [     test: &amp;[integer!]     value: ~ ]]  Even though MATCH takes two arguments, the evaluator went as far as it could and then stopped, leaving extra arguments unspecified.  But... what about refinements that take arguments?  Historically what you would get with refinement promotion would move the DUP to the head of the parameter li..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Functions" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2025-01-13T20:59:22+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../2338.html">Simplifying Refinement Promotion</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/functions/59" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Functions</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Simplifying Refinement Promotion'>
      <link itemprop='url' href='../2338.html'>
      <meta itemprop='datePublished' content='2024-11-30T21:20:38Z'>
        <meta itemprop='articleSection' content='Functions'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'>
          </span>
        <meta itemprop='text' content='There are two modes of partial specialization which Ren-C has supported. 
One form would be like if APPEND takes something like :DUP and fixes it to a value: 
&amp;gt;&amp;gt; append2: specialize append/ [dup: 2]

&amp;gt;&amp;gt; append2 [a b c] &amp;lt;d&amp;hellip;'>

          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2025-01-13T20:59:22Z' class='post-time'>
                    January 13, 2025,  8:59pm
                  </time>
                  <meta itemprop='dateModified' content='2025-01-13T20:59:22Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h2><a name="p-8008-there-may-be-more-than-one-kind-of-promotion-1" class="anchor" href="2.html#p-8008-there-may-be-more-than-one-kind-of-promotion-1"></a>There May (?) Be More Than One Kind of Promotion</h2>
<p>Currently there is some code which lets you "build a frame by example":</p>
<pre><code>&gt;&gt; make frame! [match integer!]
== #[frame! [
    test: &amp;[integer!]
    value: ~
]]
</code></pre>
<p>Even though MATCH takes two arguments, the evaluator went as far as it could and then stopped, leaving extra arguments unspecified.</p>
<p><strong>But... what about refinements that take arguments?</strong></p>
<p>Historically what you would get with refinement promotion would move the DUP to the head of the parameter list and make it not a refinement... leaving :PART and :LINE as refinements:</p>
<pre><code>&gt;&gt; make frame! [append:dup [a b c] [d e]]
== #[frame! [
    series: [a b c]
    value: [d e]
    dup: ~  ; now has an associated PARAMETER! that's not a refinement
    part: ~  ; still a refinement
    line: ~  ; still a refinement
]]
</code></pre>
<p>But if you're just looking at this as a frame without comparing the parameter list, it doesn't seem different from how it would look if you hadn't specified the :DUP at all.</p>
<p>In order to not lose information about this specific instantiation, we need what might be called <strong>"narrowing refinement promotion"</strong>:</p>
<pre><code>&gt;&gt; make frame! [append:dup [a b c] [d e]]
== #[frame! [
    series: [a b c]
    value: [d e]
    dup: ~
]]
</code></pre>
<p>This means any refinements you didn't specify are gone from the interface.  Because you're trying to encode the intent of an invocation.</p>
<p><em>"The user has spoken: They want <strong><code>APPEND:DUP</code></strong>"</em></p>
<h2><a name="p-8008-what-if-this-was-the-only-refinement-promotion-type-2" class="anchor" href="2.html#p-8008-what-if-this-was-the-only-refinement-promotion-type-2"></a>What If This Was The <em>Only</em> Refinement Promotion Type?</h2>
<p>From the earliest days of FRAME!, I've been assuming that this is what should happen when you MAKE FRAME! on APPEND:</p>
<pre><code>&gt;&gt; make frame! append/
== #[frame! [
    series: ~
    value: ~
    part: ~
    dup: ~
    line: ~
]]
</code></pre>
<p>But in an parallel universe, what if I had assumed instead:</p>
<pre><code>&gt;&gt; make frame! append/
== #[frame! [
    series: ~
    value: ~
]]

&gt;&gt; make frame! append:part:dup/
== #[frame! [
    series: ~
    value: ~
    part: ~
    dup: ~
]]

&gt;&gt; make frame! append:dup:part/
== #[frame! [
    series: ~
    value: ~
    dup: ~
    part: ~
]]
</code></pre>
<h2><a name="p-8008-the-latter-is-the-only-use-for-refinement-promotion-so-far-3" class="anchor" href="2.html#p-8008-the-latter-is-the-only-use-for-refinement-promotion-so-far-3"></a>The Latter Is The Only Use for Refinement Promotion (So Far)</h2>
<p>e.g. I've never <em>actually</em> wanted to make a refinement that takes an argument become non-optional, unless the intent was specifically to model an invocation (that wouldn't be using any other optional parameters).</p>
<p>I do know I still want to be able to get a copy of a frame I can fill in all the fields as I wish.  But if I'm doing that, I'm not passing a refinement chain.  I either fix parameters completely...or not at all.</p>
<p>Anyway, MAKE FRAME! should be consistent in terms of how it answers.  If it's narrowing when given a variadic example (which it must be), seems it should be narrowing when given a refinement chain.</p>
<p>MAKE can legally perform evaluations:</p>
<pre><code>&gt;&gt; make frame! [append reverse [a b c]]
== #[frame! [
    series: [c b a]  ; had to evaluate to get that
    value: ~
]]

&gt;&gt; make frame! append/
== #[frame! [  ; should be consistently narrowing
    series: ~
    value: ~
]]
</code></pre>
<p>COPY FRAME! doesn't set PARAMETER! fields to <code>~</code> antiforms... and it shouldn't.  And TO FRAME! of a FRAME! has to be a synonym for COPY.</p>
<p>So... uh, name that operator:</p>
<pre><code>&gt;&gt; XXX append/
== #[frame! [
    series: ~
    value: ~
    part: ~
    dup: ~
    line: ~
]]
</code></pre>
<p>This has been a bit of an eye-opener.  <img src="../../../images/emoji/twitter/eyes.png%3Fv=14" title=":eyes:" class="emoji" alt=":eyes:" loading="lazy" width="20" height="20">  I'm going to have to think about it.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../should-end-able-constructs-all-use-meta-parameters/1783/5.html">Should END-able constructs all use ^META parameters?</a>
                        <meta itemprop='position' content='1'>
                      </div>
                </div>
          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../2338.html#post_2">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
