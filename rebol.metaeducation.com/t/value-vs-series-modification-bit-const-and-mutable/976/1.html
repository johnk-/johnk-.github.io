<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Value (vs. Series) Modification Bit: CONST and MUTABLE - Internals - AltRebol</title>
    <meta name="description" content="Every newbie to Rebol (and every experienced user too!) gets bitten by the intrinsic mutability of source series.   A common misunderstanding/mistake might look like: 
 blockify: func [x] [
    block: []
    append block&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../../source-mutability-const-and-mutable/976.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Value (vs. Series) Modification Bit: CONST and MUTABLE&#39;" href="../976.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/value-vs-series-modification-bit-const-and-mutable/976/1" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/value-vs-series-modification-bit-const-and-mutable/976/1" />
<meta property="og:title" content="Value (vs. Series) Modification Bit: CONST and MUTABLE" />
<meta name="twitter:title" content="Value (vs. Series) Modification Bit: CONST and MUTABLE" />
<meta property="og:description" content="Every newbie to Rebol (and every experienced user too!) gets bitten by the intrinsic mutability of source series.   A common misunderstanding/mistake might look like:   blockify: func [x] [     block: []     append block x     return block  ]   &gt;&gt; blockify 10  == [10]   &gt;&gt; blockify 20  == [10 20]  ; !!! why didn&#39;t `block: []` reset the block?  Some have deemed it easy enough to learn to say block: copy [].  But consider the following:  symbol-name: func [symbol [word!]] [      switch symbol [   ..." />
<meta name="twitter:description" content="Every newbie to Rebol (and every experienced user too!) gets bitten by the intrinsic mutability of source series.   A common misunderstanding/mistake might look like:   blockify: func [x] [     block: []     append block x     return block  ]   &gt;&gt; blockify 10  == [10]   &gt;&gt; blockify 20  == [10 20]  ; !!! why didn&#39;t `block: []` reset the block?  Some have deemed it easy enough to learn to say block: copy [].  But consider the following:  symbol-name: func [symbol [word!]] [      switch symbol [   ..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Internals" />
<meta property="og:article:section:color" content="25AAE2" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ❤" />
<meta property="article:published_time" content="2018-12-25T20:07:35+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../../source-mutability-const-and-mutable/976.html">Value (vs. Series) Modification Bit: CONST and MUTABLE</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/internals/9" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://rebol.metaeducation.com/c/development/internals/9" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Internals</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Value (vs. Series) Modification Bit: CONST and MUTABLE'>
      <link itemprop='url' href='../../source-mutability-const-and-mutable/976.html'>
      <meta itemprop='datePublished' content='2018-12-25T20:07:35Z'>
        <meta itemprop='articleSection' content='Internals'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="../../source-mutability-const-and-mutable/976.html">


              <span class="crawler-post-infos">
                  <time  datetime='2018-12-25T20:07:35Z' class='post-time'>
                    December 25, 2018,  8:07pm
                  </time>
                  <meta itemprop='dateModified' content='2024-11-20T00:47:55Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Every newbie to Rebol (and every experienced user too!) gets bitten by the intrinsic mutability of source series.   A common misunderstanding/mistake might look like:</p>
<pre><code> blockify: func [x] [
    block: []
    append block x
    return block
 ]

 &gt;&gt; blockify 10
 == [10]

 &gt;&gt; blockify 20
 == [10 20]  ; !!! why didn't `block: []` reset the block?
</code></pre>
<p>Some have deemed it easy enough to learn to say <strong><code>block: copy []</code></strong>.  But consider the following:</p>
<pre><code>symbol-name: func [symbol [word!]] [
     switch symbol [
         '+ ["plus"]
         '? ["question-mark"]
         ...
     ]
]
...
filename: append (symbol-name '+) ".dat"
</code></pre>
<p>This innocent-looking piece of code has a terrible bug.  <em>The string you return lives in the SWITCH, so the APPEND is actually mutating the string inside the SWITCH.</em>  Every subsequent call to SYMBOL-NAME will be affected.</p>
<p>I feel like it shouldn't be controversial to say <strong>it should not be this easy to write self-modifying code on accident.</strong>  Something equivalent to this (but trickier) caused a problem in the build system that took me hours to find.</p>
<p>If Rebol is supposed to be more than a toy, it needs answers for usage problems like this--where it is notably much more brittle than other languages.</p>
<h2><a name="p-2847-the-appends-above-must-fail-but-by-what-means-1" class="anchor" href="1.html#p-2847-the-appends-above-must-fail-but-by-what-means-1"></a>The APPENDs Above Must Fail, But By What Means?</h2>
<p>I want those examples to cause errors, vs. silently modify the blocks or strings resident in the bodies of functions.</p>
<p>Yet a lot of off-the-cuff scripting (and test code) relies on the mutability of source, e.g.:</p>
<pre><code>&gt;&gt; append [a b] 'c
== [a b c]
</code></pre>
<p>R3-Alpha had the concept of being able to PROTECT a series so that all references to it would be immutable.  But if we were to make a rule that all source series were permanently locked, that would be a heavy-handed policy that wouldn't permit alternate styles of coding <em>ever</em>.</p>
<p>I concluded that <strong>we needed another--lighter--form of lock</strong>...something that doesn't make <em>all</em> views of a series have to be unchanging for all time, but that different views of a series be read or write.  And constructs could fiddle this bit as they saw appropriate.</p>
<h2><a name="p-2847-meet-const-and-mutable-2" class="anchor" href="1.html#p-2847-meet-const-and-mutable-2"></a>Meet CONST and MUTABLE</h2>
<p>Ren-C's pioneering new feature is of <em>values</em> being able to be read only or not.  You can flip the bit yourself with the CONST and MUTABLE functions:</p>
<pre><code>&gt;&gt; data: [a b c]
== [a b c]

&gt;&gt; data-readonly: const data
== [a b c]

&gt;&gt; append data-readonly 'd
** Access Error: value is CONST (see MUTABLE): [a b c]

&gt;&gt; append data 'd
== [a b c d]

&gt;&gt; data-readonly
== [a b c d]

&gt;&gt; append mutable data-readonly 'e
== [a b c d e]
</code></pre>
<p>It's quite different from locking a series.  For instance: you can keep write access for yourself, while giving out const access to subroutines you don't want to be doing casual modifications.</p>
<p>But the real win here is that the execution of code defaults to putting a wave of constness on any slots the evaluator fills from "literals"...be those blocks or strings.  You see it catching the bug I introduced at the beginning of the post, of the string being changed inside the switch:</p>
<pre><code>&gt;&gt; filename: append (symbol-name '+) ".dat"
** Access Error: value is CONST (see MUTABLE): "plus"
</code></pre>
<h2><a name="p-2847-the-constructs-are-in-control-3" class="anchor" href="1.html#p-2847-the-constructs-are-in-control-3"></a>The Constructs Are In Control</h2>
<p>In this model, the constness is applied by anything that thinks of its argument as being iterative.</p>
<p>So for example, the WHILE loop takes its body (and condition) as a <code>&lt;const&gt;</code>-marked parameter.</p>
<pre><code>input: [a b c]

output: []  ; want to get [[a] [b] [c]]

while [item: try take input] [
    block: []
    append block item
    append output block
]
</code></pre>
<p>You'll get an error on the APPEND to BLOCK of <strong><code>"CONST or iterative value"</code></strong>.</p>
<p>By comparison, EVAL does not take its block argument as a const parameter, so this works without complaining about the appends to data:</p>
<pre><code>&gt;&gt; eval [data: [], append data &lt;1&gt;, append data &lt;2&gt;]
== [&lt;1&gt; &lt;2&gt;]
</code></pre>
<p><em>But</em> it's inherited, so a EVAL inside of a WHILE would have the block it received to do as const, due to the WHILE's influence.</p>
<p>Predicting that functions are likely to be called more than once, FUNC takes its body as CONST...and that constness propagates as the wave of evaluation proceeds through the body.</p>
<p>But notice that as long as the underlying series isn't immutable (due to things like PROTECT), you can subvert the const bit with MUTABLE:</p>
<pre><code> accumulate: func [x] [
     accumulator: mutable []
     return append accumulator x
 ]

 &gt;&gt; accumulate 10
 == [10]

 &gt;&gt; accumulate 20
 == [10 20]
</code></pre>
<p>Emulating historical Rebol2/R3-Alpha/Red conventions just means tweaking the specs for things like FUNC and WHILE.  Instead of taking their body parameters as <strong><code>&lt;const&gt;</code></strong>, take them normally.</p>
<h2><a name="p-2847-should-modules-be-stricter-by-default-4" class="anchor" href="1.html#p-2847-should-modules-be-stricter-by-default-4"></a>Should Modules Be Stricter By Default?</h2>
<p>The SWITCH case I opened with shows why I absolutely think that constness-on-func-bodies is the right choice.  That's in addition to addressing the speedbump every new user has when they write <strong>repeat 10 [block: [] ...]</strong> and expect block to be reinitialized each time through the loop.</p>
<p>But what should the default be for code that's not in a function or a loop?</p>
<p>Certainly in the console mutability has been the status quo.  If modules enforced constness for their top-level code (despite being run only once) but the console didn't, would that be a good tradeoff...or just confusing?</p>
<p>I don't think saying MUTABLE [...] is much of a burden to get deep mutable access to a series when you mean that.  I feel it's better to teach good habits early on.  But who knows.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../why-we-dont-use-copy-on-write/1162.html">Why We Don&#39;t Use Copy-on-Write</a>
                        <meta itemprop='position' content='1'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../using-c-s-const-keyword-to-power-const/2501.html">Using C++&#39;s const keyword to Power CONST</a>
                        <meta itemprop='position' content='2'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../more-history-mining-rebol-3-0-front-line-blog/2199.html">More History Mining: Rebol 3.0 Front Line Blog</a>
                        <meta itemprop='position' content='3'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../stackless-is-here-today-now/1844/2.html">Stackless Is Here, Today, Now! :pancakes:</a>
                        <meta itemprop='position' content='4'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../block-creation-vs-evaluation/2098/3.html">Block Creation Vs. Evaluation</a>
                        <meta itemprop='position' content='5'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="../../2018-retrospective-elevating-the-art/992.html">2018 Retrospective: Elevating the Art</a>
                        <meta itemprop='position' content='6'>
                      </div>
                </div>
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../../u/IngoHohmann.html'><span itemprop='name'>IngoHohmann</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-12-25T23:42:41Z' class='post-time'>
                    December 25, 2018, 11:42pm
                  </time>
                  <meta itemprop='dateModified' content='2018-12-25T23:42:41Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group quote-modified" data-username="hostilefork" data-post="1" data-topic="976">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/hostilefork/48/421_2.png" class="avatar"> hostilefork:</div>
<blockquote>
<p>If modules enforced it by default but the console didn’t, would that be a good tradeoff</p>
</blockquote>
</aside>
<p>Yes, I think it would be.</p>
<p>One question, if a function hands out const access to a value, is the the receiver able to change it to a mutable value? Should this be possible?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-12-25T23:59:23Z' class='post-time'>
                    December 25, 2018, 11:59pm
                  </time>
                  <meta itemprop='dateModified' content='2023-12-08T01:12:42Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group quote-modified" data-username="IngoHohmann" data-post="2" data-topic="976">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/ingohohmann/48/195_2.png" class="avatar"> IngoHohmann:</div>
<blockquote>
<p>"If modules enforced it by default but the console didn’t, would that be a good tradeoff" =&gt; Yes, I think it would be.</p>
</blockquote>
</aside>
<p>There may be more options than just binary ones here, so it's likely best to get some experience.</p>
<p>I really believe that not being consistent between the console and scripts running should be heavily weighed.  The console is kind of the place where you try out things and use as a sanity check when debugging.</p>
<aside class="quote no-group" data-username="IngoHohmann" data-post="2" data-topic="976">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/ingohohmann/48/195_2.png" class="avatar"> IngoHohmann:</div>
<blockquote>
<p>if a function hands out const access to a value, is the the receiver able to change it to a mutable value</p>
</blockquote>
</aside>
<p>Perhaps there could be a difference between explicit const (irrevocable on that value once applied) and an implicit one, the evaluator just put on itself from a frame.  That mechanic may not be too difficult.</p>
<p>But in their current incarnation, const and mutable are "suggestions" and there's no level of privilege escalation.  If you want to lock something so no one can get write access on it, you have to LOCK it.</p>
<p>Locking is still necessary for things like using blocks for keys in MAP!, and something more lock-like is probably the only way to imagine safe multithreading.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../../u/BlackATTR.html'><span itemprop='name'>BlackATTR</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-12-26T17:16:46Z' class='post-time'>
                    December 26, 2018,  5:16pm
                  </time>
                  <meta itemprop='dateModified' content='2018-12-26T17:16:46Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I think this gets to the question of robustness of the language. If this helps Rebol get beyond the perception of being unserious for real development work, then I'm in favor as it seems like a worthy tradeoff. It would need to be documented/taught but I think the additional rigor would lead to better programming practices.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
                  Split this topic 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2025-06-28T10:40:18Z' class='post-time'>
                    June 28, 2025, 10:40am
                  </time>
                  <meta itemprop='dateModified' content='2025-06-28T10:40:18Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>A post was split to a new topic: <a href="../../using-c-s-const-keyword-to-power-const/2501.html">Using C++'s const keyword to Power CONST</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2024-11-20T04:12:48Z' class='post-time'>
                    November 20, 2024,  4:12am
                  </time>
                  <meta itemprop='dateModified' content='2024-11-20T04:12:48Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>The const feature was implemented via CELL_FLAG_CONST, a bit that a cell could have set (or not) in its header.</p>
<p>But there was a second bit... called CELL_FLAG_EXPLICITLY_MUTABLE.</p>
<p>This bit protected a block from the "wave of constness".</p>
<p>It was necessitated by some behaviors that I ultimately deemed to be bugs.  Now that those bugs are gone, it's no longer mandatory to have it.</p>
<p>So I took it out, but found it broke a test:</p>
<pre><code>block: mutable [a b c]
eval compose:deep $() [repeat 2 [append (block) &lt;legal&gt;]]
assert [block = [&lt;legal&gt; &lt;legal&gt;]]
</code></pre>
<p>So previously, that mutable would put the CELL_FLAG_EXPLICITLY_MUTABLE bit on.  Then, when the COMPOSE ran, you'd get:</p>
<pre><code> eval [repeat 2 [append [a b c] &lt;legal&gt;]]
</code></pre>
<p>Because REPEAT is iterative, it applies CONST to its body.  And that CONST would get applied to the <code>[a b c]</code>...but, CELL_FLAG_EXPLICITLY_MUTABLE overruled it.</p>
<h2><a name="p-7916-but-i-dont-like-cell_flag_explicitly_mutable-1" class="anchor" href="1.html#p-7916-but-i-dont-like-cell_flag_explicitly_mutable-1"></a>But I Don't Like CELL_FLAG_EXPLICITLY_MUTABLE</h2>
<p>There are other ways to get past the const wave, such as quoting it:</p>
<pre><code>block: [a b c]
eval compose:deep $() [repeat 2 [append '(block) &lt;legal&gt;]]
</code></pre>
<p>Or you could do <strong>append mutable</strong>:</p>
<pre><code>block: [a b c]
eval compose:deep $() [repeat 2 [append mutable (block) &lt;legal&gt;]]
</code></pre>
<p>Admittedly, these require you to have some control of the code the block is being fed into, vs. being able to put a "magic bit" on the block to counteract the const wave.</p>
<p>But the semantics of this magic bit are nebulous.  I would not have added such a thing if it wasn't for working around the things I decided were bugs.  It's not clear when (if ever) it should stop protecting the value, and that just opens a can of worms.</p>
<p>Cell flags are a pretty scarce resource, and giving one up for something that makes the code harder to understand than a simple CONST bit that's on or off is not a good investment.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
