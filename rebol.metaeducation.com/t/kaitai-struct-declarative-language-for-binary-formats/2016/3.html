<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Kaitai Struct Declarative Language for Binary Formats - #3 by hostilefork - Foreign Inspiration - AltRebol</title>
    <meta name="description" content="This is an interesting declarative language in YAML designed to generate classes for binary formats.  There are many formats defined: 
https://formats.kaitai.io/ 
That&amp;#39;s a lot of cases...but as one instructive example, y&amp;hellip;">
    <meta name="generator" content="Discourse 3.5.0.beta6-dev - https://github.com/discourse/discourse version 623cde985b21c2ed812b83d3ea94f69231613718">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" media="all" content="#fff">

<meta name="color-scheme" content="light">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="../2016.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="AltRebol Search">

    <link href="https://rebol.metaeducation.com/stylesheets/color_definitions_base__2_ceb61c279a74dfa3cef6a62f7784988102abec82.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" class="light-scheme"/>

<link href="https://rebol.metaeducation.com/stylesheets/common_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common"  />

  <link href="https://rebol.metaeducation.com/stylesheets/desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="desktop"  />



    <link href="https://rebol.metaeducation.com/stylesheets/chat_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-details_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-lazy-videos_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-local-dates_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-narrative-bot_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="https://rebol.metaeducation.com/stylesheets/discourse-presence_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="https://rebol.metaeducation.com/stylesheets/docker_manager_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="https://rebol.metaeducation.com/stylesheets/footnote_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll"  />
    <link href="https://rebol.metaeducation.com/stylesheets/spoiler-alert_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="https://rebol.metaeducation.com/stylesheets/chat_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="chat_desktop"  />
    <link href="https://rebol.metaeducation.com/stylesheets/poll_desktop_e0a75505da9bc96953dd62a4aad773a25cca0f8e.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://rebol.metaeducation.com/stylesheets/common_theme_2_57fe803ed5a41e9f7d94086afaf66a1aab57d9ae.css?__ws=rebol.metaeducation.com" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="2" data-theme-name="default"/>
    

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Kaitai Struct Declarative Language for Binary Formats&#39;" href="../2016.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://rebol.metaeducation.com/t/kaitai-struct-declarative-language-for-binary-formats/2016/3" />
<meta name="twitter:url" content="https://rebol.metaeducation.com/t/kaitai-struct-declarative-language-for-binary-formats/2016/3" />
<meta property="og:title" content="Kaitai Struct Declarative Language for Binary Formats" />
<meta name="twitter:title" content="Kaitai Struct Declarative Language for Binary Formats" />
<meta property="og:description" content="Some might consider this more a proof of failure of the educational system vs. a proof of the primacy of C...  ðŸ™‚   ...and so you&#39;ve got some competing demands here, if you are talking about &quot;each language&quot;...  It&#39;s a super-common pattern in classical imperative programming, where humans are bad at writing forward and reverse transformations and maintaining that code.  I&#39;m not sure you&#39;ll get &quot;reversibility&quot; from a specification if the language that interprets it isn&#39;t expressive en..." />
<meta name="twitter:description" content="Some might consider this more a proof of failure of the educational system vs. a proof of the primacy of C...  ðŸ™‚   ...and so you&#39;ve got some competing demands here, if you are talking about &quot;each language&quot;...  It&#39;s a super-common pattern in classical imperative programming, where humans are bad at writing forward and reverse transformations and maintaining that code.  I&#39;m not sure you&#39;ll get &quot;reversibility&quot; from a specification if the language that interprets it isn&#39;t expressive en..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="og:article:section" content="Foreign Inspiration" />
<meta property="og:article:section:color" content="25AAE2" />
<meta property="article:published_time" content="2025-01-30T06:35:58+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="https://rebol.metaeducation.com/">AltRebol</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="../2016.html">Kaitai Struct Declarative Language for Binary Formats</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/development/foreign-inspiration.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/development/foreign-inspiration.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Foreign Inspiration</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Kaitai Struct Declarative Language for Binary Formats'>
      <link itemprop='url' href='../2016.html'>
      <meta itemprop='datePublished' content='2023-02-21T22:36:43Z'>
        <meta itemprop='articleSection' content='Foreign Inspiration'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='AltRebol'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://rebol.metaeducation.com/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
          </div>
      </div>

          <span itemprop='author' itemscope itemtype="http://schema.org/Person">
            <meta itemprop='name' content='hostilefork'>
            <link itemprop='url' rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'>
          </span>
        <meta itemprop='text' content='This is an interesting declarative language in YAML designed to generate classes for binary formats.  There are many formats defined: 
https://formats.kaitai.io/ 
That&amp;#39;s a lot of cases...but as one instructive example, y&amp;hellip;'>

          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='https://rebol.metaeducation.com/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2025-01-30T06:35:58Z' class='post-time'>
                    January 30, 2025,  6:35am
                  </time>
                  <meta itemprop='dateModified' content='2025-01-30T08:19:25Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="jhgorse" data-post="2" data-topic="2016">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/jhgorse/48/245_2.png" class="avatar"> jhgorse:</div>
<blockquote>
<p>Further Dennis Ritchie and Ken Thompson wrote C to interface with digital systems. C is one of the more complete approaches to data. Hence its widespread continued 53 years after its initial release in 1972.</p>
</blockquote>
</aside>
<p>Some might consider this more a proof of failure of the educational system vs. a proof of the primacy of C...  <img src="../../../images/emoji/twitter/slight_smile.png%3Fv=14" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<aside class="quote no-group" data-username="jhgorse" data-post="2" data-topic="2016">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../../user_avatar/rebol.metaeducation.com/jhgorse/48/245_2.png" class="avatar"> jhgorse:</div>
<blockquote>
<p>Still looking for a way to describe a binary format once and not write the serializer/deserializer in each language that touches the data.</p>
</blockquote>
</aside>
<p>...and so you've got some competing demands here, if you are talking about "each language"...</p>
<p>It's a super-common pattern in classical imperative programming, where humans are bad at writing forward and reverse transformations and maintaining that code.</p>
<p>I'm not sure you'll get "reversibility" from a specification if the language that interprets it isn't expressive enough in its type system to properly box and unbox everything under the right conditions relative to the spec.  We've spoken about this before--about why FP manages to let you express things that <em>aren't</em> intrinsically reversible, yet you can write your program in a way that sort of <em>pretends</em> they are...as if the reverse transformation exists, even though it doesn't.  It just sifts the order out so that it never has to actually reverse anything, but figures the meaningful ordering out (in terms of things like <code>bind</code> and <code>return</code>, if monads, but not everything is a monad).</p>
<p><em>(Take the above imprecise language with a grain of salt.)</em></p>
<p>What you need are combinators, and to get those combinators you need to lean on a type system.   Or failing that, something like <strike>Rebol</strike> Ren-C that is so paradigm neutral that you wind up having to tailor it ad-hoc to where someone might ask you why you are reinventing the wheel.  I'm just trying to make it unusually easy for laypeople who want to play with a Minecraft-like-programming model to do these things.</p>
<p>(<em>"We must not forget that the wheel is reinvented so often because it is a very good idea; I've learned to worry more about the soundness of ideas that were invented only once."</em> --David Parnas)</p>
<p><a class="mention" href="https://rebol.metaeducation.com/u/bradrn">@bradrn</a> would know more than me about the specifics if you want to draw inspiration from Haskell.  But if you're looking for the "right" answer here you need something "combinator-like".  Maybe <a href="https://hackage.haskell.org/package/cereal">cereal</a> or <a href="https://hackage.haskell.org/package/binary-parsers-0.2.4.0/docs/Data-Binary-Parser.html">Data.Binary.Parser</a></p>
<p>Since my Haskell is weak I asked an AI to give an example, e.g. for ZIP, here's a bit of a suggestion:</p>
<pre><code>data ZipEntry = ZipEntry {
    signature    :: Word32,
    compression :: Word16,
    filename    :: String,
    data        :: ByteString
} deriving (Show, Eq)

zipEntryFormat :: BinaryFormat ZipEntry
zipEntryFormat = do
    sig &lt;- field "signature" (constant 0x04034b50)
    comp &lt;- field "compression" word16LE
    fname &lt;- field "filename" (lengthPrefixed word16LE utf8String)
    dat &lt;- field "data" (remainingBytes)
    pure $ ZipEntry sig comp fname dat
</code></pre>
<p>Core mechanism something like this:</p>
<pre><code>data BinaryFormat a = BinaryFormat {
    parseFrom :: ByteString -&gt; Either Error (a, ByteString),
    serialize :: a -&gt; ByteString
}
</code></pre>
<p>You can ask your nearest AI to explain how it works.  But here's some fake C++:</p>
<pre><code>// This is NOT real C++, but illustrates the concept
template&lt;typename T&gt;
class BinaryFormat {
public:
    virtual T parse(const std::vector&lt;uint8_t&gt;&amp; bytes) = 0;
    virtual std::vector&lt;uint8_t&gt; serialize(const T&amp; value) = 0;
};

// Each primitive must implement both directions
class Word16Format : public BinaryFormat&lt;uint16_t&gt; {
public:
    uint16_t parse(const std::vector&lt;uint8_t&gt;&amp; bytes) override {
        return bytes[0] | (bytes[1] &lt;&lt; 8);
    }
    std::vector&lt;uint8_t&gt; serialize(const uint16_t&amp; value) override {
        return {uint8_t(value), uint8_t(value &gt;&gt; 8)};
    }
};

// Composing formats preserves bidirectionality
template&lt;typename T1, typename T2&gt;
class PairFormat : public BinaryFormat&lt;std::pair&lt;T1, T2&gt;&gt; {
    BinaryFormat&lt;T1&gt;* first;
    BinaryFormat&lt;T2&gt;* second;
    // ... implementation that uses both parse and serialize from sub-formats
};
</code></pre>
<p>So far, what we've done is more like Kaitai than it is like combinators:</p>
<ul>
<li><a class="mention" href="https://rebol.metaeducation.com/u/rgchris">@rgchris</a>'s <a href="../../bincode/1863.html">Bincode</a></li>
<li>My <a href="../../dissecting-the-tls-emit-dialect/1498.html">TLS Emit</a></li>
<li>Oldes's <a href="../../dissecting-the-tls-emit-dialect/1498/2.html">Binary</a></li>
</ul>
<p>But, <a href="../../introducing-uparse-the-hackable-usermode-parse/1529.html">as UPARSE has shown</a>, Ren-C can tackle higher-order, combinator-like problems.</p>
<p>If you want an introduction to combinator-based thinking, this article is pretty good.  <img src="../../../images/emoji/twitter/slight_smile.png%3Fv=14" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<p><a href="https://ae1020.github.io/incremental-streaming-haskell-parse/" class="inline-onebox">Parsing Huge Simulated Streams In Attoparsec | AE1020: Lazy Notebook</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
          <span itemprop='name'>
            <a itemprop="url" href="../2016.html#post_3">show post in topic</a>
          </span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://rebol.metaeducation.com/guidelines' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://rebol.metaeducation.com/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
